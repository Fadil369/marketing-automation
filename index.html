<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrainSAIT Marketing Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Simplified color palette - functional only */
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            
            --border: #e5e7eb;
            --border-light: #f3f4f6;
            
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --radius: 6px;
        }

        /* Dark mode - simplified */
        [data-theme="dark"] {
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-tertiary: #374151;
            
            --border: #374151;
            --border-light: #4b5563;
        }

        [data-theme="dark"] body {
            background: var(--bg-secondary);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 14px;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        .header {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            border-top: 3px solid var(--primary);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 13px;
            font-weight: 500;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
            flex-shrink: 0;
        }

        /* Main action buttons - prioritize core functionality */
        .primary-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 20px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--primary);
            border-radius: var(--radius);
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            min-height: 100px;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-1px);
        }

        .action-btn .icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        /* Simplified table for campaign data */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }

        .data-table th,
        .data-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
            font-size: 13px;
        }

        .data-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-secondary);
        }

        .data-table tr:hover {
            background: var(--bg-secondary);
        }

        .platform-selector {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: var(--radius);
            padding: 4px;
            margin-bottom: 16px;
        }

        .platform-btn {
            flex: 1;
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .platform-btn.active {
            background: var(--bg-primary);
            color: var(--text-primary);
            box-shadow: var(--shadow);
        }

        .platform-btn:hover:not(.active) {
            color: var(--text-primary);
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .metric {
            text-align: center;
            padding: 16px 12px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
        }

        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .btn {
            padding: 10px 16px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            border: 1px solid transparent;
            min-height: 36px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            min-height: 28px;
        }

        /* Simple controls panel */
        .controls-panel {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 1000;
            display: flex;
            gap: 8px;
        }

        .theme-toggle {
            padding: 8px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 12px;
        }

        .notification {
            position: fixed;
            top: 70px;
            right: 16px;
            background: var(--success);
            color: white;
            padding: 12px 16px;
            border-radius: var(--radius);
            font-size: 13px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 12px;
            }
            
            .header {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .primary-actions {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .action-btn {
                flex-direction: row;
                text-align: left;
                min-height: 60px;
                padding: 16px;
            }
            
            .action-btn .icon {
                margin-bottom: 0;
                margin-right: 12px;
                font-size: 20px;
            }
            
            .grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .card {
                padding: 16px;
            }
            
            .status-bar {
                grid-template-columns: 1fr;
            }
            
            .metric-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .platform-selector {
                flex-direction: column;
            }
            
            .platform-btn {
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .metric-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Accessibility - high contrast and clear focus */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        button:focus-visible,
        .platform-btn:focus-visible,
        .btn:focus-visible,
        .action-btn:focus-visible {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .card, .action-btn {
                border-width: 2px;
            }
            
            .btn-primary {
                background: var(--primary-dark);
            }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        .modal {
            background: var(--bg-primary);
            border-radius: var(--radius);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-content {
            padding: 20px;
            overflow-y: auto;
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group input.error,
        .form-group select.error,
        .form-group textarea.error {
            border-color: var(--error);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            cursor: pointer;
        }

        .field-error {
            color: var(--error);
            font-size: 12px;
            margin-top: -4px;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .btn-danger {
            background: var(--error);
            color: white;
            margin-right: auto;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Loading Styles */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
        }

        .loading-spinner {
            background: var(--bg-primary);
            padding: 30px;
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Campaign List Styles */
        .campaigns-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .campaign-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 12px;
        }

        .campaign-info h4 {
            margin: 0 0 8px 0;
            color: var(--text-primary);
        }

        .campaign-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .campaign-meta span {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--bg-secondary);
        }

        .status.active {
            background: var(--success);
            color: white;
        }

        .status.paused {
            background: var(--warning);
            color: white;
        }

        .status.draft {
            background: var(--text-muted);
            color: white;
        }

        .campaign-platforms {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .platform-tag {
            font-size: 11px;
            padding: 2px 6px;
            background: var(--primary);
            color: white;
            border-radius: 3px;
        }

        /* Calendar Styles */
        .calendar-view {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .calendar-day {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .calendar-day.today {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .calendar-date {
            background: var(--bg-secondary);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .calendar-date h4 {
            margin: 0;
            color: var(--text-primary);
            font-size: 14px;
        }

        .calendar-content {
            padding: 12px;
        }

        .calendar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
            background: var(--bg-secondary);
        }

        .calendar-item:last-child {
            margin-bottom: 0;
        }

        .calendar-item.ready {
            border-left: 3px solid var(--success);
        }

        .calendar-item.scheduled {
            border-left: 3px solid var(--text-muted);
        }

        .calendar-item.processing {
            border-left: 3px solid var(--warning);
        }

        .calendar-item.published {
            border-left: 3px solid var(--primary);
        }

        .calendar-item.failed {
            border-left: 3px solid var(--error);
        }

        .item-time {
            font-weight: 600;
            color: var(--text-primary);
            min-width: 50px;
        }

        .item-title {
            flex: 1;
            color: var(--text-primary);
            font-size: 13px;
        }

        .item-platform {
            font-size: 11px;
            padding: 2px 6px;
            background: var(--primary);
            color: white;
            border-radius: 3px;
            text-transform: capitalize;
        }

        /* Analytics Styles */
        .analytics-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .analytics-filters {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .filter-group select {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 13px;
        }

        .analytics-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .chart-container {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
        }

        .chart-container h4 {
            margin: 0 0 16px 0;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
        }

        .chart-container:nth-child(3) {
            grid-column: span 2;
        }

        .analytics-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            grid-column: span 2;
        }

        .metric-card {
            text-align: center;
            padding: 20px 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .metric-card .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .metric-card .metric-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .analytics-charts {
                grid-template-columns: 1fr;
            }
            
            .chart-container:nth-child(3) {
                grid-column: span 1;
            }
            
            .analytics-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .analytics-metrics {
                grid-column: span 1;
            }
        }

        /* Lead Management Styles */
        .leads-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .leads-toolbar {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            flex-wrap: wrap;
        }

        .search-group {
            flex: 1;
            min-width: 200px;
        }

        .search-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .leads-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            text-align: center;
            padding: 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .stat-card .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-card .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .leads-list {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .lead-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-primary);
        }

        .lead-item:last-child {
            border-bottom: none;
        }

        .lead-item:hover {
            background: var(--bg-secondary);
        }

        .lead-info {
            flex: 1;
        }

        .lead-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .lead-header h4 {
            margin: 0;
            color: var(--text-primary);
            font-size: 16px;
        }

        .lead-score {
            padding: 4px 8px;
            border-radius: 12px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .lead-details {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 8px;
        }

        .lead-details span {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .lead-email {
            color: var(--primary) !important;
        }

        .lead-source {
            padding: 2px 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            font-size: 11px !important;
            font-weight: 600;
        }

        .source-tiktok {
            background: #ff0050;
            color: white !important;
        }

        .source-instagram {
            background: #e4405f;
            color: white !important;
        }

        .source-snapchat {
            background: #fffc00;
            color: black !important;
        }

        .source-website {
            background: var(--primary);
            color: white !important;
        }

        .source-referral {
            background: var(--success);
            color: white !important;
        }

        .lead-status {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .lead-notes {
            font-size: 13px;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 8px;
        }

        .lead-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .no-leads {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .leads-toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .leads-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .lead-item {
                flex-direction: column;
                gap: 12px;
            }
            
            .lead-actions {
                align-self: stretch;
                justify-content: flex-end;
            }
            
            .lead-details {
                flex-direction: column;
                gap: 4px;
            }
        }

        /* Automation and Logs Styles */
        .automation-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .automation-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .automation-list {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .automation-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-primary);
        }

        .automation-item:last-child {
            border-bottom: none;
        }

        .automation-item:hover {
            background: var(--bg-secondary);
        }

        .automation-info {
            flex: 1;
        }

        .automation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .automation-header h4 {
            margin: 0;
            color: var(--text-primary);
        }

        .automation-status {
            font-weight: 600;
            font-size: 13px;
        }

        .automation-details {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }

        .automation-type {
            padding: 2px 6px;
            background: var(--primary);
            color: white;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
        }

        .automation-last-run {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .automation-rules {
            font-size: 13px;
            color: var(--text-muted);
        }

        .automation-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .automation-logs {
            margin: 20px 0;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            background: var(--bg-secondary);
        }

        .automation-logs h4 {
            margin: 0 0 12px 0;
            color: var(--text-primary);
        }

        .log-entries {
            max-height: 200px;
            overflow-y: auto;
        }

        .logs-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .logs-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
        }

        .logs-filters select {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .logs-list {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .log-entry {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-primary);
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 150px;
        }

        .log-message {
            flex: 1;
            font-size: 13px;
            color: var(--text-primary);
        }

        .log-type {
            font-size: 11px;
            padding: 2px 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .log-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            min-width: 60px;
        }

        .log-status.info {
            background: var(--primary);
            color: white;
        }

        .log-status.success {
            background: var(--success);
            color: white;
        }

        .log-status.warning {
            background: var(--warning);
            color: white;
        }

        .log-status.error {
            background: var(--error);
            color: white;
        }

        .no-logs {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .automation-stats {
                grid-template-columns: 1fr;
            }
            
            .automation-item {
                flex-direction: column;
                gap: 12px;
            }
            
            .automation-actions {
                align-self: stretch;
                justify-content: flex-end;
            }
            
            .log-entry {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .log-time {
                min-width: auto;
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *, .spinner {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Print styles */
        @media print {
            .controls-panel,
            .notification,
            .modal-overlay,
            .loading-overlay {
                display: none;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .card {
                break-inside: avoid;
                box-shadow: none;
            }
        }

        /* Mobile Modal Styles */
        @media (max-width: 768px) {
            .modal-overlay {
                padding: 10px;
            }
            
            .modal {
                max-height: 95vh;
            }
            
            .modal-content {
                padding: 16px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="controls-panel">
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
            <span id="themeIcon">ðŸŒ™</span>
        </button>
        <button class="theme-toggle" onclick="toggleLanguage()" aria-label="Toggle language">
            <span id="langToggleText">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
        </button>
    </div>

    <div class="notification" id="notification">
        <span id="notificationText">Action completed!</span>
    </div>

    <div class="dashboard-container">
        <!-- Header Section -->
        <div class="header">
            <h1 id="mainTitle">BrainSAIT Marketing Dashboard</h1>
            <p id="subtitle">Simplified campaign management for Spark Solo & BrainSAIT Solutions</p>
            
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span id="automationStatus">Automation Active</span>
                </div>
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span id="campaignStatus">3 Active Campaigns</span>
                </div>
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span id="contentStatus">47 Scheduled Posts</span>
                </div>
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span id="leadStatus">128 New Leads</span>
                </div>
            </div>
        </div>

        <!-- Primary Actions - Core Functionality -->
        <div class="primary-actions">
            <a href="#" class="action-btn" onclick="createCampaign()">
                <div class="icon">ðŸ“ˆ</div>
                <div>Create Campaign</div>
            </a>
            <a href="#" class="action-btn" onclick="scheduleContent()">
                <div class="icon">ðŸ“…</div>
                <div>Schedule Content</div>
            </a>
            <a href="#" class="action-btn" onclick="viewAnalytics()">
                <div class="icon">ðŸ“Š</div>
                <div>View Analytics</div>
            </a>
            <a href="#" class="action-btn" onclick="manageLeads()">
                <div class="icon">ðŸ‘¥</div>
                <div>Manage Leads</div>
            </a>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="grid">
            <!-- Active Campaigns -->
            <div class="card">
                <h3>Active Campaigns</h3>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Campaign</th>
                            <th>Status</th>
                            <th>Budget</th>
                            <th>Performance</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Spark Solo Launch</td>
                            <td><span style="color: var(--success); font-weight: 600;">Active</span></td>
                            <td>$2,500</td>
                            <td>73% to goal</td>
                            <td><button class="btn btn-small btn-secondary" onclick="editCampaign(1)">Edit</button></td>
                        </tr>
                        <tr>
                            <td>Brand Awareness MENA</td>
                            <td><span style="color: var(--warning); font-weight: 600;">Optimizing</span></td>
                            <td>$1,800</td>
                            <td>45% to goal</td>
                            <td><button class="btn btn-small btn-secondary" onclick="editCampaign(2)">Edit</button></td>
                        </tr>
                        <tr>
                            <td>Retargeting Q4</td>
                            <td><span style="color: var(--text-muted); font-weight: 600;">Scheduled</span></td>
                            <td>$1,200</td>
                            <td>Starts in 3 days</td>
                            <td><button class="btn btn-small btn-secondary" onclick="editCampaign(3)">Edit</button></td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="createCampaign()">New Campaign</button>
                    <button class="btn btn-secondary" onclick="viewAllCampaigns()">View All</button>
                </div>
            </div>
            
            <!-- Platform Performance -->
            <div class="card">
                <h3 id="platformPerformanceTitle">Platform Performance</h3>
                
                <div class="platform-selector">
                    <button class="platform-btn active" onclick="selectPlatform('all')">All</button>
                    <button class="platform-btn" onclick="selectPlatform('tiktok')">TikTok</button>
                    <button class="platform-btn" onclick="selectPlatform('instagram')">Instagram</button>
                    <button class="platform-btn" onclick="selectPlatform('snapchat')">Snapchat</button>
                </div>

                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-value" id="reachMetric">45.2K</div>
                        <div class="metric-label" id="reachLabel">Reach</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="engagementMetric">8.7%</div>
                        <div class="metric-label" id="engagementLabel">Engagement</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="conversionsMetric">312</div>
                        <div class="metric-label" id="conversionsLabel">Conversions</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="roiMetric">4.2x</div>
                        <div class="metric-label" id="roiLabel">ROI</div>
                    </div>
                </div>
            </div>

            <!-- Content Schedule -->
            <div class="card">
                <h3 id="contentPipelineTitle">Content Schedule</h3>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Content</th>
                            <th>Platform</th>
                            <th>Schedule</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Spark Solo Demo - Healthcare</td>
                            <td>TikTok</td>
                            <td>Tomorrow 2:00 PM</td>
                            <td><span style="color: var(--success); font-weight: 600;">Ready</span></td>
                            <td><button class="btn btn-small btn-secondary" onclick="editContent(1)">Edit</button></td>
                        </tr>
                        <tr>
                            <td>AI Automation Tips</td>
                            <td>Instagram</td>
                            <td>Tomorrow 6:00 PM</td>
                            <td><span style="color: var(--warning); font-weight: 600;">Processing</span></td>
                            <td><button class="btn btn-small btn-secondary" onclick="editContent(2)">Edit</button></td>
                        </tr>
                        <tr>
                            <td>BrainSAIT Behind Scenes</td>
                            <td>Snapchat</td>
                            <td>Wed 10:00 AM</td>
                            <td><span style="color: var(--text-muted); font-weight: 600;">Scheduled</span></td>
                            <td><button class="btn btn-small btn-secondary" onclick="editContent(3)">Edit</button></td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="generateContent()">
                        <span>+</span>
                        <span id="generateBtn">New Content</span>
                    </button>
                    <button class="btn btn-secondary" onclick="viewCalendar()">
                        <span id="calendarBtn">View Calendar</span>
                    </button>
                </div>
            </div>

            <!-- Lead Generation -->
            <div class="card">
                <h3 id="leadGenTitle">Lead Generation</h3>
                
                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-value">247</div>
                        <div class="metric-label">New Leads</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">18.4%</div>
                        <div class="metric-label">Conv. Rate</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">$12.50</div>
                        <div class="metric-label">Cost/Lead</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">67%</div>
                        <div class="metric-label">Quality</div>
                    </div>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Source</th>
                            <th>Leads</th>
                            <th>Quality</th>
                            <th>Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>TikTok Ads</td>
                            <td>156</td>
                            <td>72%</td>
                            <td>$11.20</td>
                        </tr>
                        <tr>
                            <td>Instagram</td>
                            <td>91</td>
                            <td>68%</td>
                            <td>$14.80</td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="viewLeads()">
                        <span id="viewLeadsBtn">View All Leads</span>
                    </button>
                    <button class="btn btn-secondary" onclick="exportData()">
                        <span id="exportBtn">Export</span>
                    </button>
                </div>
            </div>

            <!-- Automation Status -->
            <div class="card">
                <h3 id="automationHubTitle">Automation Status</h3>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Process</th>
                            <th>Status</th>
                            <th>Last Run</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Content Generation</td>
                            <td><span style="color: var(--success); font-weight: 600;">Active</span></td>
                            <td>2 mins ago</td>
                            <td><button class="btn btn-small btn-secondary" onclick="configureAutomation('content')">Settings</button></td>
                        </tr>
                        <tr>
                            <td>Smart Scheduling</td>
                            <td><span style="color: var(--success); font-weight: 600;">Active</span></td>
                            <td>5 mins ago</td>
                            <td><button class="btn btn-small btn-secondary" onclick="configureAutomation('schedule')">Settings</button></td>
                        </tr>
                        <tr>
                            <td>Lead Qualification</td>
                            <td><span style="color: var(--success); font-weight: 600;">Active</span></td>
                            <td>1 min ago</td>
                            <td><button class="btn btn-small btn-secondary" onclick="configureAutomation('leads')">Settings</button></td>
                        </tr>
                        <tr>
                            <td>Performance Optimization</td>
                            <td><span style="color: var(--warning); font-weight: 600;">Paused</span></td>
                            <td>1 hour ago</td>
                            <td><button class="btn btn-small btn-primary" onclick="startAutomation('performance')">Start</button></td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="configureAutomation()">
                        <span id="configureBtn">Configure All</span>
                    </button>
                    <button class="btn btn-secondary" onclick="viewLogs()">
                        <span id="logsBtn">View Logs</span>
                    </button>
                </div>
            </div>

            <!-- Quick Reports -->
            <div class="card">
                <h3>Quick Reports</h3>
                
                <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius);">
                        <div>
                            <div style="font-weight: 600; font-size: 13px;">Weekly Performance</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Campaign metrics summary</div>
                        </div>
                        <button class="btn btn-small btn-secondary" onclick="generateReport('weekly')">Generate</button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius);">
                        <div>
                            <div style="font-weight: 600; font-size: 13px;">Lead Analysis</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Quality and conversion insights</div>
                        </div>
                        <button class="btn btn-small btn-secondary" onclick="generateReport('leads')">Generate</button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius);">
                        <div>
                            <div style="font-weight: 600; font-size: 13px;">ROI Analysis</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Return on investment breakdown</div>
                        </div>
                        <button class="btn btn-small btn-secondary" onclick="generateReport('roi')">Generate</button>
                    </div>
                </div>
                
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="generateReport('comprehensive')">
                        <span>Full Report</span>
                    </button>
                    <button class="btn btn-secondary" onclick="scheduleReports()">
                        <span>Schedule</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // MARKETING DASHBOARD - FULL FUNCTIONALITY
        // Data Management System with LocalStorage persistence
        class DataManager {
            constructor() {
                this.initializeData();
            }

            initializeData() {
                if (!localStorage.getItem('campaigns')) {
                    localStorage.setItem('campaigns', JSON.stringify([
                        {
                            id: 1,
                            name: 'Spark Solo Launch',
                            status: 'active',
                            budget: 2500,
                            spent: 1825,
                            startDate: '2025-08-01',
                            endDate: '2025-09-15',
                            platforms: ['tiktok', 'instagram'],
                            goals: 'brand_awareness',
                            reach: 18300,
                            engagement: 2268,
                            conversions: 156,
                            roi: 5.1
                        },
                        {
                            id: 2,
                            name: 'Brand Awareness MENA',
                            status: 'optimizing',
                            budget: 1800,
                            spent: 810,
                            startDate: '2025-08-10',
                            endDate: '2025-09-30',
                            platforms: ['instagram', 'snapchat'],
                            goals: 'lead_generation',
                            reach: 21700,
                            engagement: 1476,
                            conversions: 124,
                            roi: 3.8
                        },
                        {
                            id: 3,
                            name: 'Retargeting Q4',
                            status: 'scheduled',
                            budget: 1200,
                            spent: 0,
                            startDate: '2025-08-21',
                            endDate: '2025-10-31',
                            platforms: ['tiktok'],
                            goals: 'conversions',
                            reach: 0,
                            engagement: 0,
                            conversions: 0,
                            roi: 0
                        }
                    ]));
                }

                if (!localStorage.getItem('content')) {
                    localStorage.setItem('content', JSON.stringify([
                        {
                            id: 1,
                            title: 'Spark Solo Demo - Healthcare',
                            description: 'Demonstration video showing Spark Solo automating healthcare workflows',
                            platform: 'tiktok',
                            scheduledDate: '2025-08-19',
                            scheduledTime: '14:00',
                            status: 'ready',
                            type: 'video',
                            campaignId: 1
                        },
                        {
                            id: 2,
                            title: 'AI Automation Tips',
                            description: 'Educational carousel about AI automation best practices',
                            platform: 'instagram',
                            scheduledDate: '2025-08-19',
                            scheduledTime: '18:00',
                            status: 'processing',
                            type: 'carousel',
                            campaignId: 2
                        },
                        {
                            id: 3,
                            title: 'BrainSAIT Behind Scenes',
                            description: 'Behind the scenes content showing BrainSAIT team at work',
                            platform: 'snapchat',
                            scheduledDate: '2025-08-21',
                            scheduledTime: '10:00',
                            status: 'scheduled',
                            type: 'story',
                            campaignId: 2
                        }
                    ]));
                }

                if (!localStorage.getItem('leads')) {
                    localStorage.setItem('leads', JSON.stringify([
                        {
                            id: 1,
                            name: 'Ahmed Al-Rashid',
                            email: 'ahmed@example.com',
                            phone: '+971501234567',
                            source: 'tiktok',
                            status: 'qualified',
                            score: 85,
                            created: '2025-08-18T10:30:00Z',
                            campaignId: 1,
                            notes: 'Interested in healthcare automation'
                        },
                        {
                            id: 2,
                            name: 'Sarah Johnson',
                            email: 'sarah.j@company.com',
                            phone: '+1555123456',
                            source: 'instagram',
                            status: 'new',
                            score: 72,
                            created: '2025-08-18T09:15:00Z',
                            campaignId: 2,
                            notes: 'Downloaded whitepaper'
                        }
                    ]));
                }

                if (!localStorage.getItem('analytics')) {
                    const today = new Date();
                    const analytics = [];
                    
                    // Generate 30 days of analytics data
                    for (let i = 29; i >= 0; i--) {
                        const date = new Date(today);
                        date.setDate(date.getDate() - i);
                        analytics.push({
                            date: date.toISOString().split('T')[0],
                            reach: Math.floor(Math.random() * 2000) + 1000,
                            engagement: Math.floor(Math.random() * 200) + 50,
                            conversions: Math.floor(Math.random() * 20) + 5,
                            spend: Math.floor(Math.random() * 200) + 100,
                            platform: ['tiktok', 'instagram', 'snapchat'][Math.floor(Math.random() * 3)]
                        });
                    }
                    localStorage.setItem('analytics', JSON.stringify(analytics));
                }

                if (!localStorage.getItem('automations')) {
                    localStorage.setItem('automations', JSON.stringify([
                        {
                            id: 1,
                            name: 'Content Generation',
                            type: 'content',
                            status: 'active',
                            lastRun: new Date(Date.now() - 2 * 60 * 1000).toISOString(),
                            rules: 'Generate content daily at 9 AM',
                            enabled: true
                        },
                        {
                            id: 2,
                            name: 'Smart Scheduling',
                            type: 'schedule',
                            status: 'active',
                            lastRun: new Date(Date.now() - 5 * 60 * 1000).toISOString(),
                            rules: 'Optimize posting times based on audience',
                            enabled: true
                        },
                        {
                            id: 3,
                            name: 'Lead Qualification',
                            type: 'leads',
                            status: 'active',
                            lastRun: new Date(Date.now() - 1 * 60 * 1000).toISOString(),
                            rules: 'Auto-score leads based on engagement',
                            enabled: true
                        },
                        {
                            id: 4,
                            name: 'Performance Optimization',
                            type: 'performance',
                            status: 'paused',
                            lastRun: new Date(Date.now() - 60 * 60 * 1000).toISOString(),
                            rules: 'Adjust budgets based on performance',
                            enabled: false
                        }
                    ]));
                }
            }

            // CRUD Operations
            getCampaigns() {
                return JSON.parse(localStorage.getItem('campaigns') || '[]');
            }

            saveCampaign(campaign) {
                const campaigns = this.getCampaigns();
                if (campaign.id) {
                    const index = campaigns.findIndex(c => c.id === campaign.id);
                    if (index !== -1) {
                        campaigns[index] = campaign;
                    }
                } else {
                    campaign.id = Date.now();
                    campaigns.push(campaign);
                }
                localStorage.setItem('campaigns', JSON.stringify(campaigns));
                return campaign;
            }

            deleteCampaign(id) {
                const campaigns = this.getCampaigns().filter(c => c.id !== id);
                localStorage.setItem('campaigns', JSON.stringify(campaigns));
            }

            getContent() {
                return JSON.parse(localStorage.getItem('content') || '[]');
            }

            saveContent(content) {
                const contentList = this.getContent();
                if (content.id) {
                    const index = contentList.findIndex(c => c.id === content.id);
                    if (index !== -1) {
                        contentList[index] = content;
                    }
                } else {
                    content.id = Date.now();
                    contentList.push(content);
                }
                localStorage.setItem('content', JSON.stringify(contentList));
                return content;
            }

            deleteContent(id) {
                const content = this.getContent().filter(c => c.id !== id);
                localStorage.setItem('content', JSON.stringify(content));
            }

            getLeads() {
                return JSON.parse(localStorage.getItem('leads') || '[]');
            }

            saveLead(lead) {
                const leads = this.getLeads();
                if (lead.id) {
                    const index = leads.findIndex(l => l.id === lead.id);
                    if (index !== -1) {
                        leads[index] = lead;
                    }
                } else {
                    lead.id = Date.now();
                    lead.created = new Date().toISOString();
                    leads.push(lead);
                }
                localStorage.setItem('leads', JSON.stringify(leads));
                return lead;
            }

            deleteLead(id) {
                const leads = this.getLeads().filter(l => l.id !== id);
                localStorage.setItem('leads', JSON.stringify(leads));
            }

            getAnalytics() {
                return JSON.parse(localStorage.getItem('analytics') || '[]');
            }

            getAutomations() {
                return JSON.parse(localStorage.getItem('automations') || '[]');
            }

            saveAutomation(automation) {
                const automations = this.getAutomations();
                const index = automations.findIndex(a => a.id === automation.id);
                if (index !== -1) {
                    automations[index] = automation;
                } else {
                    automation.id = Date.now();
                    automations.push(automation);
                }
                localStorage.setItem('automations', JSON.stringify(automations));
                return automation;
            }

            // Export/Import functionality
            exportData() {
                const data = {
                    campaigns: this.getCampaigns(),
                    content: this.getContent(),
                    leads: this.getLeads(),
                    analytics: this.getAnalytics(),
                    automations: this.getAutomations(),
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `marketing-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            importData(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.campaigns) localStorage.setItem('campaigns', JSON.stringify(data.campaigns));
                            if (data.content) localStorage.setItem('content', JSON.stringify(data.content));
                            if (data.leads) localStorage.setItem('leads', JSON.stringify(data.leads));
                            if (data.analytics) localStorage.setItem('analytics', JSON.stringify(data.analytics));
                            if (data.automations) localStorage.setItem('automations', JSON.stringify(data.automations));
                            resolve(data);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.readAsText(file);
                });
            }
        }

        // Initialize Data Manager
        const dataManager = new DataManager();
        let currentLanguage = 'en';
        let currentTheme = localStorage.getItem('theme') || 'light';

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            refreshDashboard();
        });

        // Theme toggle functionality
        function initializeTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeIcon();
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeIcon();
            showNotification('Theme changed to ' + currentTheme + ' mode');
        }

        function updateThemeIcon() {
            const themeIcon = document.getElementById('themeIcon');
            themeIcon.textContent = currentTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
        }

        // Language toggle functionality
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
            document.getElementById('langToggleText').textContent = currentLanguage === 'en' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'English';
            
            if (currentLanguage === 'ar') {
                document.body.style.direction = 'rtl';
                document.getElementById('mainTitle').textContent = 'Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„ØªØ³ÙˆÙŠÙ‚ - BrainSAIT';
                document.getElementById('subtitle').textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø¨Ø³Ø·Ø© Ù„Ø­Ù„ÙˆÙ„ Spark Solo Ùˆ BrainSAIT';
            } else {
                document.body.style.direction = 'ltr';
                document.getElementById('mainTitle').textContent = 'BrainSAIT Marketing Dashboard';
                document.getElementById('subtitle').textContent = 'Simplified campaign management for Spark Solo & BrainSAIT Solutions';
            }
            showNotification('Language switched to ' + (currentLanguage === 'en' ? 'English' : 'Arabic'));
        }

        // Platform selection
        function selectPlatform(platform) {
            document.querySelectorAll('.platform-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update metrics based on platform
            updatePlatformMetrics(platform);
        }

        function updatePlatformMetrics(platform) {
            const metrics = {
                all: { reach: '45.2K', engagement: '8.7%', conversions: '312', roi: '4.2x' },
                tiktok: { reach: '18.3K', engagement: '12.4%', conversions: '156', roi: '5.1x' },
                instagram: { reach: '21.7K', engagement: '6.8%', conversions: '124', roi: '3.8x' },
                snapchat: { reach: '5.2K', engagement: '15.2%', conversions: '32', roi: '2.9x' }
            };

            const platformMetrics = metrics[platform];
            document.getElementById('reachMetric').textContent = platformMetrics.reach;
            document.getElementById('engagementMetric').textContent = platformMetrics.engagement;
            document.getElementById('conversionsMetric').textContent = platformMetrics.conversions;
            document.getElementById('roiMetric').textContent = platformMetrics.roi;
        }

        // Enhanced notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            // Update text and style
            notificationText.textContent = message;
            notification.className = 'notification show';
            
            if (type === 'error') {
                notification.style.background = 'var(--error)';
            } else if (type === 'warning') {
                notification.style.background = 'var(--warning)';
            } else {
                notification.style.background = 'var(--success)';
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, type === 'error' ? 5000 : 3000);
        }

        // Dashboard refresh function
        function refreshDashboard() {
            updateDashboardStats();
            updateCampaignTable();
            updateContentTable();
        }

        function updateDashboardStats() {
            const campaigns = dataManager.getCampaigns();
            const content = dataManager.getContent();
            const leads = dataManager.getLeads();
            
            // Update status bar
            document.getElementById('campaignStatus').textContent = `${campaigns.filter(c => c.status === 'active').length} Active Campaigns`;
            document.getElementById('contentStatus').textContent = `${content.filter(c => c.status === 'scheduled').length} Scheduled Posts`;
            document.getElementById('leadStatus').textContent = `${leads.length} Total Leads`;
        }

        function updateCampaignTable() {
            const campaigns = dataManager.getCampaigns();
            const tbody = document.querySelector('.card:first-of-type .data-table tbody');
            
            if (!tbody) return;
            
            tbody.innerHTML = campaigns.map(campaign => {
                const performance = campaign.budget > 0 ? Math.round((campaign.spent / campaign.budget) * 100) : 0;
                const statusColor = {
                    'active': 'var(--success)',
                    'paused': 'var(--warning)',
                    'draft': 'var(--text-muted)',
                    'completed': 'var(--primary)'
                }[campaign.status] || 'var(--text-muted)';
                
                return `
                    <tr>
                        <td>${campaign.name}</td>
                        <td><span style="color: ${statusColor}; font-weight: 600;">${campaign.status.charAt(0).toUpperCase() + campaign.status.slice(1)}</span></td>
                        <td>$${campaign.budget.toLocaleString()}</td>
                        <td>${performance}% spent</td>
                        <td><button class="btn btn-small btn-secondary" onclick="editCampaign(${campaign.id})">Edit</button></td>
                    </tr>
                `;
            }).join('');
        }

        function updateContentTable() {
            const content = dataManager.getContent();
            const tbody = document.querySelector('.card:nth-of-type(3) .data-table tbody');
            
            if (!tbody) return;
            
            tbody.innerHTML = content.slice(0, 3).map(item => {
                const statusColor = {
                    'ready': 'var(--success)',
                    'processing': 'var(--warning)',
                    'scheduled': 'var(--text-muted)',
                    'published': 'var(--primary)',
                    'failed': 'var(--error)'
                }[item.status] || 'var(--text-muted)';
                
                const scheduleDate = new Date(item.scheduledDate + 'T' + item.scheduledTime);
                const now = new Date();
                const isToday = scheduleDate.toDateString() === now.toDateString();
                const isTomorrow = scheduleDate.toDateString() === new Date(now.getTime() + 24 * 60 * 60 * 1000).toDateString();
                
                let scheduleText;
                if (isToday) {
                    scheduleText = `Today ${item.scheduledTime}`;
                } else if (isTomorrow) {
                    scheduleText = `Tomorrow ${item.scheduledTime}`;
                } else {
                    scheduleText = `${scheduleDate.toLocaleDateString()} ${item.scheduledTime}`;
                }
                
                return `
                    <tr>
                        <td>${item.title}</td>
                        <td>${item.platform.charAt(0).toUpperCase() + item.platform.slice(1)}</td>
                        <td>${scheduleText}</td>
                        <td><span style="color: ${statusColor}; font-weight: 600;">${item.status.charAt(0).toUpperCase() + item.status.slice(1)}</span></td>
                        <td><button class="btn btn-small btn-secondary" onclick="editContent(${item.id})">Edit</button></td>
                    </tr>
                `;
            }).join('');
        }

        // Modal Management System
        function showModal(content) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-content">
                        ${content}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // Close on escape key
            document.addEventListener('keydown', handleEscapeKey);
        }

        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
                document.body.style.overflow = 'auto';
                document.removeEventListener('keydown', handleEscapeKey);
            }
        }

        function handleEscapeKey(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        }

        // Form Validation System
        function validateForm(formData, rules) {
            const errors = {};
            
            for (const field in rules) {
                const rule = rules[field];
                const value = formData[field];
                
                if (rule.required && (!value || value.trim() === '')) {
                    errors[field] = `${field} is required`;
                } else if (rule.minLength && value && value.length < rule.minLength) {
                    errors[field] = `${field} must be at least ${rule.minLength} characters`;
                } else if (rule.maxLength && value && value.length > rule.maxLength) {
                    errors[field] = `${field} must be no more than ${rule.maxLength} characters`;
                } else if (rule.pattern && value && !rule.pattern.test(value)) {
                    errors[field] = rule.message || `${field} format is invalid`;
                } else if (rule.min && value && parseFloat(value) < rule.min) {
                    errors[field] = `${field} must be at least ${rule.min}`;
                } else if (rule.max && value && parseFloat(value) > rule.max) {
                    errors[field] = `${field} must be no more than ${rule.max}`;
                }
            }
            
            return errors;
        }

        function showFieldError(fieldName, error) {
            const field = document.querySelector(`[name="${fieldName}"]`);
            if (field) {
                field.classList.add('error');
                const errorEl = field.parentElement.querySelector('.field-error');
                if (errorEl) {
                    errorEl.textContent = error;
                } else {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'field-error';
                    errorDiv.textContent = error;
                    field.parentElement.appendChild(errorDiv);
                }
            }
        }

        function clearFieldErrors() {
            document.querySelectorAll('.error').forEach(field => field.classList.remove('error'));
            document.querySelectorAll('.field-error').forEach(error => error.remove());
        }

        // Loading State Management
        function showLoading(message = 'Loading...') {
            const loader = document.createElement('div');
            loader.className = 'loading-overlay';
            loader.innerHTML = `
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <div class="loading-text">${message}</div>
                </div>
            `;
            document.body.appendChild(loader);
        }

        function hideLoading() {
            const loader = document.querySelector('.loading-overlay');
            if (loader) {
                loader.remove();
            }
        }

        // CAMPAIGN MANAGEMENT FUNCTIONS
        function createCampaign() {
            const modalContent = `
                <h2>Create New Campaign</h2>
                <form id="campaignForm" class="modal-form">
                    <div class="form-group">
                        <label for="campaignName">Campaign Name *</label>
                        <input type="text" id="campaignName" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="campaignBudget">Budget ($) *</label>
                        <input type="number" id="campaignBudget" name="budget" min="100" max="50000" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startDate">Start Date *</label>
                            <input type="date" id="startDate" name="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="endDate">End Date *</label>
                            <input type="date" id="endDate" name="endDate" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Platforms *</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="platforms" value="tiktok"> TikTok</label>
                            <label><input type="checkbox" name="platforms" value="instagram"> Instagram</label>
                            <label><input type="checkbox" name="platforms" value="snapchat"> Snapchat</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="campaignGoals">Primary Goal *</label>
                        <select id="campaignGoals" name="goals" required>
                            <option value="">Select Goal</option>
                            <option value="brand_awareness">Brand Awareness</option>
                            <option value="lead_generation">Lead Generation</option>
                            <option value="conversions">Conversions</option>
                            <option value="engagement">Engagement</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Campaign</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').min = today;
            document.getElementById('endDate').min = today;
            
            // Handle form submission
            document.getElementById('campaignForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveCampaignForm();
            });
        }

        function saveCampaignForm() {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('campaignForm'));
            const platforms = formData.getAll('platforms');
            
            const campaign = {
                name: formData.get('name'),
                budget: parseInt(formData.get('budget')),
                startDate: formData.get('startDate'),
                endDate: formData.get('endDate'),
                platforms: platforms,
                goals: formData.get('goals'),
                status: 'draft',
                spent: 0,
                reach: 0,
                engagement: 0,
                conversions: 0,
                roi: 0
            };
            
            // Validation rules
            const rules = {
                name: { required: true, minLength: 3, maxLength: 100 },
                budget: { required: true, min: 100, max: 50000 },
                startDate: { required: true },
                endDate: { required: true },
                goals: { required: true }
            };
            
            const errors = validateForm(campaign, rules);
            
            // Additional validation
            if (platforms.length === 0) {
                errors.platforms = 'At least one platform must be selected';
            }
            
            if (campaign.startDate && campaign.endDate && campaign.startDate >= campaign.endDate) {
                errors.endDate = 'End date must be after start date';
            }
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Creating campaign...');
            
            setTimeout(() => {
                try {
                    dataManager.saveCampaign(campaign);
                    hideLoading();
                    closeModal();
                    showNotification('Campaign created successfully!');
                    refreshDashboard();
                } catch (error) {
                    hideLoading();
                    showNotification('Error creating campaign: ' + error.message, 'error');
                }
            }, 1000);
        }

        function editCampaign(id) {
            const campaigns = dataManager.getCampaigns();
            const campaign = campaigns.find(c => c.id === id);
            
            if (!campaign) {
                showNotification('Campaign not found', 'error');
                return;
            }
            
            const modalContent = `
                <h2>Edit Campaign: ${campaign.name}</h2>
                <form id="editCampaignForm" class="modal-form">
                    <div class="form-group">
                        <label for="editCampaignName">Campaign Name *</label>
                        <input type="text" id="editCampaignName" name="name" value="${campaign.name}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCampaignBudget">Budget ($) *</label>
                        <input type="number" id="editCampaignBudget" name="budget" value="${campaign.budget}" min="100" max="50000" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editStartDate">Start Date *</label>
                            <input type="date" id="editStartDate" name="startDate" value="${campaign.startDate}" required>
                        </div>
                        <div class="form-group">
                            <label for="editEndDate">End Date *</label>
                            <input type="date" id="editEndDate" name="endDate" value="${campaign.endDate}" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Platforms *</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="platforms" value="tiktok" ${campaign.platforms.includes('tiktok') ? 'checked' : ''}> TikTok</label>
                            <label><input type="checkbox" name="platforms" value="instagram" ${campaign.platforms.includes('instagram') ? 'checked' : ''}> Instagram</label>
                            <label><input type="checkbox" name="platforms" value="snapchat" ${campaign.platforms.includes('snapchat') ? 'checked' : ''}> Snapchat</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCampaignGoals">Primary Goal *</label>
                        <select id="editCampaignGoals" name="goals" required>
                            <option value="brand_awareness" ${campaign.goals === 'brand_awareness' ? 'selected' : ''}>Brand Awareness</option>
                            <option value="lead_generation" ${campaign.goals === 'lead_generation' ? 'selected' : ''}>Lead Generation</option>
                            <option value="conversions" ${campaign.goals === 'conversions' ? 'selected' : ''}>Conversions</option>
                            <option value="engagement" ${campaign.goals === 'engagement' ? 'selected' : ''}>Engagement</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCampaignStatus">Status</label>
                        <select id="editCampaignStatus" name="status" required>
                            <option value="draft" ${campaign.status === 'draft' ? 'selected' : ''}>Draft</option>
                            <option value="active" ${campaign.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="paused" ${campaign.status === 'paused' ? 'selected' : ''}>Paused</option>
                            <option value="completed" ${campaign.status === 'completed' ? 'selected' : ''}>Completed</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="deleteCampaignConfirm(${campaign.id})" class="btn btn-danger">Delete</button>
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('editCampaignForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateCampaign(campaign.id);
            });
        }

        function updateCampaign(id) {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('editCampaignForm'));
            const platforms = formData.getAll('platforms');
            
            const existingCampaign = dataManager.getCampaigns().find(c => c.id === id);
            const updatedCampaign = {
                ...existingCampaign,
                name: formData.get('name'),
                budget: parseInt(formData.get('budget')),
                startDate: formData.get('startDate'),
                endDate: formData.get('endDate'),
                platforms: platforms,
                goals: formData.get('goals'),
                status: formData.get('status')
            };
            
            const rules = {
                name: { required: true, minLength: 3, maxLength: 100 },
                budget: { required: true, min: 100, max: 50000 },
                startDate: { required: true },
                endDate: { required: true },
                goals: { required: true },
                status: { required: true }
            };
            
            const errors = validateForm(updatedCampaign, rules);
            
            if (platforms.length === 0) {
                errors.platforms = 'At least one platform must be selected';
            }
            
            if (updatedCampaign.startDate && updatedCampaign.endDate && updatedCampaign.startDate >= updatedCampaign.endDate) {
                errors.endDate = 'End date must be after start date';
            }
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Updating campaign...');
            
            setTimeout(() => {
                try {
                    dataManager.saveCampaign(updatedCampaign);
                    hideLoading();
                    closeModal();
                    showNotification('Campaign updated successfully!');
                    refreshDashboard();
                } catch (error) {
                    hideLoading();
                    showNotification('Error updating campaign: ' + error.message, 'error');
                }
            }, 500);
        }

        function deleteCampaignConfirm(id) {
            const campaign = dataManager.getCampaigns().find(c => c.id === id);
            if (!campaign) return;
            
            if (confirm(`Are you sure you want to delete the campaign "${campaign.name}"? This action cannot be undone.`)) {
                showLoading('Deleting campaign...');
                
                setTimeout(() => {
                    try {
                        dataManager.deleteCampaign(id);
                        hideLoading();
                        closeModal();
                        showNotification('Campaign deleted successfully!');
                        refreshDashboard();
                    } catch (error) {
                        hideLoading();
                        showNotification('Error deleting campaign: ' + error.message, 'error');
                    }
                }, 500);
            }
        }

        function viewAllCampaigns() {
            const campaigns = dataManager.getCampaigns();
            
            const modalContent = `
                <h2>All Campaigns (${campaigns.length})</h2>
                <div class="campaigns-list">
                    ${campaigns.map(campaign => `
                        <div class="campaign-item">
                            <div class="campaign-info">
                                <h4>${campaign.name}</h4>
                                <div class="campaign-meta">
                                    <span class="status ${campaign.status}">${campaign.status.charAt(0).toUpperCase() + campaign.status.slice(1)}</span>
                                    <span class="budget">$${campaign.budget.toLocaleString()}</span>
                                    <span class="dates">${campaign.startDate} - ${campaign.endDate}</span>
                                </div>
                                <div class="campaign-platforms">
                                    ${campaign.platforms.map(p => `<span class="platform-tag">${p}</span>`).join('')}
                                </div>
                            </div>
                            <div class="campaign-actions">
                                <button onclick="editCampaign(${campaign.id}); closeModal();" class="btn btn-small btn-primary">Edit</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                    <button type="button" onclick="createCampaign(); closeModal();" class="btn btn-primary">New Campaign</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // CONTENT SCHEDULING FUNCTIONS
        function scheduleContent() {
            const campaigns = dataManager.getCampaigns();
            const campaignOptions = campaigns.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            const modalContent = `
                <h2>Schedule New Content</h2>
                <form id="contentForm" class="modal-form">
                    <div class="form-group">
                        <label for="contentTitle">Content Title *</label>
                        <input type="text" id="contentTitle" name="title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="contentDescription">Description</label>
                        <textarea id="contentDescription" name="description" rows="3" placeholder="Brief description of the content"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contentPlatform">Platform *</label>
                            <select id="contentPlatform" name="platform" required>
                                <option value="">Select Platform</option>
                                <option value="tiktok">TikTok</option>
                                <option value="instagram">Instagram</option>
                                <option value="snapchat">Snapchat</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contentType">Content Type *</label>
                            <select id="contentType" name="type" required>
                                <option value="">Select Type</option>
                                <option value="video">Video</option>
                                <option value="image">Image</option>
                                <option value="carousel">Carousel</option>
                                <option value="story">Story</option>
                                <option value="reel">Reel</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="scheduledDate">Scheduled Date *</label>
                            <input type="date" id="scheduledDate" name="scheduledDate" required>
                        </div>
                        <div class="form-group">
                            <label for="scheduledTime">Scheduled Time *</label>
                            <input type="time" id="scheduledTime" name="scheduledTime" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contentCampaign">Associated Campaign</label>
                        <select id="contentCampaign" name="campaignId">
                            <option value="">No Campaign</option>
                            ${campaignOptions}
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Schedule Content</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('scheduledDate').min = today;
            
            // Handle form submission
            document.getElementById('contentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveContentForm();
            });
        }

        function saveContentForm() {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('contentForm'));
            
            const content = {
                title: formData.get('title'),
                description: formData.get('description'),
                platform: formData.get('platform'),
                type: formData.get('type'),
                scheduledDate: formData.get('scheduledDate'),
                scheduledTime: formData.get('scheduledTime'),
                campaignId: formData.get('campaignId') ? parseInt(formData.get('campaignId')) : null,
                status: 'scheduled'
            };
            
            const rules = {
                title: { required: true, minLength: 3, maxLength: 200 },
                platform: { required: true },
                type: { required: true },
                scheduledDate: { required: true },
                scheduledTime: { required: true }
            };
            
            const errors = validateForm(content, rules);
            
            // Check if scheduled time is in the future
            const scheduledDateTime = new Date(content.scheduledDate + 'T' + content.scheduledTime);
            if (scheduledDateTime <= new Date()) {
                errors.scheduledTime = 'Scheduled time must be in the future';
            }
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Scheduling content...');
            
            setTimeout(() => {
                try {
                    dataManager.saveContent(content);
                    hideLoading();
                    closeModal();
                    showNotification('Content scheduled successfully!');
                    refreshDashboard();
                } catch (error) {
                    hideLoading();
                    showNotification('Error scheduling content: ' + error.message, 'error');
                }
            }, 1000);
        }

        function editContent(id) {
            const contentList = dataManager.getContent();
            const content = contentList.find(c => c.id === id);
            
            if (!content) {
                showNotification('Content not found', 'error');
                return;
            }
            
            const campaigns = dataManager.getCampaigns();
            const campaignOptions = campaigns.map(c => 
                `<option value="${c.id}" ${content.campaignId === c.id ? 'selected' : ''}>${c.name}</option>`
            ).join('');
            
            const modalContent = `
                <h2>Edit Content: ${content.title}</h2>
                <form id="editContentForm" class="modal-form">
                    <div class="form-group">
                        <label for="editContentTitle">Content Title *</label>
                        <input type="text" id="editContentTitle" name="title" value="${content.title}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editContentDescription">Description</label>
                        <textarea id="editContentDescription" name="description" rows="3">${content.description || ''}</textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editContentPlatform">Platform *</label>
                            <select id="editContentPlatform" name="platform" required>
                                <option value="tiktok" ${content.platform === 'tiktok' ? 'selected' : ''}>TikTok</option>
                                <option value="instagram" ${content.platform === 'instagram' ? 'selected' : ''}>Instagram</option>
                                <option value="snapchat" ${content.platform === 'snapchat' ? 'selected' : ''}>Snapchat</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editContentType">Content Type *</label>
                            <select id="editContentType" name="type" required>
                                <option value="video" ${content.type === 'video' ? 'selected' : ''}>Video</option>
                                <option value="image" ${content.type === 'image' ? 'selected' : ''}>Image</option>
                                <option value="carousel" ${content.type === 'carousel' ? 'selected' : ''}>Carousel</option>
                                <option value="story" ${content.type === 'story' ? 'selected' : ''}>Story</option>
                                <option value="reel" ${content.type === 'reel' ? 'selected' : ''}>Reel</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editScheduledDate">Scheduled Date *</label>
                            <input type="date" id="editScheduledDate" name="scheduledDate" value="${content.scheduledDate}" required>
                        </div>
                        <div class="form-group">
                            <label for="editScheduledTime">Scheduled Time *</label>
                            <input type="time" id="editScheduledTime" name="scheduledTime" value="${content.scheduledTime}" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editContentCampaign">Associated Campaign</label>
                            <select id="editContentCampaign" name="campaignId">
                                <option value="">No Campaign</option>
                                ${campaignOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editContentStatus">Status</label>
                            <select id="editContentStatus" name="status" required>
                                <option value="draft" ${content.status === 'draft' ? 'selected' : ''}>Draft</option>
                                <option value="scheduled" ${content.status === 'scheduled' ? 'selected' : ''}>Scheduled</option>
                                <option value="ready" ${content.status === 'ready' ? 'selected' : ''}>Ready</option>
                                <option value="processing" ${content.status === 'processing' ? 'selected' : ''}>Processing</option>
                                <option value="published" ${content.status === 'published' ? 'selected' : ''}>Published</option>
                                <option value="failed" ${content.status === 'failed' ? 'selected' : ''}>Failed</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="deleteContentConfirm(${content.id})" class="btn btn-danger">Delete</button>
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('editContentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateContent(content.id);
            });
        }

        function updateContent(id) {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('editContentForm'));
            const existingContent = dataManager.getContent().find(c => c.id === id);
            
            const updatedContent = {
                ...existingContent,
                title: formData.get('title'),
                description: formData.get('description'),
                platform: formData.get('platform'),
                type: formData.get('type'),
                scheduledDate: formData.get('scheduledDate'),
                scheduledTime: formData.get('scheduledTime'),
                campaignId: formData.get('campaignId') ? parseInt(formData.get('campaignId')) : null,
                status: formData.get('status')
            };
            
            const rules = {
                title: { required: true, minLength: 3, maxLength: 200 },
                platform: { required: true },
                type: { required: true },
                scheduledDate: { required: true },
                scheduledTime: { required: true },
                status: { required: true }
            };
            
            const errors = validateForm(updatedContent, rules);
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Updating content...');
            
            setTimeout(() => {
                try {
                    dataManager.saveContent(updatedContent);
                    hideLoading();
                    closeModal();
                    showNotification('Content updated successfully!');
                    refreshDashboard();
                } catch (error) {
                    hideLoading();
                    showNotification('Error updating content: ' + error.message, 'error');
                }
            }, 500);
        }

        function deleteContentConfirm(id) {
            const content = dataManager.getContent().find(c => c.id === id);
            if (!content) return;
            
            if (confirm(`Are you sure you want to delete the content "${content.title}"? This action cannot be undone.`)) {
                showLoading('Deleting content...');
                
                setTimeout(() => {
                    try {
                        dataManager.deleteContent(id);
                        hideLoading();
                        closeModal();
                        showNotification('Content deleted successfully!');
                        refreshDashboard();
                    } catch (error) {
                        hideLoading();
                        showNotification('Error deleting content: ' + error.message, 'error');
                    }
                }, 500);
            }
        }

        function generateContent() {
            scheduleContent(); // Use the same form for now
        }

        function viewCalendar() {
            const content = dataManager.getContent();
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            // Group content by date
            const contentByDate = {};
            content.forEach(item => {
                const date = item.scheduledDate;
                if (!contentByDate[date]) {
                    contentByDate[date] = [];
                }
                contentByDate[date].push(item);
            });
            
            // Sort dates
            const sortedDates = Object.keys(contentByDate).sort();
            
            const modalContent = `
                <h2>Content Calendar</h2>
                <div class="calendar-view">
                    ${sortedDates.map(date => {
                        const dateObj = new Date(date);
                        const isToday = date === today.toISOString().split('T')[0];
                        const dayContent = contentByDate[date];
                        
                        return `
                            <div class="calendar-day ${isToday ? 'today' : ''}">
                                <div class="calendar-date">
                                    <h4>${dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</h4>
                                </div>
                                <div class="calendar-content">
                                    ${dayContent.map(item => `
                                        <div class="calendar-item ${item.status}">
                                            <div class="item-time">${item.scheduledTime}</div>
                                            <div class="item-title">${item.title}</div>
                                            <div class="item-platform">${item.platform}</div>
                                            <button onclick="editContent(${item.id}); closeModal();" class="btn btn-small">Edit</button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                    <button type="button" onclick="scheduleContent(); closeModal();" class="btn btn-primary">New Content</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ANALYTICS DASHBOARD FUNCTIONS
        function viewAnalytics() {
            const modalContent = `
                <h2>Analytics Dashboard</h2>
                <div class="analytics-container">
                    <div class="analytics-filters">
                        <div class="filter-group">
                            <label>Date Range:</label>
                            <select id="dateRange" onchange="updateAnalytics()">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Platform:</label>
                            <select id="platformFilter" onchange="updateAnalytics()">
                                <option value="all">All Platforms</option>
                                <option value="tiktok">TikTok</option>
                                <option value="instagram">Instagram</option>
                                <option value="snapchat">Snapchat</option>
                            </select>
                        </div>
                        <button onclick="exportAnalytics()" class="btn btn-secondary">Export CSV</button>
                    </div>
                    
                    <div class="analytics-charts">
                        <div class="chart-container">
                            <h4>Performance Over Time</h4>
                            <canvas id="performanceChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h4>Platform Comparison</h4>
                            <canvas id="platformChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h4>Campaign ROI</h4>
                            <canvas id="roiChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="analytics-metrics">
                            <div class="metric-card">
                                <div class="metric-value" id="totalReach">0</div>
                                <div class="metric-label">Total Reach</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="avgEngagement">0%</div>
                                <div class="metric-label">Avg Engagement</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="totalConversions">0</div>
                                <div class="metric-label">Total Conversions</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="avgROI">0x</div>
                                <div class="metric-label">Average ROI</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                </div>
            `;
            
            showModal(modalContent);
            
            // Initialize charts after modal is shown
            setTimeout(() => {
                initializeAnalyticsCharts();
            }, 100);
        }

        let performanceChart, platformChart, roiChart;

        function initializeAnalyticsCharts() {
            const analytics = dataManager.getAnalytics();
            const campaigns = dataManager.getCampaigns();
            
            // Performance Over Time Chart
            const ctx1 = document.getElementById('performanceChart');
            if (ctx1) {
                const last30Days = analytics.slice(-30);
                
                performanceChart = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: last30Days.map(d => new Date(d.date).toLocaleDateString()),
                        datasets: [
                            {
                                label: 'Reach',
                                data: last30Days.map(d => d.reach),
                                borderColor: 'rgb(37, 99, 235)',
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                tension: 0.1
                            },
                            {
                                label: 'Engagement',
                                data: last30Days.map(d => d.engagement),
                                borderColor: 'rgb(16, 185, 129)',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.1
                            },
                            {
                                label: 'Conversions',
                                data: last30Days.map(d => d.conversions * 10), // Scale for visibility
                                borderColor: 'rgb(245, 158, 11)',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Platform Comparison Chart
            const ctx2 = document.getElementById('platformChart');
            if (ctx2) {
                const platformData = {
                    tiktok: { reach: 0, engagement: 0, conversions: 0 },
                    instagram: { reach: 0, engagement: 0, conversions: 0 },
                    snapchat: { reach: 0, engagement: 0, conversions: 0 }
                };
                
                analytics.forEach(d => {
                    if (platformData[d.platform]) {
                        platformData[d.platform].reach += d.reach;
                        platformData[d.platform].engagement += d.engagement;
                        platformData[d.platform].conversions += d.conversions;
                    }
                });
                
                platformChart = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: ['TikTok', 'Instagram', 'Snapchat'],
                        datasets: [
                            {
                                label: 'Reach',
                                data: [platformData.tiktok.reach, platformData.instagram.reach, platformData.snapchat.reach],
                                backgroundColor: 'rgba(37, 99, 235, 0.8)'
                            },
                            {
                                label: 'Engagement',
                                data: [platformData.tiktok.engagement, platformData.instagram.engagement, platformData.snapchat.engagement],
                                backgroundColor: 'rgba(16, 185, 129, 0.8)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // ROI Chart
            const ctx3 = document.getElementById('roiChart');
            if (ctx3) {
                roiChart = new Chart(ctx3, {
                    type: 'doughnut',
                    data: {
                        labels: campaigns.map(c => c.name),
                        datasets: [{
                            data: campaigns.map(c => c.roi || 0),
                            backgroundColor: [
                                'rgba(37, 99, 235, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(139, 92, 246, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            }
                        }
                    }
                });
            }

            updateAnalyticsMetrics();
        }

        function updateAnalytics() {
            const dateRange = parseInt(document.getElementById('dateRange').value);
            const platformFilter = document.getElementById('platformFilter').value;
            
            let analytics = dataManager.getAnalytics();
            
            // Filter by date range
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - dateRange);
            analytics = analytics.filter(d => new Date(d.date) >= cutoffDate);
            
            // Filter by platform
            if (platformFilter !== 'all') {
                analytics = analytics.filter(d => d.platform === platformFilter);
            }
            
            // Update performance chart
            if (performanceChart) {
                performanceChart.data.labels = analytics.map(d => new Date(d.date).toLocaleDateString());
                performanceChart.data.datasets[0].data = analytics.map(d => d.reach);
                performanceChart.data.datasets[1].data = analytics.map(d => d.engagement);
                performanceChart.data.datasets[2].data = analytics.map(d => d.conversions * 10);
                performanceChart.update();
            }
            
            // Update platform chart
            if (platformChart && platformFilter === 'all') {
                const platformData = {
                    tiktok: { reach: 0, engagement: 0 },
                    instagram: { reach: 0, engagement: 0 },
                    snapchat: { reach: 0, engagement: 0 }
                };
                
                analytics.forEach(d => {
                    if (platformData[d.platform]) {
                        platformData[d.platform].reach += d.reach;
                        platformData[d.platform].engagement += d.engagement;
                    }
                });
                
                platformChart.data.datasets[0].data = [platformData.tiktok.reach, platformData.instagram.reach, platformData.snapchat.reach];
                platformChart.data.datasets[1].data = [platformData.tiktok.engagement, platformData.instagram.engagement, platformData.snapchat.engagement];
                platformChart.update();
            }
            
            updateAnalyticsMetrics();
        }

        function updateAnalyticsMetrics() {
            const dateRange = parseInt(document.getElementById('dateRange')?.value || 30);
            const platformFilter = document.getElementById('platformFilter')?.value || 'all';
            
            let analytics = dataManager.getAnalytics();
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - dateRange);
            analytics = analytics.filter(d => new Date(d.date) >= cutoffDate);
            
            if (platformFilter !== 'all') {
                analytics = analytics.filter(d => d.platform === platformFilter);
            }
            
            const totalReach = analytics.reduce((sum, d) => sum + d.reach, 0);
            const totalEngagement = analytics.reduce((sum, d) => sum + d.engagement, 0);
            const totalConversions = analytics.reduce((sum, d) => sum + d.conversions, 0);
            const totalSpend = analytics.reduce((sum, d) => sum + d.spend, 0);
            
            const avgEngagement = analytics.length > 0 ? (totalEngagement / totalReach * 100).toFixed(1) : 0;
            const avgROI = totalSpend > 0 ? (totalConversions * 50 / totalSpend).toFixed(1) : 0; // Assume $50 per conversion
            
            const totalReachEl = document.getElementById('totalReach');
            const avgEngagementEl = document.getElementById('avgEngagement');
            const totalConversionsEl = document.getElementById('totalConversions');
            const avgROIEl = document.getElementById('avgROI');
            
            if (totalReachEl) totalReachEl.textContent = totalReach.toLocaleString();
            if (avgEngagementEl) avgEngagementEl.textContent = avgEngagement + '%';
            if (totalConversionsEl) totalConversionsEl.textContent = totalConversions.toLocaleString();
            if (avgROIEl) avgROIEl.textContent = avgROI + 'x';
        }

        function exportAnalytics() {
            const dateRange = parseInt(document.getElementById('dateRange').value);
            const platformFilter = document.getElementById('platformFilter').value;
            
            let analytics = dataManager.getAnalytics();
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - dateRange);
            analytics = analytics.filter(d => new Date(d.date) >= cutoffDate);
            
            if (platformFilter !== 'all') {
                analytics = analytics.filter(d => d.platform === platformFilter);
            }
            
            // Create CSV content
            const headers = ['Date', 'Platform', 'Reach', 'Engagement', 'Conversions', 'Spend'];
            const csvContent = [
                headers.join(','),
                ...analytics.map(row => [
                    row.date,
                    row.platform,
                    row.reach,
                    row.engagement,
                    row.conversions,
                    row.spend
                ].join(','))
            ].join('\\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analytics-${platformFilter}-${dateRange}days-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Analytics data exported successfully!');
        }

        // LEAD MANAGEMENT FUNCTIONS
        function manageLeads() {
            const leads = dataManager.getLeads();
            
            const modalContent = `
                <h2>Lead Management (${leads.length} leads)</h2>
                <div class="leads-container">
                    <div class="leads-toolbar">
                        <div class="search-group">
                            <input type="text" id="leadSearch" placeholder="Search leads..." onkeyup="filterLeads()">
                        </div>
                        <div class="filter-group">
                            <select id="statusFilter" onchange="filterLeads()">
                                <option value="all">All Status</option>
                                <option value="new">New</option>
                                <option value="contacted">Contacted</option>
                                <option value="qualified">Qualified</option>
                                <option value="converted">Converted</option>
                                <option value="lost">Lost</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <select id="sourceFilter" onchange="filterLeads()">
                                <option value="all">All Sources</option>
                                <option value="tiktok">TikTok</option>
                                <option value="instagram">Instagram</option>
                                <option value="snapchat">Snapchat</option>
                                <option value="website">Website</option>
                                <option value="referral">Referral</option>
                            </select>
                        </div>
                        <button onclick="exportLeads()" class="btn btn-secondary">Export CSV</button>
                    </div>
                    
                    <div class="leads-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="newLeadsCount">0</div>
                            <div class="stat-label">New Leads</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="qualifiedLeadsCount">0</div>
                            <div class="stat-label">Qualified</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="conversionRate">0%</div>
                            <div class="stat-label">Conversion Rate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgScore">0</div>
                            <div class="stat-label">Avg Score</div>
                        </div>
                    </div>
                    
                    <div class="leads-list" id="leadsList">
                        ${renderLeadsList(leads)}
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                    <button type="button" onclick="createLead()" class="btn btn-primary">New Lead</button>
                </div>
            `;
            
            showModal(modalContent);
            updateLeadsStats();
        }

        function renderLeadsList(leads) {
            if (leads.length === 0) {
                return '<div class="no-leads">No leads found matching the current filters.</div>';
            }
            
            return leads.map(lead => {
                const statusColor = {
                    'new': 'var(--warning)',
                    'contacted': 'var(--primary)',
                    'qualified': 'var(--success)',
                    'converted': 'var(--success)',
                    'lost': 'var(--error)'
                }[lead.status] || 'var(--text-muted)';
                
                const createdDate = new Date(lead.created).toLocaleDateString();
                const scoreColor = lead.score >= 80 ? 'var(--success)' : lead.score >= 60 ? 'var(--warning)' : 'var(--error)';
                
                return `
                    <div class="lead-item">
                        <div class="lead-info">
                            <div class="lead-header">
                                <h4>${lead.name}</h4>
                                <div class="lead-score" style="background: ${scoreColor}">${lead.score}</div>
                            </div>
                            <div class="lead-details">
                                <span class="lead-email">${lead.email}</span>
                                <span class="lead-phone">${lead.phone}</span>
                                <span class="lead-source source-${lead.source}">${lead.source.toUpperCase()}</span>
                                <span class="lead-date">${createdDate}</span>
                            </div>
                            <div class="lead-status" style="color: ${statusColor}">
                                ${lead.status.charAt(0).toUpperCase() + lead.status.slice(1)}
                            </div>
                            ${lead.notes ? `<div class="lead-notes">${lead.notes}</div>` : ''}
                        </div>
                        <div class="lead-actions">
                            <button onclick="editLead(${lead.id})" class="btn btn-small btn-primary">Edit</button>
                            <button onclick="deleteLead(${lead.id})" class="btn btn-small btn-danger">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterLeads() {
            const search = document.getElementById('leadSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const sourceFilter = document.getElementById('sourceFilter').value;
            
            let leads = dataManager.getLeads();
            
            // Apply filters
            if (search) {
                leads = leads.filter(lead => 
                    lead.name.toLowerCase().includes(search) ||
                    lead.email.toLowerCase().includes(search) ||
                    lead.phone.includes(search)
                );
            }
            
            if (statusFilter !== 'all') {
                leads = leads.filter(lead => lead.status === statusFilter);
            }
            
            if (sourceFilter !== 'all') {
                leads = leads.filter(lead => lead.source === sourceFilter);
            }
            
            const leadsList = document.getElementById('leadsList');
            if (leadsList) {
                leadsList.innerHTML = renderLeadsList(leads);
            }
            
            updateLeadsStats();
        }

        function updateLeadsStats() {
            const leads = dataManager.getLeads();
            const newLeads = leads.filter(l => l.status === 'new').length;
            const qualifiedLeads = leads.filter(l => l.status === 'qualified' || l.status === 'converted').length;
            const convertedLeads = leads.filter(l => l.status === 'converted').length;
            const conversionRate = leads.length > 0 ? (convertedLeads / leads.length * 100).toFixed(1) : 0;
            const avgScore = leads.length > 0 ? Math.round(leads.reduce((sum, l) => sum + l.score, 0) / leads.length) : 0;
            
            const newLeadsEl = document.getElementById('newLeadsCount');
            const qualifiedLeadsEl = document.getElementById('qualifiedLeadsCount');
            const conversionRateEl = document.getElementById('conversionRate');
            const avgScoreEl = document.getElementById('avgScore');
            
            if (newLeadsEl) newLeadsEl.textContent = newLeads;
            if (qualifiedLeadsEl) qualifiedLeadsEl.textContent = qualifiedLeads;
            if (conversionRateEl) conversionRateEl.textContent = conversionRate + '%';
            if (avgScoreEl) avgScoreEl.textContent = avgScore;
        }

        function createLead() {
            const campaigns = dataManager.getCampaigns();
            const campaignOptions = campaigns.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            const modalContent = `
                <h2>Create New Lead</h2>
                <form id="leadForm" class="modal-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadName">Full Name *</label>
                            <input type="text" id="leadName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="leadEmail">Email *</label>
                            <input type="email" id="leadEmail" name="email" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadPhone">Phone Number</label>
                            <input type="tel" id="leadPhone" name="phone">
                        </div>
                        <div class="form-group">
                            <label for="leadScore">Lead Score (0-100)</label>
                            <input type="number" id="leadScore" name="score" min="0" max="100" value="50">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadSource">Lead Source *</label>
                            <select id="leadSource" name="source" required>
                                <option value="">Select Source</option>
                                <option value="tiktok">TikTok</option>
                                <option value="instagram">Instagram</option>
                                <option value="snapchat">Snapchat</option>
                                <option value="website">Website</option>
                                <option value="referral">Referral</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="leadStatus">Status</label>
                            <select id="leadStatus" name="status">
                                <option value="new" selected>New</option>
                                <option value="contacted">Contacted</option>
                                <option value="qualified">Qualified</option>
                                <option value="converted">Converted</option>
                                <option value="lost">Lost</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="leadCampaign">Associated Campaign</label>
                        <select id="leadCampaign" name="campaignId">
                            <option value="">No Campaign</option>
                            ${campaignOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="leadNotes">Notes</label>
                        <textarea id="leadNotes" name="notes" rows="3" placeholder="Any additional information about this lead"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Lead</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('leadForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveLeadForm();
            });
        }

        function saveLeadForm() {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('leadForm'));
            
            const lead = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                score: parseInt(formData.get('score')) || 50,
                source: formData.get('source'),
                status: formData.get('status') || 'new',
                campaignId: formData.get('campaignId') ? parseInt(formData.get('campaignId')) : null,
                notes: formData.get('notes')
            };
            
            const rules = {
                name: { required: true, minLength: 2, maxLength: 100 },
                email: { required: true, pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/, message: 'Please enter a valid email address' },
                source: { required: true },
                score: { min: 0, max: 100 }
            };
            
            const errors = validateForm(lead, rules);
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Creating lead...');
            
            setTimeout(() => {
                try {
                    dataManager.saveLead(lead);
                    hideLoading();
                    closeModal();
                    showNotification('Lead created successfully!');
                    // Re-open lead management to show updated list
                    setTimeout(() => manageLeads(), 500);
                } catch (error) {
                    hideLoading();
                    showNotification('Error creating lead: ' + error.message, 'error');
                }
            }, 1000);
        }

        function editLead(id) {
            const leads = dataManager.getLeads();
            const lead = leads.find(l => l.id === id);
            
            if (!lead) {
                showNotification('Lead not found', 'error');
                return;
            }
            
            const campaigns = dataManager.getCampaigns();
            const campaignOptions = campaigns.map(c => 
                `<option value="${c.id}" ${lead.campaignId === c.id ? 'selected' : ''}>${c.name}</option>`
            ).join('');
            
            const modalContent = `
                <h2>Edit Lead: ${lead.name}</h2>
                <form id="editLeadForm" class="modal-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editLeadName">Full Name *</label>
                            <input type="text" id="editLeadName" name="name" value="${lead.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="editLeadEmail">Email *</label>
                            <input type="email" id="editLeadEmail" name="email" value="${lead.email}" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editLeadPhone">Phone Number</label>
                            <input type="tel" id="editLeadPhone" name="phone" value="${lead.phone || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editLeadScore">Lead Score (0-100)</label>
                            <input type="number" id="editLeadScore" name="score" min="0" max="100" value="${lead.score}">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editLeadSource">Lead Source *</label>
                            <select id="editLeadSource" name="source" required>
                                <option value="tiktok" ${lead.source === 'tiktok' ? 'selected' : ''}>TikTok</option>
                                <option value="instagram" ${lead.source === 'instagram' ? 'selected' : ''}>Instagram</option>
                                <option value="snapchat" ${lead.source === 'snapchat' ? 'selected' : ''}>Snapchat</option>
                                <option value="website" ${lead.source === 'website' ? 'selected' : ''}>Website</option>
                                <option value="referral" ${lead.source === 'referral' ? 'selected' : ''}>Referral</option>
                                <option value="other" ${lead.source === 'other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editLeadStatus">Status</label>
                            <select id="editLeadStatus" name="status">
                                <option value="new" ${lead.status === 'new' ? 'selected' : ''}>New</option>
                                <option value="contacted" ${lead.status === 'contacted' ? 'selected' : ''}>Contacted</option>
                                <option value="qualified" ${lead.status === 'qualified' ? 'selected' : ''}>Qualified</option>
                                <option value="converted" ${lead.status === 'converted' ? 'selected' : ''}>Converted</option>
                                <option value="lost" ${lead.status === 'lost' ? 'selected' : ''}>Lost</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editLeadCampaign">Associated Campaign</label>
                        <select id="editLeadCampaign" name="campaignId">
                            <option value="">No Campaign</option>
                            ${campaignOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editLeadNotes">Notes</label>
                        <textarea id="editLeadNotes" name="notes" rows="3">${lead.notes || ''}</textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="deleteLeadConfirm(${lead.id})" class="btn btn-danger">Delete</button>
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('editLeadForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateLead(lead.id);
            });
        }

        function updateLead(id) {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('editLeadForm'));
            const existingLead = dataManager.getLeads().find(l => l.id === id);
            
            const updatedLead = {
                ...existingLead,
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                score: parseInt(formData.get('score')) || 50,
                source: formData.get('source'),
                status: formData.get('status'),
                campaignId: formData.get('campaignId') ? parseInt(formData.get('campaignId')) : null,
                notes: formData.get('notes')
            };
            
            const rules = {
                name: { required: true, minLength: 2, maxLength: 100 },
                email: { required: true, pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/, message: 'Please enter a valid email address' },
                source: { required: true },
                score: { min: 0, max: 100 }
            };
            
            const errors = validateForm(updatedLead, rules);
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Updating lead...');
            
            setTimeout(() => {
                try {
                    dataManager.saveLead(updatedLead);
                    hideLoading();
                    closeModal();
                    showNotification('Lead updated successfully!');
                    setTimeout(() => manageLeads(), 500);
                } catch (error) {
                    hideLoading();
                    showNotification('Error updating lead: ' + error.message, 'error');
                }
            }, 500);
        }

        function deleteLeadConfirm(id) {
            const lead = dataManager.getLeads().find(l => l.id === id);
            if (!lead) return;
            
            if (confirm(`Are you sure you want to delete the lead "${lead.name}"? This action cannot be undone.`)) {
                showLoading('Deleting lead...');
                
                setTimeout(() => {
                    try {
                        dataManager.deleteLead(id);
                        hideLoading();
                        closeModal();
                        showNotification('Lead deleted successfully!');
                        setTimeout(() => manageLeads(), 500);
                    } catch (error) {
                        hideLoading();
                        showNotification('Error deleting lead: ' + error.message, 'error');
                    }
                }, 500);
            }
        }

        function deleteLead(id) {
            deleteLeadConfirm(id);
        }

        function viewLeads() {
            manageLeads();
        }

        function exportLeads() {
            const statusFilter = document.getElementById('statusFilter')?.value || 'all';
            const sourceFilter = document.getElementById('sourceFilter')?.value || 'all';
            
            let leads = dataManager.getLeads();
            
            if (statusFilter !== 'all') {
                leads = leads.filter(lead => lead.status === statusFilter);
            }
            
            if (sourceFilter !== 'all') {
                leads = leads.filter(lead => lead.source === sourceFilter);
            }
            
            // Create CSV content
            const headers = ['Name', 'Email', 'Phone', 'Source', 'Status', 'Score', 'Created', 'Notes'];
            const csvContent = [
                headers.join(','),
                ...leads.map(row => [
                    `"${row.name}"`,
                    row.email,
                    row.phone || '',
                    row.source,
                    row.status,
                    row.score,
                    new Date(row.created).toLocaleDateString(),
                    `"${(row.notes || '').replace(/"/g, '""')}"`
                ].join(','))
            ].join('\\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `leads-${statusFilter}-${sourceFilter}-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Lead data exported successfully!');
        }

        // AUTOMATION MANAGEMENT FUNCTIONS
        function configureAutomation(type) {
            const automations = dataManager.getAutomations();
            let automation = null;
            
            if (type) {
                automation = automations.find(a => a.type === type);
            }
            
            const modalContent = `
                <h2>${type ? `Configure ${type.charAt(0).toUpperCase() + type.slice(1)} Automation` : 'Automation Center'}</h2>
                <div class="automation-container">
                    ${type ? renderAutomationConfig(automation) : renderAutomationList(automations)}
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                    ${!type ? '<button type="button" onclick="createAutomation()" class="btn btn-primary">New Automation</button>' : ''}
                </div>
            `;
            
            showModal(modalContent);
        }

        function renderAutomationList(automations) {
            return `
                <div class="automation-stats">
                    <div class="stat-card">
                        <div class="stat-value">${automations.filter(a => a.status === 'active').length}</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${automations.filter(a => a.status === 'paused').length}</div>
                        <div class="stat-label">Paused</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${automations.length}</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>
                
                <div class="automation-list">
                    ${automations.map(automation => {
                        const statusColor = automation.status === 'active' ? 'var(--success)' : 'var(--warning)';
                        const lastRun = new Date(automation.lastRun).toLocaleString();
                        
                        return `
                            <div class="automation-item">
                                <div class="automation-info">
                                    <div class="automation-header">
                                        <h4>${automation.name}</h4>
                                        <div class="automation-status" style="color: ${statusColor}">
                                            ${automation.status.charAt(0).toUpperCase() + automation.status.slice(1)}
                                        </div>
                                    </div>
                                    <div class="automation-details">
                                        <span class="automation-type">${automation.type.toUpperCase()}</span>
                                        <span class="automation-last-run">Last run: ${lastRun}</span>
                                    </div>
                                    <div class="automation-rules">${automation.rules}</div>
                                </div>
                                <div class="automation-actions">
                                    <button onclick="toggleAutomation(${automation.id})" class="btn btn-small ${automation.status === 'active' ? 'btn-secondary' : 'btn-primary'}">
                                        ${automation.status === 'active' ? 'Pause' : 'Start'}
                                    </button>
                                    <button onclick="editAutomation(${automation.id})" class="btn btn-small btn-secondary">Edit</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderAutomationConfig(automation) {
            if (!automation) return '<div class="no-automation">Automation not found.</div>';
            
            return `
                <form id="automationConfigForm" class="modal-form">
                    <div class="form-group">
                        <label for="automationName">Automation Name *</label>
                        <input type="text" id="automationName" name="name" value="${automation.name}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="automationRules">Rules & Description *</label>
                        <textarea id="automationRules" name="rules" rows="3" required>${automation.rules}</textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="automationStatus">Status</label>
                            <select id="automationStatus" name="status">
                                <option value="active" ${automation.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="paused" ${automation.status === 'paused' ? 'selected' : ''}>Paused</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="automationEnabled">Enabled</label>
                            <select id="automationEnabled" name="enabled">
                                <option value="true" ${automation.enabled ? 'selected' : ''}>Yes</option>
                                <option value="false" ${!automation.enabled ? 'selected' : ''}>No</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="automation-logs">
                        <h4>Recent Activity</h4>
                        <div class="log-entries">
                            <div class="log-entry">
                                <span class="log-time">${new Date(automation.lastRun).toLocaleString()}</span>
                                <span class="log-message">Automation executed successfully</span>
                                <span class="log-status success">Success</span>
                            </div>
                            <div class="log-entry">
                                <span class="log-time">${new Date(Date.now() - 60*60*1000).toLocaleString()}</span>
                                <span class="log-message">Processing ${automation.type} automation rules</span>
                                <span class="log-status info">Info</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="testAutomation(${automation.id})" class="btn btn-secondary">Test Run</button>
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            `;
        }

        function toggleAutomation(id) {
            const automations = dataManager.getAutomations();
            const automation = automations.find(a => a.id === id);
            
            if (!automation) return;
            
            automation.status = automation.status === 'active' ? 'paused' : 'active';
            automation.enabled = automation.status === 'active';
            
            dataManager.saveAutomation(automation);
            showNotification(`Automation ${automation.status === 'active' ? 'started' : 'paused'} successfully!`);
            
            // Refresh the modal if it's open
            setTimeout(() => configureAutomation(), 500);
        }

        function editAutomation(id) {
            const automations = dataManager.getAutomations();
            const automation = automations.find(a => a.id === id);
            
            if (!automation) return;
            
            configureAutomation(automation.type);
        }

        function testAutomation(id) {
            showLoading('Running automation test...');
            
            setTimeout(() => {
                hideLoading();
                showNotification('Automation test completed successfully!');
            }, 2000);
        }

        function startAutomation(type) {
            const automations = dataManager.getAutomations();
            const automation = automations.find(a => a.type === type);
            
            if (automation) {
                automation.status = 'active';
                automation.enabled = true;
                automation.lastRun = new Date().toISOString();
                
                dataManager.saveAutomation(automation);
                showNotification('Automation started successfully!');
                refreshDashboard();
            }
        }

        function viewLogs() {
            const automations = dataManager.getAutomations();
            
            const modalContent = `
                <h2>System Logs</h2>
                <div class="logs-container">
                    <div class="logs-filters">
                        <select id="logTypeFilter" onchange="filterLogs()">
                            <option value="all">All Types</option>
                            <option value="content">Content</option>
                            <option value="schedule">Schedule</option>
                            <option value="leads">Leads</option>
                            <option value="performance">Performance</option>
                        </select>
                        <select id="logLevelFilter" onchange="filterLogs()">
                            <option value="all">All Levels</option>
                            <option value="info">Info</option>
                            <option value="success">Success</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                        </select>
                    </div>
                    
                    <div class="logs-list" id="logsList">
                        ${generateLogEntries()}
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="exportLogs()" class="btn btn-secondary">Export Logs</button>
                    <button type="button" onclick="clearLogs()" class="btn btn-danger">Clear Logs</button>
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        function generateLogEntries() {
            const logEntries = [];
            const now = new Date();
            
            // Generate sample log entries
            for (let i = 0; i < 20; i++) {
                const time = new Date(now.getTime() - (i * 30 * 60 * 1000));
                const types = ['content', 'schedule', 'leads', 'performance'];
                const levels = ['info', 'success', 'warning', 'error'];
                const messages = [
                    'Content generation completed',
                    'Scheduled post published',
                    'New lead qualified',
                    'Performance optimization running',
                    'Email campaign sent',
                    'Analytics data updated',
                    'Budget alert triggered',
                    'Campaign paused automatically'
                ];
                
                const type = types[Math.floor(Math.random() * types.length)];
                const level = levels[Math.floor(Math.random() * levels.length)];
                const message = messages[Math.floor(Math.random() * messages.length)];
                
                logEntries.push(`
                    <div class="log-entry" data-type="${type}" data-level="${level}">
                        <span class="log-time">${time.toLocaleString()}</span>
                        <span class="log-message">${message}</span>
                        <span class="log-type">${type.toUpperCase()}</span>
                        <span class="log-status ${level}">${level.charAt(0).toUpperCase() + level.slice(1)}</span>
                    </div>
                `);
            }
            
            return logEntries.join('');
        }

        function filterLogs() {
            const typeFilter = document.getElementById('logTypeFilter').value;
            const levelFilter = document.getElementById('logLevelFilter').value;
            const logEntries = document.querySelectorAll('.log-entry');
            
            logEntries.forEach(entry => {
                const type = entry.dataset.type;
                const level = entry.dataset.level;
                
                const showType = typeFilter === 'all' || type === typeFilter;
                const showLevel = levelFilter === 'all' || level === levelFilter;
                
                entry.style.display = (showType && showLevel) ? 'flex' : 'none';
            });
        }

        function exportLogs() {
            showNotification('Log export functionality would export system logs to a file.');
        }

        function clearLogs() {
            if (confirm('Are you sure you want to clear all logs? This action cannot be undone.')) {
                document.getElementById('logsList').innerHTML = '<div class="no-logs">No log entries found.</div>';
                showNotification('Logs cleared successfully!');
            }
        }

        // EXPORT/IMPORT DATA FUNCTIONS
        function exportData() {
            showLoading('Preparing data export...');
            
            setTimeout(() => {
                try {
                    dataManager.exportData();
                    hideLoading();
                    showNotification('Data exported successfully!');
                } catch (error) {
                    hideLoading();
                    showNotification('Error exporting data: ' + error.message, 'error');
                }
            }, 1000);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    showLoading('Importing data...');
                    
                    dataManager.importData(file)
                        .then(() => {
                            hideLoading();
                            showNotification('Data imported successfully!');
                            refreshDashboard();
                        })
                        .catch(error => {
                            hideLoading();
                            showNotification('Error importing data: ' + error.message, 'error');
                        });
                }
            };
            input.click();
        }

        // REPORT GENERATION FUNCTIONS
        function generateReport(type) {
            showLoading(`Generating ${type} report...`);
            
            setTimeout(() => {
                const reportData = generateReportData(type);
                downloadReport(reportData, type);
                hideLoading();
                showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} report generated successfully!`);
            }, 2000);
        }

        function generateReportData(type) {
            const campaigns = dataManager.getCampaigns();
            const content = dataManager.getContent();
            const leads = dataManager.getLeads();
            const analytics = dataManager.getAnalytics();
            
            switch (type) {
                case 'weekly':
                    return {
                        type: 'Weekly Performance Report',
                        period: 'Last 7 days',
                        campaigns: campaigns.filter(c => c.status === 'active').length,
                        content: content.filter(c => c.status === 'published').length,
                        leads: leads.length,
                        totalReach: analytics.slice(-7).reduce((sum, a) => sum + a.reach, 0),
                        totalEngagement: analytics.slice(-7).reduce((sum, a) => sum + a.engagement, 0)
                    };
                
                case 'leads':
                    return {
                        type: 'Lead Analysis Report',
                        totalLeads: leads.length,
                        newLeads: leads.filter(l => l.status === 'new').length,
                        qualifiedLeads: leads.filter(l => l.status === 'qualified').length,
                        convertedLeads: leads.filter(l => l.status === 'converted').length,
                        conversionRate: leads.length > 0 ? (leads.filter(l => l.status === 'converted').length / leads.length * 100).toFixed(2) : 0,
                        avgScore: leads.length > 0 ? (leads.reduce((sum, l) => sum + l.score, 0) / leads.length).toFixed(1) : 0
                    };
                
                case 'roi':
                    const totalSpent = campaigns.reduce((sum, c) => sum + c.spent, 0);
                    const totalRevenue = leads.filter(l => l.status === 'converted').length * 100; // Assume $100 per conversion
                    
                    return {
                        type: 'ROI Analysis Report',
                        totalSpent: totalSpent,
                        totalRevenue: totalRevenue,
                        roi: totalSpent > 0 ? ((totalRevenue - totalSpent) / totalSpent * 100).toFixed(2) : 0,
                        campaigns: campaigns.map(c => ({
                            name: c.name,
                            spent: c.spent,
                            roi: c.roi
                        }))
                    };
                
                case 'comprehensive':
                    return {
                        type: 'Comprehensive Marketing Report',
                        campaigns: campaigns.length,
                        activeCampaigns: campaigns.filter(c => c.status === 'active').length,
                        totalBudget: campaigns.reduce((sum, c) => sum + c.budget, 0),
                        totalSpent: campaigns.reduce((sum, c) => sum + c.spent, 0),
                        totalContent: content.length,
                        publishedContent: content.filter(c => c.status === 'published').length,
                        totalLeads: leads.length,
                        qualifiedLeads: leads.filter(l => l.status === 'qualified' || l.status === 'converted').length,
                        totalReach: analytics.reduce((sum, a) => sum + a.reach, 0),
                        totalEngagement: analytics.reduce((sum, a) => sum + a.engagement, 0)
                    };
                
                default:
                    return { type: 'Unknown Report', error: 'Report type not recognized' };
            }
        }

        function downloadReport(data, type) {
            const reportContent = `
MARKETING DASHBOARD REPORT
Generated: ${new Date().toLocaleString()}
Report Type: ${data.type}

${Object.entries(data).map(([key, value]) => {
    if (key === 'type') return '';
    if (Array.isArray(value)) {
        return `${key.toUpperCase()}:\n${value.map(item => 
            typeof item === 'object' ? 
            Object.entries(item).map(([k, v]) => `  ${k}: ${v}`).join('\n') :
            `  - ${item}`
        ).join('\n')}`;
    }
    return `${key.replace(/([A-Z])/g, ' $1').toUpperCase()}: ${value}`;
}).filter(Boolean).join('\n\n')}

--
Generated by BrainSAIT Marketing Dashboard
            `;
            
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${type}-report-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function scheduleReports() {
            const modalContent = `
                <h2>Schedule Reports</h2>
                <form id="scheduleReportsForm" class="modal-form">
                    <div class="form-group">
                        <label>Report Types</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="reportTypes" value="weekly"> Weekly Performance</label>
                            <label><input type="checkbox" name="reportTypes" value="leads"> Lead Analysis</label>
                            <label><input type="checkbox" name="reportTypes" value="roi"> ROI Analysis</label>
                            <label><input type="checkbox" name="reportTypes" value="comprehensive"> Comprehensive</label>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportFrequency">Frequency</label>
                            <select id="reportFrequency" name="frequency">
                                <option value="daily">Daily</option>
                                <option value="weekly" selected>Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportTime">Time</label>
                            <input type="time" id="reportTime" name="time" value="09:00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportEmail">Email Recipients</label>
                        <input type="email" id="reportEmail" name="email" placeholder="Enter email addresses separated by commas">
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Schedule Reports</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('scheduleReportsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                showLoading('Scheduling reports...');
                
                setTimeout(() => {
                    hideLoading();
                    closeModal();
                    showNotification('Reports scheduled successfully!');
                }, 1000);
            });
        }
</body>
</html>