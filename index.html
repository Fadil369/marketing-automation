<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrainSAIT Marketing Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Simplified color palette - functional only */
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            
            --border: #e5e7eb;
            --border-light: #f3f4f6;
            
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --radius: 6px;
        }

        /* Dark mode - simplified */
        [data-theme="dark"] {
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-tertiary: #374151;
            
            --border: #374151;
            --border-light: #4b5563;
        }

        [data-theme="dark"] body {
            background: var(--bg-secondary);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 14px;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        .header {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            border-top: 3px solid var(--primary);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 13px;
            font-weight: 500;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
            flex-shrink: 0;
        }

        /* Main action buttons - prioritize core functionality */
        .primary-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 20px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--primary);
            border-radius: var(--radius);
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            min-height: 100px;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-1px);
        }

        .action-btn .icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        /* Simplified table for campaign data */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }

        .data-table th,
        .data-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
            font-size: 13px;
        }

        .data-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-secondary);
        }

        .data-table tr:hover {
            background: var(--bg-secondary);
        }

        .platform-selector {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: var(--radius);
            padding: 4px;
            margin-bottom: 16px;
        }

        .platform-btn {
            flex: 1;
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .platform-btn.active {
            background: var(--bg-primary);
            color: var(--text-primary);
            box-shadow: var(--shadow);
        }

        .platform-btn:hover:not(.active) {
            color: var(--text-primary);
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .metric {
            text-align: center;
            padding: 16px 12px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
        }

        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .btn {
            padding: 10px 16px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            border: 1px solid transparent;
            min-height: 36px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            min-height: 28px;
        }

        /* Simple controls panel */
        .controls-panel {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 1000;
            display: flex;
            gap: 8px;
        }

        .theme-toggle {
            padding: 8px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 12px;
        }

        .notification {
            position: fixed;
            top: 70px;
            right: 16px;
            background: var(--success);
            color: white;
            padding: 12px 16px;
            border-radius: var(--radius);
            font-size: 13px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 12px;
            }
            
            .header {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .primary-actions {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .action-btn {
                flex-direction: row;
                text-align: left;
                min-height: 60px;
                padding: 16px;
            }
            
            .action-btn .icon {
                margin-bottom: 0;
                margin-right: 12px;
                font-size: 20px;
            }
            
            .grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .card {
                padding: 16px;
            }
            
            .status-bar {
                grid-template-columns: 1fr;
            }
            
            .metric-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .platform-selector {
                flex-direction: column;
            }
            
            .platform-btn {
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .metric-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Accessibility - high contrast and clear focus */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        button:focus-visible,
        .platform-btn:focus-visible,
        .btn:focus-visible,
        .action-btn:focus-visible {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .card, .action-btn {
                border-width: 2px;
            }
            
            .btn-primary {
                background: var(--primary-dark);
            }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        .modal {
            background: var(--bg-primary);
            border-radius: var(--radius);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-content {
            padding: 20px;
            overflow-y: auto;
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group input.error,
        .form-group select.error,
        .form-group textarea.error {
            border-color: var(--error);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            cursor: pointer;
        }

        .field-error {
            color: var(--error);
            font-size: 12px;
            margin-top: -4px;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .btn-danger {
            background: var(--error);
            color: white;
            margin-right: auto;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Loading Styles */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
        }

        .loading-spinner {
            background: var(--bg-primary);
            padding: 30px;
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Campaign List Styles */
        .campaigns-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .campaign-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 12px;
        }

        .campaign-info h4 {
            margin: 0 0 8px 0;
            color: var(--text-primary);
        }

        .campaign-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .campaign-meta span {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--bg-secondary);
        }

        .status.active {
            background: var(--success);
            color: white;
        }

        .status.paused {
            background: var(--warning);
            color: white;
        }

        .status.draft {
            background: var(--text-muted);
            color: white;
        }

        .campaign-platforms {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .platform-tag {
            font-size: 11px;
            padding: 2px 6px;
            background: var(--primary);
            color: white;
            border-radius: 3px;
        }

        /* Calendar Styles */
        .calendar-view {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .calendar-day {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .calendar-day.today {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .calendar-date {
            background: var(--bg-secondary);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .calendar-date h4 {
            margin: 0;
            color: var(--text-primary);
            font-size: 14px;
        }

        .calendar-content {
            padding: 12px;
        }

        .calendar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
            background: var(--bg-secondary);
        }

        .calendar-item:last-child {
            margin-bottom: 0;
        }

        .calendar-item.ready {
            border-left: 3px solid var(--success);
        }

        .calendar-item.scheduled {
            border-left: 3px solid var(--text-muted);
        }

        .calendar-item.processing {
            border-left: 3px solid var(--warning);
        }

        .calendar-item.published {
            border-left: 3px solid var(--primary);
        }

        .calendar-item.failed {
            border-left: 3px solid var(--error);
        }

        .item-time {
            font-weight: 600;
            color: var(--text-primary);
            min-width: 50px;
        }

        .item-title {
            flex: 1;
            color: var(--text-primary);
            font-size: 13px;
        }

        .item-platform {
            font-size: 11px;
            padding: 2px 6px;
            background: var(--primary);
            color: white;
            border-radius: 3px;
            text-transform: capitalize;
        }

        /* Analytics Styles */
        .analytics-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .analytics-filters {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .filter-group select {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 13px;
        }

        .analytics-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .chart-container {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
        }

        .chart-container h4 {
            margin: 0 0 16px 0;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
        }

        .chart-container:nth-child(3) {
            grid-column: span 2;
        }

        .analytics-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            grid-column: span 2;
        }

        .metric-card {
            text-align: center;
            padding: 20px 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .metric-card .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .metric-card .metric-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .analytics-charts {
                grid-template-columns: 1fr;
            }
            
            .chart-container:nth-child(3) {
                grid-column: span 1;
            }
            
            .analytics-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .analytics-metrics {
                grid-column: span 1;
            }
        }

        /* Lead Management Styles */
        .leads-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .leads-toolbar {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            flex-wrap: wrap;
        }

        .search-group {
            flex: 1;
            min-width: 200px;
        }

        .search-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .leads-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            text-align: center;
            padding: 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .stat-card .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-card .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .leads-list {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .lead-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-primary);
        }

        .lead-item:last-child {
            border-bottom: none;
        }

        .lead-item:hover {
            background: var(--bg-secondary);
        }

        .lead-info {
            flex: 1;
        }

        .lead-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .lead-header h4 {
            margin: 0;
            color: var(--text-primary);
            font-size: 16px;
        }

        .lead-score {
            padding: 4px 8px;
            border-radius: 12px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .lead-details {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 8px;
        }

        .lead-details span {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .lead-email {
            color: var(--primary) !important;
        }

        .lead-source {
            padding: 2px 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            font-size: 11px !important;
            font-weight: 600;
        }

        .source-tiktok {
            background: #ff0050;
            color: white !important;
        }

        .source-instagram {
            background: #e4405f;
            color: white !important;
        }

        .source-snapchat {
            background: #fffc00;
            color: black !important;
        }

        .source-website {
            background: var(--primary);
            color: white !important;
        }

        .source-referral {
            background: var(--success);
            color: white !important;
        }

        .lead-status {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .lead-notes {
            font-size: 13px;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 8px;
        }

        .lead-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .no-leads {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .leads-toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .leads-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .lead-item {
                flex-direction: column;
                gap: 12px;
            }
            
            .lead-actions {
                align-self: stretch;
                justify-content: flex-end;
            }
            
            .lead-details {
                flex-direction: column;
                gap: 4px;
            }
        }

        /* Automation and Logs Styles */
        .automation-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .automation-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .automation-list {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .automation-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-primary);
        }

        .automation-item:last-child {
            border-bottom: none;
        }

        .automation-item:hover {
            background: var(--bg-secondary);
        }

        .automation-info {
            flex: 1;
        }

        .automation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .automation-header h4 {
            margin: 0;
            color: var(--text-primary);
        }

        .automation-status {
            font-weight: 600;
            font-size: 13px;
        }

        .automation-details {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }

        .automation-type {
            padding: 2px 6px;
            background: var(--primary);
            color: white;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
        }

        .automation-last-run {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .automation-rules {
            font-size: 13px;
            color: var(--text-muted);
        }

        .automation-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .automation-logs {
            margin: 20px 0;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            background: var(--bg-secondary);
        }

        .automation-logs h4 {
            margin: 0 0 12px 0;
            color: var(--text-primary);
        }

        .log-entries {
            max-height: 200px;
            overflow-y: auto;
        }

        .logs-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .logs-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
        }

        .logs-filters select {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .logs-list {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .log-entry {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-primary);
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 150px;
        }

        .log-message {
            flex: 1;
            font-size: 13px;
            color: var(--text-primary);
        }

        .log-type {
            font-size: 11px;
            padding: 2px 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .log-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            min-width: 60px;
        }

        .log-status.info {
            background: var(--primary);
            color: white;
        }

        .log-status.success {
            background: var(--success);
            color: white;
        }

        .log-status.warning {
            background: var(--warning);
            color: white;
        }

        .log-status.error {
            background: var(--error);
            color: white;
        }

        .no-logs {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .automation-stats {
                grid-template-columns: 1fr;
            }
            
            .automation-item {
                flex-direction: column;
                gap: 12px;
            }
            
            .automation-actions {
                align-self: stretch;
                justify-content: flex-end;
            }
            
            .log-entry {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .log-time {
                min-width: auto;
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *, .spinner {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Print styles */
        @media print {
            .controls-panel,
            .notification,
            .modal-overlay,
            .loading-overlay {
                display: none;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .card {
                break-inside: avoid;
                box-shadow: none;
            }
        }

        /* Mobile Modal Styles */
        @media (max-width: 768px) {
            .modal-overlay {
                padding: 10px;
            }
            
            .modal {
                max-height: 95vh;
            }
            
            .modal-content {
                padding: 16px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="controls-panel">
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
            <span id="themeIcon">🌙</span>
        </button>
        <button class="theme-toggle" onclick="toggleLanguage()" aria-label="Toggle language">
            <span id="langToggleText">العربية</span>
        </button>
    </div>

    <div class="notification" id="notification">
        <span id="notificationText">Action completed!</span>
    </div>

    <div class="dashboard-container">
        <!-- Header Section -->
        <div class="header">
            <h1 id="mainTitle">BrainSAIT Marketing Dashboard</h1>
            <p id="subtitle">Simplified campaign management for Spark Solo & BrainSAIT Solutions</p>
            
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span id="automationStatus">Automation Active</span>
                </div>
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span id="campaignStatus">3 Active Campaigns</span>
                </div>
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span id="contentStatus">47 Scheduled Posts</span>
                </div>
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span id="leadStatus">128 New Leads</span>
                </div>
            </div>
        </div>

        <!-- Primary Actions - Core Functionality -->
        <div class="primary-actions">
            <a href="#" class="action-btn" onclick="createCampaign()">
                <div class="icon">📈</div>
                <div>Create Campaign</div>
            </a>
            <a href="#" class="action-btn" onclick="scheduleContent()">
                <div class="icon">📅</div>
                <div>Schedule Content</div>
            </a>
            <a href="#" class="action-btn" onclick="viewAnalytics()">
                <div class="icon">📊</div>
                <div>View Analytics</div>
            </a>
            <a href="#" class="action-btn" onclick="manageLeads()">
                <div class="icon">👥</div>
                <div>Manage Leads</div>
            </a>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="grid">
            <!-- Active Campaigns -->
            <div class="card">
                <h3>Active Campaigns</h3>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Campaign</th>
                            <th>Status</th>
                            <th>Budget</th>
                            <th>Performance</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Spark Solo Launch</td>
                            <td><span style="color: var(--success); font-weight: 600;">Active</span></td>
                            <td>$2,500</td>
                            <td>73% to goal</td>
                            <td><button class="btn btn-small btn-secondary" onclick="editCampaign(1)">Edit</button></td>
                        </tr>
                        <tr>
                            <td>Brand Awareness MENA</td>
                            <td><span style="color: var(--warning); font-weight: 600;">Optimizing</span></td>
                            <td>$1,800</td>
                            <td>45% to goal</td>
                            <td><button class="btn btn-small btn-secondary" onclick="editCampaign(2)">Edit</button></td>
                        </tr>
                        <tr>
                            <td>Retargeting Q4</td>
                            <td><span style="color: var(--text-muted); font-weight: 600;">Scheduled</span></td>
                            <td>$1,200</td>
                            <td>Starts in 3 days</td>
                            <td><button class="btn btn-small btn-secondary" onclick="editCampaign(3)">Edit</button></td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="createCampaign()">New Campaign</button>
                    <button class="btn btn-secondary" onclick="viewAllCampaigns()">View All</button>
                </div>
            </div>
            
            <!-- Platform Performance -->
            <div class="card">
                <h3 id="platformPerformanceTitle">Platform Performance</h3>
                
                <div class="platform-selector">
                    <button class="platform-btn active" onclick="selectPlatform('all')">All</button>
                    <button class="platform-btn" onclick="selectPlatform('tiktok')">TikTok</button>
                    <button class="platform-btn" onclick="selectPlatform('instagram')">Instagram</button>
                    <button class="platform-btn" onclick="selectPlatform('snapchat')">Snapchat</button>
                </div>

                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-value" id="reachMetric">45.2K</div>
                        <div class="metric-label" id="reachLabel">Reach</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="engagementMetric">8.7%</div>
                        <div class="metric-label" id="engagementLabel">Engagement</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="conversionsMetric">312</div>
                        <div class="metric-label" id="conversionsLabel">Conversions</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="roiMetric">4.2x</div>
                        <div class="metric-label" id="roiLabel">ROI</div>
                    </div>
                </div>
            </div>

            <!-- Content Schedule -->
            <div class="card">
                <h3 id="contentPipelineTitle">Content Schedule</h3>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Content</th>
                            <th>Platform</th>
                            <th>Schedule</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Spark Solo Demo - Healthcare</td>
                            <td>TikTok</td>
                            <td>Tomorrow 2:00 PM</td>
                            <td><span style="color: var(--success); font-weight: 600;">Ready</span></td>
                            <td><button class="btn btn-small btn-secondary" onclick="editContent(1)">Edit</button></td>
                        </tr>
                        <tr>
                            <td>AI Automation Tips</td>
                            <td>Instagram</td>
                            <td>Tomorrow 6:00 PM</td>
                            <td><span style="color: var(--warning); font-weight: 600;">Processing</span></td>
                            <td><button class="btn btn-small btn-secondary" onclick="editContent(2)">Edit</button></td>
                        </tr>
                        <tr>
                            <td>BrainSAIT Behind Scenes</td>
                            <td>Snapchat</td>
                            <td>Wed 10:00 AM</td>
                            <td><span style="color: var(--text-muted); font-weight: 600;">Scheduled</span></td>
                            <td><button class="btn btn-small btn-secondary" onclick="editContent(3)">Edit</button></td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="generateContent()">
                        <span>+</span>
                        <span id="generateBtn">New Content</span>
                    </button>
                    <button class="btn btn-secondary" onclick="viewCalendar()">
                        <span id="calendarBtn">View Calendar</span>
                    </button>
                </div>
            </div>

            <!-- Lead Generation -->
            <div class="card">
                <h3 id="leadGenTitle">Lead Generation</h3>
                
                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-value">247</div>
                        <div class="metric-label">New Leads</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">18.4%</div>
                        <div class="metric-label">Conv. Rate</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">$12.50</div>
                        <div class="metric-label">Cost/Lead</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">67%</div>
                        <div class="metric-label">Quality</div>
                    </div>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Source</th>
                            <th>Leads</th>
                            <th>Quality</th>
                            <th>Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>TikTok Ads</td>
                            <td>156</td>
                            <td>72%</td>
                            <td>$11.20</td>
                        </tr>
                        <tr>
                            <td>Instagram</td>
                            <td>91</td>
                            <td>68%</td>
                            <td>$14.80</td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="viewLeads()">
                        <span id="viewLeadsBtn">View All Leads</span>
                    </button>
                    <button class="btn btn-secondary" onclick="exportData()">
                        <span id="exportBtn">Export</span>
                    </button>
                </div>
            </div>

            <!-- Automation Status -->
            <div class="card">
                <h3 id="automationHubTitle">Automation Status</h3>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Process</th>
                            <th>Status</th>
                            <th>Last Run</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Content Generation</td>
                            <td><span style="color: var(--success); font-weight: 600;">Active</span></td>
                            <td>2 mins ago</td>
                            <td><button class="btn btn-small btn-secondary" onclick="configureAutomation('content')">Settings</button></td>
                        </tr>
                        <tr>
                            <td>Smart Scheduling</td>
                            <td><span style="color: var(--success); font-weight: 600;">Active</span></td>
                            <td>5 mins ago</td>
                            <td><button class="btn btn-small btn-secondary" onclick="configureAutomation('schedule')">Settings</button></td>
                        </tr>
                        <tr>
                            <td>Lead Qualification</td>
                            <td><span style="color: var(--success); font-weight: 600;">Active</span></td>
                            <td>1 min ago</td>
                            <td><button class="btn btn-small btn-secondary" onclick="configureAutomation('leads')">Settings</button></td>
                        </tr>
                        <tr>
                            <td>Performance Optimization</td>
                            <td><span style="color: var(--warning); font-weight: 600;">Paused</span></td>
                            <td>1 hour ago</td>
                            <td><button class="btn btn-small btn-primary" onclick="startAutomation('performance')">Start</button></td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="configureAutomation()">
                        <span id="configureBtn">Configure All</span>
                    </button>
                    <button class="btn btn-secondary" onclick="viewLogs()">
                        <span id="logsBtn">View Logs</span>
                    </button>
                </div>
            </div>

            <!-- Quick Reports -->
            <div class="card">
                <h3>Quick Reports</h3>
                
                <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius);">
                        <div>
                            <div style="font-weight: 600; font-size: 13px;">Weekly Performance</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Campaign metrics summary</div>
                        </div>
                        <button class="btn btn-small btn-secondary" onclick="generateReport('weekly')">Generate</button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius);">
                        <div>
                            <div style="font-weight: 600; font-size: 13px;">Lead Analysis</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Quality and conversion insights</div>
                        </div>
                        <button class="btn btn-small btn-secondary" onclick="generateReport('leads')">Generate</button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius);">
                        <div>
                            <div style="font-weight: 600; font-size: 13px;">ROI Analysis</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Return on investment breakdown</div>
                        </div>
                        <button class="btn btn-small btn-secondary" onclick="generateReport('roi')">Generate</button>
                    </div>
                </div>
                
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button class="btn btn-primary" onclick="generateReport('comprehensive')">
                        <span>Full Report</span>
                    </button>
                    <button class="btn btn-secondary" onclick="scheduleReports()">
                        <span>Schedule</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // MARKETING DASHBOARD - FULL FUNCTIONALITY
        // Data Management System with LocalStorage persistence
        class DataManager {
            constructor() {
                this.initializeData();
            }

            initializeData() {
                if (!localStorage.getItem('campaigns')) {
                    localStorage.setItem('campaigns', JSON.stringify([
                        {
                            id: 1,
                            name: 'Spark Solo Launch',
                            status: 'active',
                            budget: 2500,
                            spent: 1825,
                            startDate: '2025-08-01',
                            endDate: '2025-09-15',
                            platforms: ['tiktok', 'instagram'],
                            goals: 'brand_awareness',
                            reach: 18300,
                            engagement: 2268,
                            conversions: 156,
                            roi: 5.1
                        },
                        {
                            id: 2,
                            name: 'Brand Awareness MENA',
                            status: 'optimizing',
                            budget: 1800,
                            spent: 810,
                            startDate: '2025-08-10',
                            endDate: '2025-09-30',
                            platforms: ['instagram', 'snapchat'],
                            goals: 'lead_generation',
                            reach: 21700,
                            engagement: 1476,
                            conversions: 124,
                            roi: 3.8
                        },
                        {
                            id: 3,
                            name: 'Retargeting Q4',
                            status: 'scheduled',
                            budget: 1200,
                            spent: 0,
                            startDate: '2025-08-21',
                            endDate: '2025-10-31',
                            platforms: ['tiktok'],
                            goals: 'conversions',
                            reach: 0,
                            engagement: 0,
                            conversions: 0,
                            roi: 0
                        }
                    ]));
                }

                if (!localStorage.getItem('content')) {
                    localStorage.setItem('content', JSON.stringify([
                        {
                            id: 1,
                            title: 'Spark Solo Demo - Healthcare',
                            description: 'Demonstration video showing Spark Solo automating healthcare workflows',
                            platform: 'tiktok',
                            scheduledDate: '2025-08-19',
                            scheduledTime: '14:00',
                            status: 'ready',
                            type: 'video',
                            campaignId: 1
                        },
                        {
                            id: 2,
                            title: 'AI Automation Tips',
                            description: 'Educational carousel about AI automation best practices',
                            platform: 'instagram',
                            scheduledDate: '2025-08-19',
                            scheduledTime: '18:00',
                            status: 'processing',
                            type: 'carousel',
                            campaignId: 2
                        },
                        {
                            id: 3,
                            title: 'BrainSAIT Behind Scenes',
                            description: 'Behind the scenes content showing BrainSAIT team at work',
                            platform: 'snapchat',
                            scheduledDate: '2025-08-21',
                            scheduledTime: '10:00',
                            status: 'scheduled',
                            type: 'story',
                            campaignId: 2
                        }
                    ]));
                }

                if (!localStorage.getItem('leads')) {
                    localStorage.setItem('leads', JSON.stringify([
                        {
                            id: 1,
                            name: 'Ahmed Al-Rashid',
                            email: 'ahmed@example.com',
                            phone: '+971501234567',
                            source: 'tiktok',
                            status: 'qualified',
                            score: 85,
                            created: '2025-08-18T10:30:00Z',
                            campaignId: 1,
                            notes: 'Interested in healthcare automation'
                        },
                        {
                            id: 2,
                            name: 'Sarah Johnson',
                            email: 'sarah.j@company.com',
                            phone: '+1555123456',
                            source: 'instagram',
                            status: 'new',
                            score: 72,
                            created: '2025-08-18T09:15:00Z',
                            campaignId: 2,
                            notes: 'Downloaded whitepaper'
                        }
                    ]));
                }

                if (!localStorage.getItem('analytics')) {
                    const today = new Date();
                    const analytics = [];
                    
                    // Generate 30 days of analytics data
                    for (let i = 29; i >= 0; i--) {
                        const date = new Date(today);
                        date.setDate(date.getDate() - i);
                        analytics.push({
                            date: date.toISOString().split('T')[0],
                            reach: Math.floor(Math.random() * 2000) + 1000,
                            engagement: Math.floor(Math.random() * 200) + 50,
                            conversions: Math.floor(Math.random() * 20) + 5,
                            spend: Math.floor(Math.random() * 200) + 100,
                            platform: ['tiktok', 'instagram', 'snapchat'][Math.floor(Math.random() * 3)]
                        });
                    }
                    localStorage.setItem('analytics', JSON.stringify(analytics));
                }

                if (!localStorage.getItem('automations')) {
                    localStorage.setItem('automations', JSON.stringify([
                        {
                            id: 1,
                            name: 'Content Generation',
                            type: 'content',
                            status: 'active',
                            lastRun: new Date(Date.now() - 2 * 60 * 1000).toISOString(),
                            rules: 'Generate content daily at 9 AM',
                            enabled: true
                        },
                        {
                            id: 2,
                            name: 'Smart Scheduling',
                            type: 'schedule',
                            status: 'active',
                            lastRun: new Date(Date.now() - 5 * 60 * 1000).toISOString(),
                            rules: 'Optimize posting times based on audience',
                            enabled: true
                        },
                        {
                            id: 3,
                            name: 'Lead Qualification',
                            type: 'leads',
                            status: 'active',
                            lastRun: new Date(Date.now() - 1 * 60 * 1000).toISOString(),
                            rules: 'Auto-score leads based on engagement',
                            enabled: true
                        },
                        {
                            id: 4,
                            name: 'Performance Optimization',
                            type: 'performance',
                            status: 'paused',
                            lastRun: new Date(Date.now() - 60 * 60 * 1000).toISOString(),
                            rules: 'Adjust budgets based on performance',
                            enabled: false
                        }
                    ]));
                }
            }

            // CRUD Operations
            getCampaigns() {
                return JSON.parse(localStorage.getItem('campaigns') || '[]');
            }

            saveCampaign(campaign) {
                const campaigns = this.getCampaigns();
                if (campaign.id) {
                    const index = campaigns.findIndex(c => c.id === campaign.id);
                    if (index !== -1) {
                        campaigns[index] = campaign;
                    }
                } else {
                    campaign.id = Date.now();
                    campaigns.push(campaign);
                }
                localStorage.setItem('campaigns', JSON.stringify(campaigns));
                return campaign;
            }

            deleteCampaign(id) {
                const campaigns = this.getCampaigns().filter(c => c.id !== id);
                localStorage.setItem('campaigns', JSON.stringify(campaigns));
            }

            getContent() {
                return JSON.parse(localStorage.getItem('content') || '[]');
            }

            saveContent(content) {
                const contentList = this.getContent();
                if (content.id) {
                    const index = contentList.findIndex(c => c.id === content.id);
                    if (index !== -1) {
                        contentList[index] = content;
                    }
                } else {
                    content.id = Date.now();
                    contentList.push(content);
                }
                localStorage.setItem('content', JSON.stringify(contentList));
                return content;
            }

            deleteContent(id) {
                const content = this.getContent().filter(c => c.id !== id);
                localStorage.setItem('content', JSON.stringify(content));
            }

            getLeads() {
                return JSON.parse(localStorage.getItem('leads') || '[]');
            }

            saveLead(lead) {
                const leads = this.getLeads();
                if (lead.id) {
                    const index = leads.findIndex(l => l.id === lead.id);
                    if (index !== -1) {
                        leads[index] = lead;
                    }
                } else {
                    lead.id = Date.now();
                    lead.created = new Date().toISOString();
                    leads.push(lead);
                }
                localStorage.setItem('leads', JSON.stringify(leads));
                return lead;
            }

            deleteLead(id) {
                const leads = this.getLeads().filter(l => l.id !== id);
                localStorage.setItem('leads', JSON.stringify(leads));
            }

            getAnalytics() {
                return JSON.parse(localStorage.getItem('analytics') || '[]');
            }

            getAutomations() {
                return JSON.parse(localStorage.getItem('automations') || '[]');
            }

            saveAutomation(automation) {
                const automations = this.getAutomations();
                const index = automations.findIndex(a => a.id === automation.id);
                if (index !== -1) {
                    automations[index] = automation;
                } else {
                    automation.id = Date.now();
                    automations.push(automation);
                }
                localStorage.setItem('automations', JSON.stringify(automations));
                return automation;
            }

            // Export/Import functionality
            exportData() {
                const data = {
                    campaigns: this.getCampaigns(),
                    content: this.getContent(),
                    leads: this.getLeads(),
                    analytics: this.getAnalytics(),
                    automations: this.getAutomations(),
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `marketing-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            importData(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.campaigns) localStorage.setItem('campaigns', JSON.stringify(data.campaigns));
                            if (data.content) localStorage.setItem('content', JSON.stringify(data.content));
                            if (data.leads) localStorage.setItem('leads', JSON.stringify(data.leads));
                            if (data.analytics) localStorage.setItem('analytics', JSON.stringify(data.analytics));
                            if (data.automations) localStorage.setItem('automations', JSON.stringify(data.automations));
                            resolve(data);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.readAsText(file);
                });
            }
        }

        // Initialize Data Manager
        const dataManager = new DataManager();
        let currentLanguage = 'en';
        let currentTheme = localStorage.getItem('theme') || 'light';

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            refreshDashboard();
        });

        // Theme toggle functionality
        function initializeTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeIcon();
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeIcon();
            showNotification('Theme changed to ' + currentTheme + ' mode');
        }

        function updateThemeIcon() {
            const themeIcon = document.getElementById('themeIcon');
            themeIcon.textContent = currentTheme === 'light' ? '🌙' : '☀️';
        }

        // Language toggle functionality
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
            document.getElementById('langToggleText').textContent = currentLanguage === 'en' ? 'العربية' : 'English';
            
            if (currentLanguage === 'ar') {
                document.body.style.direction = 'rtl';
                document.getElementById('mainTitle').textContent = 'لوحة تحكم التسويق - BrainSAIT';
                document.getElementById('subtitle').textContent = 'إدارة الحملات المبسطة لحلول Spark Solo و BrainSAIT';
            } else {
                document.body.style.direction = 'ltr';
                document.getElementById('mainTitle').textContent = 'BrainSAIT Marketing Dashboard';
                document.getElementById('subtitle').textContent = 'Simplified campaign management for Spark Solo & BrainSAIT Solutions';
            }
            showNotification('Language switched to ' + (currentLanguage === 'en' ? 'English' : 'Arabic'));
        }

        // Platform selection
        function selectPlatform(platform) {
            document.querySelectorAll('.platform-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update metrics based on platform
            updatePlatformMetrics(platform);
        }

        function updatePlatformMetrics(platform) {
            const metrics = {
                all: { reach: '45.2K', engagement: '8.7%', conversions: '312', roi: '4.2x' },
                tiktok: { reach: '18.3K', engagement: '12.4%', conversions: '156', roi: '5.1x' },
                instagram: { reach: '21.7K', engagement: '6.8%', conversions: '124', roi: '3.8x' },
                snapchat: { reach: '5.2K', engagement: '15.2%', conversions: '32', roi: '2.9x' }
            };

            const platformMetrics = metrics[platform];
            document.getElementById('reachMetric').textContent = platformMetrics.reach;
            document.getElementById('engagementMetric').textContent = platformMetrics.engagement;
            document.getElementById('conversionsMetric').textContent = platformMetrics.conversions;
            document.getElementById('roiMetric').textContent = platformMetrics.roi;
        }

        // Enhanced notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            // Update text and style
            notificationText.textContent = message;
            notification.className = 'notification show';
            
            if (type === 'error') {
                notification.style.background = 'var(--error)';
            } else if (type === 'warning') {
                notification.style.background = 'var(--warning)';
            } else {
                notification.style.background = 'var(--success)';
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, type === 'error' ? 5000 : 3000);
        }

        // Dashboard refresh function
        function refreshDashboard() {
            updateDashboardStats();
            updateCampaignTable();
            updateContentTable();
        }

        function updateDashboardStats() {
            const campaigns = dataManager.getCampaigns();
            const content = dataManager.getContent();
            const leads = dataManager.getLeads();
            
            // Update status bar
            document.getElementById('campaignStatus').textContent = `${campaigns.filter(c => c.status === 'active').length} Active Campaigns`;
            document.getElementById('contentStatus').textContent = `${content.filter(c => c.status === 'scheduled').length} Scheduled Posts`;
            document.getElementById('leadStatus').textContent = `${leads.length} Total Leads`;
        }

        function updateCampaignTable() {
            const campaigns = dataManager.getCampaigns();
            const tbody = document.querySelector('.card:first-of-type .data-table tbody');
            
            if (!tbody) return;
            
            tbody.innerHTML = campaigns.map(campaign => {
                const performance = campaign.budget > 0 ? Math.round((campaign.spent / campaign.budget) * 100) : 0;
                const statusColor = {
                    'active': 'var(--success)',
                    'paused': 'var(--warning)',
                    'draft': 'var(--text-muted)',
                    'completed': 'var(--primary)'
                }[campaign.status] || 'var(--text-muted)';
                
                return `
                    <tr>
                        <td>${campaign.name}</td>
                        <td><span style="color: ${statusColor}; font-weight: 600;">${campaign.status.charAt(0).toUpperCase() + campaign.status.slice(1)}</span></td>
                        <td>$${campaign.budget.toLocaleString()}</td>
                        <td>${performance}% spent</td>
                        <td><button class="btn btn-small btn-secondary" onclick="editCampaign(${campaign.id})">Edit</button></td>
                    </tr>
                `;
            }).join('');
        }

        function updateContentTable() {
            const content = dataManager.getContent();
            const tbody = document.querySelector('.card:nth-of-type(3) .data-table tbody');
            
            if (!tbody) return;
            
            tbody.innerHTML = content.slice(0, 3).map(item => {
                const statusColor = {
                    'ready': 'var(--success)',
                    'processing': 'var(--warning)',
                    'scheduled': 'var(--text-muted)',
                    'published': 'var(--primary)',
                    'failed': 'var(--error)'
                }[item.status] || 'var(--text-muted)';
                
                const scheduleDate = new Date(item.scheduledDate + 'T' + item.scheduledTime);
                const now = new Date();
                const isToday = scheduleDate.toDateString() === now.toDateString();
                const isTomorrow = scheduleDate.toDateString() === new Date(now.getTime() + 24 * 60 * 60 * 1000).toDateString();
                
                let scheduleText;
                if (isToday) {
                    scheduleText = `Today ${item.scheduledTime}`;
                } else if (isTomorrow) {
                    scheduleText = `Tomorrow ${item.scheduledTime}`;
                } else {
                    scheduleText = `${scheduleDate.toLocaleDateString()} ${item.scheduledTime}`;
                }
                
                return `
                    <tr>
                        <td>${item.title}</td>
                        <td>${item.platform.charAt(0).toUpperCase() + item.platform.slice(1)}</td>
                        <td>${scheduleText}</td>
                        <td><span style="color: ${statusColor}; font-weight: 600;">${item.status.charAt(0).toUpperCase() + item.status.slice(1)}</span></td>
                        <td><button class="btn btn-small btn-secondary" onclick="editContent(${item.id})">Edit</button></td>
                    </tr>
                `;
            }).join('');
        }

        // Modal Management System
        function showModal(content) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-content">
                        ${content}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // Close on escape key
            document.addEventListener('keydown', handleEscapeKey);
        }

        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
                document.body.style.overflow = 'auto';
                document.removeEventListener('keydown', handleEscapeKey);
            }
        }

        function handleEscapeKey(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        }

        // Form Validation System
        function validateForm(formData, rules) {
            const errors = {};
            
            for (const field in rules) {
                const rule = rules[field];
                const value = formData[field];
                
                if (rule.required && (!value || value.trim() === '')) {
                    errors[field] = `${field} is required`;
                } else if (rule.minLength && value && value.length < rule.minLength) {
                    errors[field] = `${field} must be at least ${rule.minLength} characters`;
                } else if (rule.maxLength && value && value.length > rule.maxLength) {
                    errors[field] = `${field} must be no more than ${rule.maxLength} characters`;
                } else if (rule.pattern && value && !rule.pattern.test(value)) {
                    errors[field] = rule.message || `${field} format is invalid`;
                } else if (rule.min && value && parseFloat(value) < rule.min) {
                    errors[field] = `${field} must be at least ${rule.min}`;
                } else if (rule.max && value && parseFloat(value) > rule.max) {
                    errors[field] = `${field} must be no more than ${rule.max}`;
                }
            }
            
            return errors;
        }

        function showFieldError(fieldName, error) {
            const field = document.querySelector(`[name="${fieldName}"]`);
            if (field) {
                field.classList.add('error');
                const errorEl = field.parentElement.querySelector('.field-error');
                if (errorEl) {
                    errorEl.textContent = error;
                } else {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'field-error';
                    errorDiv.textContent = error;
                    field.parentElement.appendChild(errorDiv);
                }
            }
        }

        function clearFieldErrors() {
            document.querySelectorAll('.error').forEach(field => field.classList.remove('error'));
            document.querySelectorAll('.field-error').forEach(error => error.remove());
        }

        // Loading State Management
        function showLoading(message = 'Loading...') {
            const loader = document.createElement('div');
            loader.className = 'loading-overlay';
            loader.innerHTML = `
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <div class="loading-text">${message}</div>
                </div>
            `;
            document.body.appendChild(loader);
        }

        function hideLoading() {
            const loader = document.querySelector('.loading-overlay');
            if (loader) {
                loader.remove();
            }
        }

        // CAMPAIGN MANAGEMENT FUNCTIONS
        function createCampaign() {
            const modalContent = `
                <h2>Create New Campaign</h2>
                <form id="campaignForm" class="modal-form">
                    <div class="form-group">
                        <label for="campaignName">Campaign Name *</label>
                        <input type="text" id="campaignName" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="campaignBudget">Budget ($) *</label>
                        <input type="number" id="campaignBudget" name="budget" min="100" max="50000" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startDate">Start Date *</label>
                            <input type="date" id="startDate" name="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="endDate">End Date *</label>
                            <input type="date" id="endDate" name="endDate" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Platforms *</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="platforms" value="tiktok"> TikTok</label>
                            <label><input type="checkbox" name="platforms" value="instagram"> Instagram</label>
                            <label><input type="checkbox" name="platforms" value="snapchat"> Snapchat</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="campaignGoals">Primary Goal *</label>
                        <select id="campaignGoals" name="goals" required>
                            <option value="">Select Goal</option>
                            <option value="brand_awareness">Brand Awareness</option>
                            <option value="lead_generation">Lead Generation</option>
                            <option value="conversions">Conversions</option>
                            <option value="engagement">Engagement</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Campaign</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').min = today;
            document.getElementById('endDate').min = today;
            
            // Handle form submission
            document.getElementById('campaignForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveCampaignForm();
            });
        }

        function saveCampaignForm() {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('campaignForm'));
            const platforms = formData.getAll('platforms');
            
            const campaign = {
                name: formData.get('name'),
                budget: parseInt(formData.get('budget')),
                startDate: formData.get('startDate'),
                endDate: formData.get('endDate'),
                platforms: platforms,
                goals: formData.get('goals'),
                status: 'draft',
                spent: 0,
                reach: 0,
                engagement: 0,
                conversions: 0,
                roi: 0
            };
            
            // Validation rules
            const rules = {
                name: { required: true, minLength: 3, maxLength: 100 },
                budget: { required: true, min: 100, max: 50000 },
                startDate: { required: true },
                endDate: { required: true },
                goals: { required: true }
            };
            
            const errors = validateForm(campaign, rules);
            
            // Additional validation
            if (platforms.length === 0) {
                errors.platforms = 'At least one platform must be selected';
            }
            
            if (campaign.startDate && campaign.endDate && campaign.startDate >= campaign.endDate) {
                errors.endDate = 'End date must be after start date';
            }
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Creating campaign...');
            
            setTimeout(() => {
                try {
                    dataManager.saveCampaign(campaign);
                    hideLoading();
                    closeModal();
                    showNotification('Campaign created successfully!');
                    refreshDashboard();
                } catch (error) {
                    hideLoading();
                    showNotification('Error creating campaign: ' + error.message, 'error');
                }
            }, 1000);
        }

        function editCampaign(id) {
            const campaigns = dataManager.getCampaigns();
            const campaign = campaigns.find(c => c.id === id);
            
            if (!campaign) {
                showNotification('Campaign not found', 'error');
                return;
            }
            
            const modalContent = `
                <h2>Edit Campaign: ${campaign.name}</h2>
                <form id="editCampaignForm" class="modal-form">
                    <div class="form-group">
                        <label for="editCampaignName">Campaign Name *</label>
                        <input type="text" id="editCampaignName" name="name" value="${campaign.name}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCampaignBudget">Budget ($) *</label>
                        <input type="number" id="editCampaignBudget" name="budget" value="${campaign.budget}" min="100" max="50000" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editStartDate">Start Date *</label>
                            <input type="date" id="editStartDate" name="startDate" value="${campaign.startDate}" required>
                        </div>
                        <div class="form-group">
                            <label for="editEndDate">End Date *</label>
                            <input type="date" id="editEndDate" name="endDate" value="${campaign.endDate}" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Platforms *</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="platforms" value="tiktok" ${campaign.platforms.includes('tiktok') ? 'checked' : ''}> TikTok</label>
                            <label><input type="checkbox" name="platforms" value="instagram" ${campaign.platforms.includes('instagram') ? 'checked' : ''}> Instagram</label>
                            <label><input type="checkbox" name="platforms" value="snapchat" ${campaign.platforms.includes('snapchat') ? 'checked' : ''}> Snapchat</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCampaignGoals">Primary Goal *</label>
                        <select id="editCampaignGoals" name="goals" required>
                            <option value="brand_awareness" ${campaign.goals === 'brand_awareness' ? 'selected' : ''}>Brand Awareness</option>
                            <option value="lead_generation" ${campaign.goals === 'lead_generation' ? 'selected' : ''}>Lead Generation</option>
                            <option value="conversions" ${campaign.goals === 'conversions' ? 'selected' : ''}>Conversions</option>
                            <option value="engagement" ${campaign.goals === 'engagement' ? 'selected' : ''}>Engagement</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCampaignStatus">Status</label>
                        <select id="editCampaignStatus" name="status" required>
                            <option value="draft" ${campaign.status === 'draft' ? 'selected' : ''}>Draft</option>
                            <option value="active" ${campaign.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="paused" ${campaign.status === 'paused' ? 'selected' : ''}>Paused</option>
                            <option value="completed" ${campaign.status === 'completed' ? 'selected' : ''}>Completed</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="deleteCampaignConfirm(${campaign.id})" class="btn btn-danger">Delete</button>
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('editCampaignForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateCampaign(campaign.id);
            });
        }

        function updateCampaign(id) {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('editCampaignForm'));
            const platforms = formData.getAll('platforms');
            
            const existingCampaign = dataManager.getCampaigns().find(c => c.id === id);
            const updatedCampaign = {
                ...existingCampaign,
                name: formData.get('name'),
                budget: parseInt(formData.get('budget')),
                startDate: formData.get('startDate'),
                endDate: formData.get('endDate'),
                platforms: platforms,
                goals: formData.get('goals'),
                status: formData.get('status')
            };
            
            const rules = {
                name: { required: true, minLength: 3, maxLength: 100 },
                budget: { required: true, min: 100, max: 50000 },
                startDate: { required: true },
                endDate: { required: true },
                goals: { required: true },
                status: { required: true }
            };
            
            const errors = validateForm(updatedCampaign, rules);
            
            if (platforms.length === 0) {
                errors.platforms = 'At least one platform must be selected';
            }
            
            if (updatedCampaign.startDate && updatedCampaign.endDate && updatedCampaign.startDate >= updatedCampaign.endDate) {
                errors.endDate = 'End date must be after start date';
            }
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Updating campaign...');
            
            setTimeout(() => {
                try {
                    dataManager.saveCampaign(updatedCampaign);
                    hideLoading();
                    closeModal();
                    showNotification('Campaign updated successfully!');
                    refreshDashboard();
                } catch (error) {
                    hideLoading();
                    showNotification('Error updating campaign: ' + error.message, 'error');
                }
            }, 500);
        }

        function deleteCampaignConfirm(id) {
            const campaign = dataManager.getCampaigns().find(c => c.id === id);
            if (!campaign) return;
            
            if (confirm(`Are you sure you want to delete the campaign "${campaign.name}"? This action cannot be undone.`)) {
                showLoading('Deleting campaign...');
                
                setTimeout(() => {
                    try {
                        dataManager.deleteCampaign(id);
                        hideLoading();
                        closeModal();
                        showNotification('Campaign deleted successfully!');
                        refreshDashboard();
                    } catch (error) {
                        hideLoading();
                        showNotification('Error deleting campaign: ' + error.message, 'error');
                    }
                }, 500);
            }
        }

        function viewAllCampaigns() {
            const campaigns = dataManager.getCampaigns();
            
            const modalContent = `
                <h2>All Campaigns (${campaigns.length})</h2>
                <div class="campaigns-list">
                    ${campaigns.map(campaign => `
                        <div class="campaign-item">
                            <div class="campaign-info">
                                <h4>${campaign.name}</h4>
                                <div class="campaign-meta">
                                    <span class="status ${campaign.status}">${campaign.status.charAt(0).toUpperCase() + campaign.status.slice(1)}</span>
                                    <span class="budget">$${campaign.budget.toLocaleString()}</span>
                                    <span class="dates">${campaign.startDate} - ${campaign.endDate}</span>
                                </div>
                                <div class="campaign-platforms">
                                    ${campaign.platforms.map(p => `<span class="platform-tag">${p}</span>`).join('')}
                                </div>
                            </div>
                            <div class="campaign-actions">
                                <button onclick="editCampaign(${campaign.id}); closeModal();" class="btn btn-small btn-primary">Edit</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                    <button type="button" onclick="createCampaign(); closeModal();" class="btn btn-primary">New Campaign</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // CONTENT SCHEDULING FUNCTIONS
        function scheduleContent() {
            const campaigns = dataManager.getCampaigns();
            const campaignOptions = campaigns.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            const modalContent = `
                <h2>Schedule New Content</h2>
                <form id="contentForm" class="modal-form">
                    <div class="form-group">
                        <label for="contentTitle">Content Title *</label>
                        <input type="text" id="contentTitle" name="title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="contentDescription">Description</label>
                        <textarea id="contentDescription" name="description" rows="3" placeholder="Brief description of the content"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contentPlatform">Platform *</label>
                            <select id="contentPlatform" name="platform" required>
                                <option value="">Select Platform</option>
                                <option value="tiktok">TikTok</option>
                                <option value="instagram">Instagram</option>
                                <option value="snapchat">Snapchat</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contentType">Content Type *</label>
                            <select id="contentType" name="type" required>
                                <option value="">Select Type</option>
                                <option value="video">Video</option>
                                <option value="image">Image</option>
                                <option value="carousel">Carousel</option>
                                <option value="story">Story</option>
                                <option value="reel">Reel</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="scheduledDate">Scheduled Date *</label>
                            <input type="date" id="scheduledDate" name="scheduledDate" required>
                        </div>
                        <div class="form-group">
                            <label for="scheduledTime">Scheduled Time *</label>
                            <input type="time" id="scheduledTime" name="scheduledTime" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contentCampaign">Associated Campaign</label>
                        <select id="contentCampaign" name="campaignId">
                            <option value="">No Campaign</option>
                            ${campaignOptions}
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Schedule Content</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('scheduledDate').min = today;
            
            // Handle form submission
            document.getElementById('contentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveContentForm();
            });
        }

        function saveContentForm() {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('contentForm'));
            
            const content = {
                title: formData.get('title'),
                description: formData.get('description'),
                platform: formData.get('platform'),
                type: formData.get('type'),
                scheduledDate: formData.get('scheduledDate'),
                scheduledTime: formData.get('scheduledTime'),
                campaignId: formData.get('campaignId') ? parseInt(formData.get('campaignId')) : null,
                status: 'scheduled'
            };
            
            const rules = {
                title: { required: true, minLength: 3, maxLength: 200 },
                platform: { required: true },
                type: { required: true },
                scheduledDate: { required: true },
                scheduledTime: { required: true }
            };
            
            const errors = validateForm(content, rules);
            
            // Check if scheduled time is in the future
            const scheduledDateTime = new Date(content.scheduledDate + 'T' + content.scheduledTime);
            if (scheduledDateTime <= new Date()) {
                errors.scheduledTime = 'Scheduled time must be in the future';
            }
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Scheduling content...');
            
            setTimeout(() => {
                try {
                    dataManager.saveContent(content);
                    hideLoading();
                    closeModal();
                    showNotification('Content scheduled successfully!');
                    refreshDashboard();
                } catch (error) {
                    hideLoading();
                    showNotification('Error scheduling content: ' + error.message, 'error');
                }
            }, 1000);
        }

        function editContent(id) {
            const contentList = dataManager.getContent();
            const content = contentList.find(c => c.id === id);
            
            if (!content) {
                showNotification('Content not found', 'error');
                return;
            }
            
            const campaigns = dataManager.getCampaigns();
            const campaignOptions = campaigns.map(c => 
                `<option value="${c.id}" ${content.campaignId === c.id ? 'selected' : ''}>${c.name}</option>`
            ).join('');
            
            const modalContent = `
                <h2>Edit Content: ${content.title}</h2>
                <form id="editContentForm" class="modal-form">
                    <div class="form-group">
                        <label for="editContentTitle">Content Title *</label>
                        <input type="text" id="editContentTitle" name="title" value="${content.title}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editContentDescription">Description</label>
                        <textarea id="editContentDescription" name="description" rows="3">${content.description || ''}</textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editContentPlatform">Platform *</label>
                            <select id="editContentPlatform" name="platform" required>
                                <option value="tiktok" ${content.platform === 'tiktok' ? 'selected' : ''}>TikTok</option>
                                <option value="instagram" ${content.platform === 'instagram' ? 'selected' : ''}>Instagram</option>
                                <option value="snapchat" ${content.platform === 'snapchat' ? 'selected' : ''}>Snapchat</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editContentType">Content Type *</label>
                            <select id="editContentType" name="type" required>
                                <option value="video" ${content.type === 'video' ? 'selected' : ''}>Video</option>
                                <option value="image" ${content.type === 'image' ? 'selected' : ''}>Image</option>
                                <option value="carousel" ${content.type === 'carousel' ? 'selected' : ''}>Carousel</option>
                                <option value="story" ${content.type === 'story' ? 'selected' : ''}>Story</option>
                                <option value="reel" ${content.type === 'reel' ? 'selected' : ''}>Reel</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editScheduledDate">Scheduled Date *</label>
                            <input type="date" id="editScheduledDate" name="scheduledDate" value="${content.scheduledDate}" required>
                        </div>
                        <div class="form-group">
                            <label for="editScheduledTime">Scheduled Time *</label>
                            <input type="time" id="editScheduledTime" name="scheduledTime" value="${content.scheduledTime}" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editContentCampaign">Associated Campaign</label>
                            <select id="editContentCampaign" name="campaignId">
                                <option value="">No Campaign</option>
                                ${campaignOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editContentStatus">Status</label>
                            <select id="editContentStatus" name="status" required>
                                <option value="draft" ${content.status === 'draft' ? 'selected' : ''}>Draft</option>
                                <option value="scheduled" ${content.status === 'scheduled' ? 'selected' : ''}>Scheduled</option>
                                <option value="ready" ${content.status === 'ready' ? 'selected' : ''}>Ready</option>
                                <option value="processing" ${content.status === 'processing' ? 'selected' : ''}>Processing</option>
                                <option value="published" ${content.status === 'published' ? 'selected' : ''}>Published</option>
                                <option value="failed" ${content.status === 'failed' ? 'selected' : ''}>Failed</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="deleteContentConfirm(${content.id})" class="btn btn-danger">Delete</button>
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('editContentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateContent(content.id);
            });
        }

        function updateContent(id) {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('editContentForm'));
            const existingContent = dataManager.getContent().find(c => c.id === id);
            
            const updatedContent = {
                ...existingContent,
                title: formData.get('title'),
                description: formData.get('description'),
                platform: formData.get('platform'),
                type: formData.get('type'),
                scheduledDate: formData.get('scheduledDate'),
                scheduledTime: formData.get('scheduledTime'),
                campaignId: formData.get('campaignId') ? parseInt(formData.get('campaignId')) : null,
                status: formData.get('status')
            };
            
            const rules = {
                title: { required: true, minLength: 3, maxLength: 200 },
                platform: { required: true },
                type: { required: true },
                scheduledDate: { required: true },
                scheduledTime: { required: true },
                status: { required: true }
            };
            
            const errors = validateForm(updatedContent, rules);
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Updating content...');
            
            setTimeout(() => {
                try {
                    dataManager.saveContent(updatedContent);
                    hideLoading();
                    closeModal();
                    showNotification('Content updated successfully!');
                    refreshDashboard();
                } catch (error) {
                    hideLoading();
                    showNotification('Error updating content: ' + error.message, 'error');
                }
            }, 500);
        }

        function deleteContentConfirm(id) {
            const content = dataManager.getContent().find(c => c.id === id);
            if (!content) return;
            
            if (confirm(`Are you sure you want to delete the content "${content.title}"? This action cannot be undone.`)) {
                showLoading('Deleting content...');
                
                setTimeout(() => {
                    try {
                        dataManager.deleteContent(id);
                        hideLoading();
                        closeModal();
                        showNotification('Content deleted successfully!');
                        refreshDashboard();
                    } catch (error) {
                        hideLoading();
                        showNotification('Error deleting content: ' + error.message, 'error');
                    }
                }, 500);
            }
        }

        function generateContent() {
            scheduleContent(); // Use the same form for now
        }

        function viewCalendar() {
            const content = dataManager.getContent();
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            // Group content by date
            const contentByDate = {};
            content.forEach(item => {
                const date = item.scheduledDate;
                if (!contentByDate[date]) {
                    contentByDate[date] = [];
                }
                contentByDate[date].push(item);
            });
            
            // Sort dates
            const sortedDates = Object.keys(contentByDate).sort();
            
            const modalContent = `
                <h2>Content Calendar</h2>
                <div class="calendar-view">
                    ${sortedDates.map(date => {
                        const dateObj = new Date(date);
                        const isToday = date === today.toISOString().split('T')[0];
                        const dayContent = contentByDate[date];
                        
                        return `
                            <div class="calendar-day ${isToday ? 'today' : ''}">
                                <div class="calendar-date">
                                    <h4>${dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</h4>
                                </div>
                                <div class="calendar-content">
                                    ${dayContent.map(item => `
                                        <div class="calendar-item ${item.status}">
                                            <div class="item-time">${item.scheduledTime}</div>
                                            <div class="item-title">${item.title}</div>
                                            <div class="item-platform">${item.platform}</div>
                                            <button onclick="editContent(${item.id}); closeModal();" class="btn btn-small">Edit</button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                    <button type="button" onclick="scheduleContent(); closeModal();" class="btn btn-primary">New Content</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ANALYTICS DASHBOARD FUNCTIONS
        function viewAnalytics() {
            const modalContent = `
                <h2>Analytics Dashboard</h2>
                <div class="analytics-container">
                    <div class="analytics-filters">
                        <div class="filter-group">
                            <label>Date Range:</label>
                            <select id="dateRange" onchange="updateAnalytics()">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Platform:</label>
                            <select id="platformFilter" onchange="updateAnalytics()">
                                <option value="all">All Platforms</option>
                                <option value="tiktok">TikTok</option>
                                <option value="instagram">Instagram</option>
                                <option value="snapchat">Snapchat</option>
                            </select>
                        </div>
                        <button onclick="exportAnalytics()" class="btn btn-secondary">Export CSV</button>
                    </div>
                    
                    <div class="analytics-charts">
                        <div class="chart-container">
                            <h4>Performance Over Time</h4>
                            <canvas id="performanceChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h4>Platform Comparison</h4>
                            <canvas id="platformChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h4>Campaign ROI</h4>
                            <canvas id="roiChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="analytics-metrics">
                            <div class="metric-card">
                                <div class="metric-value" id="totalReach">0</div>
                                <div class="metric-label">Total Reach</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="avgEngagement">0%</div>
                                <div class="metric-label">Avg Engagement</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="totalConversions">0</div>
                                <div class="metric-label">Total Conversions</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="avgROI">0x</div>
                                <div class="metric-label">Average ROI</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                </div>
            `;
            
            showModal(modalContent);
            
            // Initialize charts after modal is shown
            setTimeout(() => {
                initializeAnalyticsCharts();
            }, 100);
        }

        let performanceChart, platformChart, roiChart;

        function initializeAnalyticsCharts() {
            const analytics = dataManager.getAnalytics();
            const campaigns = dataManager.getCampaigns();
            
            // Performance Over Time Chart
            const ctx1 = document.getElementById('performanceChart');
            if (ctx1) {
                const last30Days = analytics.slice(-30);
                
                performanceChart = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: last30Days.map(d => new Date(d.date).toLocaleDateString()),
                        datasets: [
                            {
                                label: 'Reach',
                                data: last30Days.map(d => d.reach),
                                borderColor: 'rgb(37, 99, 235)',
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                tension: 0.1
                            },
                            {
                                label: 'Engagement',
                                data: last30Days.map(d => d.engagement),
                                borderColor: 'rgb(16, 185, 129)',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.1
                            },
                            {
                                label: 'Conversions',
                                data: last30Days.map(d => d.conversions * 10), // Scale for visibility
                                borderColor: 'rgb(245, 158, 11)',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Platform Comparison Chart
            const ctx2 = document.getElementById('platformChart');
            if (ctx2) {
                const platformData = {
                    tiktok: { reach: 0, engagement: 0, conversions: 0 },
                    instagram: { reach: 0, engagement: 0, conversions: 0 },
                    snapchat: { reach: 0, engagement: 0, conversions: 0 }
                };
                
                analytics.forEach(d => {
                    if (platformData[d.platform]) {
                        platformData[d.platform].reach += d.reach;
                        platformData[d.platform].engagement += d.engagement;
                        platformData[d.platform].conversions += d.conversions;
                    }
                });
                
                platformChart = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: ['TikTok', 'Instagram', 'Snapchat'],
                        datasets: [
                            {
                                label: 'Reach',
                                data: [platformData.tiktok.reach, platformData.instagram.reach, platformData.snapchat.reach],
                                backgroundColor: 'rgba(37, 99, 235, 0.8)'
                            },
                            {
                                label: 'Engagement',
                                data: [platformData.tiktok.engagement, platformData.instagram.engagement, platformData.snapchat.engagement],
                                backgroundColor: 'rgba(16, 185, 129, 0.8)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // ROI Chart
            const ctx3 = document.getElementById('roiChart');
            if (ctx3) {
                roiChart = new Chart(ctx3, {
                    type: 'doughnut',
                    data: {
                        labels: campaigns.map(c => c.name),
                        datasets: [{
                            data: campaigns.map(c => c.roi || 0),
                            backgroundColor: [
                                'rgba(37, 99, 235, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(139, 92, 246, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            }
                        }
                    }
                });
            }

            updateAnalyticsMetrics();
        }

        function updateAnalytics() {
            const dateRange = parseInt(document.getElementById('dateRange').value);
            const platformFilter = document.getElementById('platformFilter').value;
            
            let analytics = dataManager.getAnalytics();
            
            // Filter by date range
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - dateRange);
            analytics = analytics.filter(d => new Date(d.date) >= cutoffDate);
            
            // Filter by platform
            if (platformFilter !== 'all') {
                analytics = analytics.filter(d => d.platform === platformFilter);
            }
            
            // Update performance chart
            if (performanceChart) {
                performanceChart.data.labels = analytics.map(d => new Date(d.date).toLocaleDateString());
                performanceChart.data.datasets[0].data = analytics.map(d => d.reach);
                performanceChart.data.datasets[1].data = analytics.map(d => d.engagement);
                performanceChart.data.datasets[2].data = analytics.map(d => d.conversions * 10);
                performanceChart.update();
            }
            
            // Update platform chart
            if (platformChart && platformFilter === 'all') {
                const platformData = {
                    tiktok: { reach: 0, engagement: 0 },
                    instagram: { reach: 0, engagement: 0 },
                    snapchat: { reach: 0, engagement: 0 }
                };
                
                analytics.forEach(d => {
                    if (platformData[d.platform]) {
                        platformData[d.platform].reach += d.reach;
                        platformData[d.platform].engagement += d.engagement;
                    }
                });
                
                platformChart.data.datasets[0].data = [platformData.tiktok.reach, platformData.instagram.reach, platformData.snapchat.reach];
                platformChart.data.datasets[1].data = [platformData.tiktok.engagement, platformData.instagram.engagement, platformData.snapchat.engagement];
                platformChart.update();
            }
            
            updateAnalyticsMetrics();
        }

        function updateAnalyticsMetrics() {
            const dateRange = parseInt(document.getElementById('dateRange')?.value || 30);
            const platformFilter = document.getElementById('platformFilter')?.value || 'all';
            
            let analytics = dataManager.getAnalytics();
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - dateRange);
            analytics = analytics.filter(d => new Date(d.date) >= cutoffDate);
            
            if (platformFilter !== 'all') {
                analytics = analytics.filter(d => d.platform === platformFilter);
            }
            
            const totalReach = analytics.reduce((sum, d) => sum + d.reach, 0);
            const totalEngagement = analytics.reduce((sum, d) => sum + d.engagement, 0);
            const totalConversions = analytics.reduce((sum, d) => sum + d.conversions, 0);
            const totalSpend = analytics.reduce((sum, d) => sum + d.spend, 0);
            
            const avgEngagement = analytics.length > 0 ? (totalEngagement / totalReach * 100).toFixed(1) : 0;
            const avgROI = totalSpend > 0 ? (totalConversions * 50 / totalSpend).toFixed(1) : 0; // Assume $50 per conversion
            
            const totalReachEl = document.getElementById('totalReach');
            const avgEngagementEl = document.getElementById('avgEngagement');
            const totalConversionsEl = document.getElementById('totalConversions');
            const avgROIEl = document.getElementById('avgROI');
            
            if (totalReachEl) totalReachEl.textContent = totalReach.toLocaleString();
            if (avgEngagementEl) avgEngagementEl.textContent = avgEngagement + '%';
            if (totalConversionsEl) totalConversionsEl.textContent = totalConversions.toLocaleString();
            if (avgROIEl) avgROIEl.textContent = avgROI + 'x';
        }

        function exportAnalytics() {
            const dateRange = parseInt(document.getElementById('dateRange').value);
            const platformFilter = document.getElementById('platformFilter').value;
            
            let analytics = dataManager.getAnalytics();
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - dateRange);
            analytics = analytics.filter(d => new Date(d.date) >= cutoffDate);
            
            if (platformFilter !== 'all') {
                analytics = analytics.filter(d => d.platform === platformFilter);
            }
            
            // Create CSV content
            const headers = ['Date', 'Platform', 'Reach', 'Engagement', 'Conversions', 'Spend'];
            const csvContent = [
                headers.join(','),
                ...analytics.map(row => [
                    row.date,
                    row.platform,
                    row.reach,
                    row.engagement,
                    row.conversions,
                    row.spend
                ].join(','))
            ].join('\\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analytics-${platformFilter}-${dateRange}days-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Analytics data exported successfully!');
        }

        // LEAD MANAGEMENT FUNCTIONS
        function manageLeads() {
            const leads = dataManager.getLeads();
            
            const modalContent = `
                <h2>Lead Management (${leads.length} leads)</h2>
                <div class="leads-container">
                    <div class="leads-toolbar">
                        <div class="search-group">
                            <input type="text" id="leadSearch" placeholder="Search leads..." onkeyup="filterLeads()">
                        </div>
                        <div class="filter-group">
                            <select id="statusFilter" onchange="filterLeads()">
                                <option value="all">All Status</option>
                                <option value="new">New</option>
                                <option value="contacted">Contacted</option>
                                <option value="qualified">Qualified</option>
                                <option value="converted">Converted</option>
                                <option value="lost">Lost</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <select id="sourceFilter" onchange="filterLeads()">
                                <option value="all">All Sources</option>
                                <option value="tiktok">TikTok</option>
                                <option value="instagram">Instagram</option>
                                <option value="snapchat">Snapchat</option>
                                <option value="website">Website</option>
                                <option value="referral">Referral</option>
                            </select>
                        </div>
                        <button onclick="exportLeads()" class="btn btn-secondary">Export CSV</button>
                    </div>
                    
                    <div class="leads-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="newLeadsCount">0</div>
                            <div class="stat-label">New Leads</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="qualifiedLeadsCount">0</div>
                            <div class="stat-label">Qualified</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="conversionRate">0%</div>
                            <div class="stat-label">Conversion Rate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgScore">0</div>
                            <div class="stat-label">Avg Score</div>
                        </div>
                    </div>
                    
                    <div class="leads-list" id="leadsList">
                        ${renderLeadsList(leads)}
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                    <button type="button" onclick="createLead()" class="btn btn-primary">New Lead</button>
                </div>
            `;
            
            showModal(modalContent);
            updateLeadsStats();
        }

        function renderLeadsList(leads) {
            if (leads.length === 0) {
                return '<div class="no-leads">No leads found matching the current filters.</div>';
            }
            
            return leads.map(lead => {
                const statusColor = {
                    'new': 'var(--warning)',
                    'contacted': 'var(--primary)',
                    'qualified': 'var(--success)',
                    'converted': 'var(--success)',
                    'lost': 'var(--error)'
                }[lead.status] || 'var(--text-muted)';
                
                const createdDate = new Date(lead.created).toLocaleDateString();
                const scoreColor = lead.score >= 80 ? 'var(--success)' : lead.score >= 60 ? 'var(--warning)' : 'var(--error)';
                
                return `
                    <div class="lead-item">
                        <div class="lead-info">
                            <div class="lead-header">
                                <h4>${lead.name}</h4>
                                <div class="lead-score" style="background: ${scoreColor}">${lead.score}</div>
                            </div>
                            <div class="lead-details">
                                <span class="lead-email">${lead.email}</span>
                                <span class="lead-phone">${lead.phone}</span>
                                <span class="lead-source source-${lead.source}">${lead.source.toUpperCase()}</span>
                                <span class="lead-date">${createdDate}</span>
                            </div>
                            <div class="lead-status" style="color: ${statusColor}">
                                ${lead.status.charAt(0).toUpperCase() + lead.status.slice(1)}
                            </div>
                            ${lead.notes ? `<div class="lead-notes">${lead.notes}</div>` : ''}
                        </div>
                        <div class="lead-actions">
                            <button onclick="editLead(${lead.id})" class="btn btn-small btn-primary">Edit</button>
                            <button onclick="deleteLead(${lead.id})" class="btn btn-small btn-danger">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterLeads() {
            const search = document.getElementById('leadSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const sourceFilter = document.getElementById('sourceFilter').value;
            
            let leads = dataManager.getLeads();
            
            // Apply filters
            if (search) {
                leads = leads.filter(lead => 
                    lead.name.toLowerCase().includes(search) ||
                    lead.email.toLowerCase().includes(search) ||
                    lead.phone.includes(search)
                );
            }
            
            if (statusFilter !== 'all') {
                leads = leads.filter(lead => lead.status === statusFilter);
            }
            
            if (sourceFilter !== 'all') {
                leads = leads.filter(lead => lead.source === sourceFilter);
            }
            
            const leadsList = document.getElementById('leadsList');
            if (leadsList) {
                leadsList.innerHTML = renderLeadsList(leads);
            }
            
            updateLeadsStats();
        }

        function updateLeadsStats() {
            const leads = dataManager.getLeads();
            const newLeads = leads.filter(l => l.status === 'new').length;
            const qualifiedLeads = leads.filter(l => l.status === 'qualified' || l.status === 'converted').length;
            const convertedLeads = leads.filter(l => l.status === 'converted').length;
            const conversionRate = leads.length > 0 ? (convertedLeads / leads.length * 100).toFixed(1) : 0;
            const avgScore = leads.length > 0 ? Math.round(leads.reduce((sum, l) => sum + l.score, 0) / leads.length) : 0;
            
            const newLeadsEl = document.getElementById('newLeadsCount');
            const qualifiedLeadsEl = document.getElementById('qualifiedLeadsCount');
            const conversionRateEl = document.getElementById('conversionRate');
            const avgScoreEl = document.getElementById('avgScore');
            
            if (newLeadsEl) newLeadsEl.textContent = newLeads;
            if (qualifiedLeadsEl) qualifiedLeadsEl.textContent = qualifiedLeads;
            if (conversionRateEl) conversionRateEl.textContent = conversionRate + '%';
            if (avgScoreEl) avgScoreEl.textContent = avgScore;
        }

        function createLead() {
            const campaigns = dataManager.getCampaigns();
            const campaignOptions = campaigns.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            const modalContent = `
                <h2>Create New Lead</h2>
                <form id="leadForm" class="modal-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadName">Full Name *</label>
                            <input type="text" id="leadName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="leadEmail">Email *</label>
                            <input type="email" id="leadEmail" name="email" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadPhone">Phone Number</label>
                            <input type="tel" id="leadPhone" name="phone">
                        </div>
                        <div class="form-group">
                            <label for="leadScore">Lead Score (0-100)</label>
                            <input type="number" id="leadScore" name="score" min="0" max="100" value="50">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="leadSource">Lead Source *</label>
                            <select id="leadSource" name="source" required>
                                <option value="">Select Source</option>
                                <option value="tiktok">TikTok</option>
                                <option value="instagram">Instagram</option>
                                <option value="snapchat">Snapchat</option>
                                <option value="website">Website</option>
                                <option value="referral">Referral</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="leadStatus">Status</label>
                            <select id="leadStatus" name="status">
                                <option value="new" selected>New</option>
                                <option value="contacted">Contacted</option>
                                <option value="qualified">Qualified</option>
                                <option value="converted">Converted</option>
                                <option value="lost">Lost</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="leadCampaign">Associated Campaign</label>
                        <select id="leadCampaign" name="campaignId">
                            <option value="">No Campaign</option>
                            ${campaignOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="leadNotes">Notes</label>
                        <textarea id="leadNotes" name="notes" rows="3" placeholder="Any additional information about this lead"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Lead</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('leadForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveLeadForm();
            });
        }

        function saveLeadForm() {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('leadForm'));
            
            const lead = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                score: parseInt(formData.get('score')) || 50,
                source: formData.get('source'),
                status: formData.get('status') || 'new',
                campaignId: formData.get('campaignId') ? parseInt(formData.get('campaignId')) : null,
                notes: formData.get('notes')
            };
            
            const rules = {
                name: { required: true, minLength: 2, maxLength: 100 },
                email: { required: true, pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/, message: 'Please enter a valid email address' },
                source: { required: true },
                score: { min: 0, max: 100 }
            };
            
            const errors = validateForm(lead, rules);
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Creating lead...');
            
            setTimeout(() => {
                try {
                    dataManager.saveLead(lead);
                    hideLoading();
                    closeModal();
                    showNotification('Lead created successfully!');
                    // Re-open lead management to show updated list
                    setTimeout(() => manageLeads(), 500);
                } catch (error) {
                    hideLoading();
                    showNotification('Error creating lead: ' + error.message, 'error');
                }
            }, 1000);
        }

        function editLead(id) {
            const leads = dataManager.getLeads();
            const lead = leads.find(l => l.id === id);
            
            if (!lead) {
                showNotification('Lead not found', 'error');
                return;
            }
            
            const campaigns = dataManager.getCampaigns();
            const campaignOptions = campaigns.map(c => 
                `<option value="${c.id}" ${lead.campaignId === c.id ? 'selected' : ''}>${c.name}</option>`
            ).join('');
            
            const modalContent = `
                <h2>Edit Lead: ${lead.name}</h2>
                <form id="editLeadForm" class="modal-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editLeadName">Full Name *</label>
                            <input type="text" id="editLeadName" name="name" value="${lead.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="editLeadEmail">Email *</label>
                            <input type="email" id="editLeadEmail" name="email" value="${lead.email}" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editLeadPhone">Phone Number</label>
                            <input type="tel" id="editLeadPhone" name="phone" value="${lead.phone || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editLeadScore">Lead Score (0-100)</label>
                            <input type="number" id="editLeadScore" name="score" min="0" max="100" value="${lead.score}">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editLeadSource">Lead Source *</label>
                            <select id="editLeadSource" name="source" required>
                                <option value="tiktok" ${lead.source === 'tiktok' ? 'selected' : ''}>TikTok</option>
                                <option value="instagram" ${lead.source === 'instagram' ? 'selected' : ''}>Instagram</option>
                                <option value="snapchat" ${lead.source === 'snapchat' ? 'selected' : ''}>Snapchat</option>
                                <option value="website" ${lead.source === 'website' ? 'selected' : ''}>Website</option>
                                <option value="referral" ${lead.source === 'referral' ? 'selected' : ''}>Referral</option>
                                <option value="other" ${lead.source === 'other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editLeadStatus">Status</label>
                            <select id="editLeadStatus" name="status">
                                <option value="new" ${lead.status === 'new' ? 'selected' : ''}>New</option>
                                <option value="contacted" ${lead.status === 'contacted' ? 'selected' : ''}>Contacted</option>
                                <option value="qualified" ${lead.status === 'qualified' ? 'selected' : ''}>Qualified</option>
                                <option value="converted" ${lead.status === 'converted' ? 'selected' : ''}>Converted</option>
                                <option value="lost" ${lead.status === 'lost' ? 'selected' : ''}>Lost</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editLeadCampaign">Associated Campaign</label>
                        <select id="editLeadCampaign" name="campaignId">
                            <option value="">No Campaign</option>
                            ${campaignOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editLeadNotes">Notes</label>
                        <textarea id="editLeadNotes" name="notes" rows="3">${lead.notes || ''}</textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="deleteLeadConfirm(${lead.id})" class="btn btn-danger">Delete</button>
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('editLeadForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateLead(lead.id);
            });
        }

        function updateLead(id) {
            clearFieldErrors();
            
            const formData = new FormData(document.getElementById('editLeadForm'));
            const existingLead = dataManager.getLeads().find(l => l.id === id);
            
            const updatedLead = {
                ...existingLead,
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                score: parseInt(formData.get('score')) || 50,
                source: formData.get('source'),
                status: formData.get('status'),
                campaignId: formData.get('campaignId') ? parseInt(formData.get('campaignId')) : null,
                notes: formData.get('notes')
            };
            
            const rules = {
                name: { required: true, minLength: 2, maxLength: 100 },
                email: { required: true, pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/, message: 'Please enter a valid email address' },
                source: { required: true },
                score: { min: 0, max: 100 }
            };
            
            const errors = validateForm(updatedLead, rules);
            
            if (Object.keys(errors).length > 0) {
                for (const field in errors) {
                    showFieldError(field, errors[field]);
                }
                return;
            }
            
            showLoading('Updating lead...');
            
            setTimeout(() => {
                try {
                    dataManager.saveLead(updatedLead);
                    hideLoading();
                    closeModal();
                    showNotification('Lead updated successfully!');
                    setTimeout(() => manageLeads(), 500);
                } catch (error) {
                    hideLoading();
                    showNotification('Error updating lead: ' + error.message, 'error');
                }
            }, 500);
        }

        function deleteLeadConfirm(id) {
            const lead = dataManager.getLeads().find(l => l.id === id);
            if (!lead) return;
            
            if (confirm(`Are you sure you want to delete the lead "${lead.name}"? This action cannot be undone.`)) {
                showLoading('Deleting lead...');
                
                setTimeout(() => {
                    try {
                        dataManager.deleteLead(id);
                        hideLoading();
                        closeModal();
                        showNotification('Lead deleted successfully!');
                        setTimeout(() => manageLeads(), 500);
                    } catch (error) {
                        hideLoading();
                        showNotification('Error deleting lead: ' + error.message, 'error');
                    }
                }, 500);
            }
        }

        function deleteLead(id) {
            deleteLeadConfirm(id);
        }

        function viewLeads() {
            manageLeads();
        }

        function exportLeads() {
            const statusFilter = document.getElementById('statusFilter')?.value || 'all';
            const sourceFilter = document.getElementById('sourceFilter')?.value || 'all';
            
            let leads = dataManager.getLeads();
            
            if (statusFilter !== 'all') {
                leads = leads.filter(lead => lead.status === statusFilter);
            }
            
            if (sourceFilter !== 'all') {
                leads = leads.filter(lead => lead.source === sourceFilter);
            }
            
            // Create CSV content
            const headers = ['Name', 'Email', 'Phone', 'Source', 'Status', 'Score', 'Created', 'Notes'];
            const csvContent = [
                headers.join(','),
                ...leads.map(row => [
                    `"${row.name}"`,
                    row.email,
                    row.phone || '',
                    row.source,
                    row.status,
                    row.score,
                    new Date(row.created).toLocaleDateString(),
                    `"${(row.notes || '').replace(/"/g, '""')}"`
                ].join(','))
            ].join('\\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `leads-${statusFilter}-${sourceFilter}-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Lead data exported successfully!');
        }

        // AUTOMATION MANAGEMENT FUNCTIONS
        function configureAutomation(type) {
            const automations = dataManager.getAutomations();
            let automation = null;
            
            if (type) {
                automation = automations.find(a => a.type === type);
            }
            
            const modalContent = `
                <h2>${type ? `Configure ${type.charAt(0).toUpperCase() + type.slice(1)} Automation` : 'Automation Center'}</h2>
                <div class="automation-container">
                    ${type ? renderAutomationConfig(automation) : renderAutomationList(automations)}
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                    ${!type ? '<button type="button" onclick="createAutomation()" class="btn btn-primary">New Automation</button>' : ''}
                </div>
            `;
            
            showModal(modalContent);
        }

        function renderAutomationList(automations) {
            return `
                <div class="automation-stats">
                    <div class="stat-card">
                        <div class="stat-value">${automations.filter(a => a.status === 'active').length}</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${automations.filter(a => a.status === 'paused').length}</div>
                        <div class="stat-label">Paused</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${automations.length}</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>
                
                <div class="automation-list">
                    ${automations.map(automation => {
                        const statusColor = automation.status === 'active' ? 'var(--success)' : 'var(--warning)';
                        const lastRun = new Date(automation.lastRun).toLocaleString();
                        
                        return `
                            <div class="automation-item">
                                <div class="automation-info">
                                    <div class="automation-header">
                                        <h4>${automation.name}</h4>
                                        <div class="automation-status" style="color: ${statusColor}">
                                            ${automation.status.charAt(0).toUpperCase() + automation.status.slice(1)}
                                        </div>
                                    </div>
                                    <div class="automation-details">
                                        <span class="automation-type">${automation.type.toUpperCase()}</span>
                                        <span class="automation-last-run">Last run: ${lastRun}</span>
                                    </div>
                                    <div class="automation-rules">${automation.rules}</div>
                                </div>
                                <div class="automation-actions">
                                    <button onclick="toggleAutomation(${automation.id})" class="btn btn-small ${automation.status === 'active' ? 'btn-secondary' : 'btn-primary'}">
                                        ${automation.status === 'active' ? 'Pause' : 'Start'}
                                    </button>
                                    <button onclick="editAutomation(${automation.id})" class="btn btn-small btn-secondary">Edit</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderAutomationConfig(automation) {
            if (!automation) return '<div class="no-automation">Automation not found.</div>';
            
            return `
                <form id="automationConfigForm" class="modal-form">
                    <div class="form-group">
                        <label for="automationName">Automation Name *</label>
                        <input type="text" id="automationName" name="name" value="${automation.name}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="automationRules">Rules & Description *</label>
                        <textarea id="automationRules" name="rules" rows="3" required>${automation.rules}</textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="automationStatus">Status</label>
                            <select id="automationStatus" name="status">
                                <option value="active" ${automation.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="paused" ${automation.status === 'paused' ? 'selected' : ''}>Paused</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="automationEnabled">Enabled</label>
                            <select id="automationEnabled" name="enabled">
                                <option value="true" ${automation.enabled ? 'selected' : ''}>Yes</option>
                                <option value="false" ${!automation.enabled ? 'selected' : ''}>No</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="automation-logs">
                        <h4>Recent Activity</h4>
                        <div class="log-entries">
                            <div class="log-entry">
                                <span class="log-time">${new Date(automation.lastRun).toLocaleString()}</span>
                                <span class="log-message">Automation executed successfully</span>
                                <span class="log-status success">Success</span>
                            </div>
                            <div class="log-entry">
                                <span class="log-time">${new Date(Date.now() - 60*60*1000).toLocaleString()}</span>
                                <span class="log-message">Processing ${automation.type} automation rules</span>
                                <span class="log-status info">Info</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="testAutomation(${automation.id})" class="btn btn-secondary">Test Run</button>
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            `;
        }

        function toggleAutomation(id) {
            const automations = dataManager.getAutomations();
            const automation = automations.find(a => a.id === id);
            
            if (!automation) return;
            
            automation.status = automation.status === 'active' ? 'paused' : 'active';
            automation.enabled = automation.status === 'active';
            
            dataManager.saveAutomation(automation);
            showNotification(`Automation ${automation.status === 'active' ? 'started' : 'paused'} successfully!`);
            
            // Refresh the modal if it's open
            setTimeout(() => configureAutomation(), 500);
        }

        function editAutomation(id) {
            const automations = dataManager.getAutomations();
            const automation = automations.find(a => a.id === id);
            
            if (!automation) return;
            
            configureAutomation(automation.type);
        }

        function testAutomation(id) {
            showLoading('Running automation test...');
            
            setTimeout(() => {
                hideLoading();
                showNotification('Automation test completed successfully!');
            }, 2000);
        }

        function startAutomation(type) {
            const automations = dataManager.getAutomations();
            const automation = automations.find(a => a.type === type);
            
            if (automation) {
                automation.status = 'active';
                automation.enabled = true;
                automation.lastRun = new Date().toISOString();
                
                dataManager.saveAutomation(automation);
                showNotification('Automation started successfully!');
                refreshDashboard();
            }
        }

        function viewLogs() {
            const automations = dataManager.getAutomations();
            
            const modalContent = `
                <h2>System Logs</h2>
                <div class="logs-container">
                    <div class="logs-filters">
                        <select id="logTypeFilter" onchange="filterLogs()">
                            <option value="all">All Types</option>
                            <option value="content">Content</option>
                            <option value="schedule">Schedule</option>
                            <option value="leads">Leads</option>
                            <option value="performance">Performance</option>
                        </select>
                        <select id="logLevelFilter" onchange="filterLogs()">
                            <option value="all">All Levels</option>
                            <option value="info">Info</option>
                            <option value="success">Success</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                        </select>
                    </div>
                    
                    <div class="logs-list" id="logsList">
                        ${generateLogEntries()}
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="exportLogs()" class="btn btn-secondary">Export Logs</button>
                    <button type="button" onclick="clearLogs()" class="btn btn-danger">Clear Logs</button>
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">Close</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        function generateLogEntries() {
            const logEntries = [];
            const now = new Date();
            
            // Generate sample log entries
            for (let i = 0; i < 20; i++) {
                const time = new Date(now.getTime() - (i * 30 * 60 * 1000));
                const types = ['content', 'schedule', 'leads', 'performance'];
                const levels = ['info', 'success', 'warning', 'error'];
                const messages = [
                    'Content generation completed',
                    'Scheduled post published',
                    'New lead qualified',
                    'Performance optimization running',
                    'Email campaign sent',
                    'Analytics data updated',
                    'Budget alert triggered',
                    'Campaign paused automatically'
                ];
                
                const type = types[Math.floor(Math.random() * types.length)];
                const level = levels[Math.floor(Math.random() * levels.length)];
                const message = messages[Math.floor(Math.random() * messages.length)];
                
                logEntries.push(`
                    <div class="log-entry" data-type="${type}" data-level="${level}">
                        <span class="log-time">${time.toLocaleString()}</span>
                        <span class="log-message">${message}</span>
                        <span class="log-type">${type.toUpperCase()}</span>
                        <span class="log-status ${level}">${level.charAt(0).toUpperCase() + level.slice(1)}</span>
                    </div>
                `);
            }
            
            return logEntries.join('');
        }

        function filterLogs() {
            const typeFilter = document.getElementById('logTypeFilter').value;
            const levelFilter = document.getElementById('logLevelFilter').value;
            const logEntries = document.querySelectorAll('.log-entry');
            
            logEntries.forEach(entry => {
                const type = entry.dataset.type;
                const level = entry.dataset.level;
                
                const showType = typeFilter === 'all' || type === typeFilter;
                const showLevel = levelFilter === 'all' || level === levelFilter;
                
                entry.style.display = (showType && showLevel) ? 'flex' : 'none';
            });
        }

        function exportLogs() {
            showNotification('Log export functionality would export system logs to a file.');
        }

        function clearLogs() {
            if (confirm('Are you sure you want to clear all logs? This action cannot be undone.')) {
                document.getElementById('logsList').innerHTML = '<div class="no-logs">No log entries found.</div>';
                showNotification('Logs cleared successfully!');
            }
        }

        // EXPORT/IMPORT DATA FUNCTIONS
        function exportData() {
            showLoading('Preparing data export...');
            
            setTimeout(() => {
                try {
                    dataManager.exportData();
                    hideLoading();
                    showNotification('Data exported successfully!');
                } catch (error) {
                    hideLoading();
                    showNotification('Error exporting data: ' + error.message, 'error');
                }
            }, 1000);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    showLoading('Importing data...');
                    
                    dataManager.importData(file)
                        .then(() => {
                            hideLoading();
                            showNotification('Data imported successfully!');
                            refreshDashboard();
                        })
                        .catch(error => {
                            hideLoading();
                            showNotification('Error importing data: ' + error.message, 'error');
                        });
                }
            };
            input.click();
        }

        // REPORT GENERATION FUNCTIONS
        function generateReport(type) {
            showLoading(`Generating ${type} report...`);
            
            setTimeout(() => {
                const reportData = generateReportData(type);
                downloadReport(reportData, type);
                hideLoading();
                showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} report generated successfully!`);
            }, 2000);
        }

        function generateReportData(type) {
            const campaigns = dataManager.getCampaigns();
            const content = dataManager.getContent();
            const leads = dataManager.getLeads();
            const analytics = dataManager.getAnalytics();
            
            switch (type) {
                case 'weekly':
                    return {
                        type: 'Weekly Performance Report',
                        period: 'Last 7 days',
                        campaigns: campaigns.filter(c => c.status === 'active').length,
                        content: content.filter(c => c.status === 'published').length,
                        leads: leads.length,
                        totalReach: analytics.slice(-7).reduce((sum, a) => sum + a.reach, 0),
                        totalEngagement: analytics.slice(-7).reduce((sum, a) => sum + a.engagement, 0)
                    };
                
                case 'leads':
                    return {
                        type: 'Lead Analysis Report',
                        totalLeads: leads.length,
                        newLeads: leads.filter(l => l.status === 'new').length,
                        qualifiedLeads: leads.filter(l => l.status === 'qualified').length,
                        convertedLeads: leads.filter(l => l.status === 'converted').length,
                        conversionRate: leads.length > 0 ? (leads.filter(l => l.status === 'converted').length / leads.length * 100).toFixed(2) : 0,
                        avgScore: leads.length > 0 ? (leads.reduce((sum, l) => sum + l.score, 0) / leads.length).toFixed(1) : 0
                    };
                
                case 'roi':
                    const totalSpent = campaigns.reduce((sum, c) => sum + c.spent, 0);
                    const totalRevenue = leads.filter(l => l.status === 'converted').length * 100; // Assume $100 per conversion
                    
                    return {
                        type: 'ROI Analysis Report',
                        totalSpent: totalSpent,
                        totalRevenue: totalRevenue,
                        roi: totalSpent > 0 ? ((totalRevenue - totalSpent) / totalSpent * 100).toFixed(2) : 0,
                        campaigns: campaigns.map(c => ({
                            name: c.name,
                            spent: c.spent,
                            roi: c.roi
                        }))
                    };
                
                case 'comprehensive':
                    return {
                        type: 'Comprehensive Marketing Report',
                        campaigns: campaigns.length,
                        activeCampaigns: campaigns.filter(c => c.status === 'active').length,
                        totalBudget: campaigns.reduce((sum, c) => sum + c.budget, 0),
                        totalSpent: campaigns.reduce((sum, c) => sum + c.spent, 0),
                        totalContent: content.length,
                        publishedContent: content.filter(c => c.status === 'published').length,
                        totalLeads: leads.length,
                        qualifiedLeads: leads.filter(l => l.status === 'qualified' || l.status === 'converted').length,
                        totalReach: analytics.reduce((sum, a) => sum + a.reach, 0),
                        totalEngagement: analytics.reduce((sum, a) => sum + a.engagement, 0)
                    };
                
                default:
                    return { type: 'Unknown Report', error: 'Report type not recognized' };
            }
        }

        function downloadReport(data, type) {
            const reportContent = `
MARKETING DASHBOARD REPORT
Generated: ${new Date().toLocaleString()}
Report Type: ${data.type}

${Object.entries(data).map(([key, value]) => {
    if (key === 'type') return '';
    if (Array.isArray(value)) {
        return `${key.toUpperCase()}:\n${value.map(item => 
            typeof item === 'object' ? 
            Object.entries(item).map(([k, v]) => `  ${k}: ${v}`).join('\n') :
            `  - ${item}`
        ).join('\n')}`;
    }
    return `${key.replace(/([A-Z])/g, ' $1').toUpperCase()}: ${value}`;
}).filter(Boolean).join('\n\n')}

--
Generated by BrainSAIT Marketing Dashboard
            `;
            
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${type}-report-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function scheduleReports() {
            const modalContent = `
                <h2>Schedule Reports</h2>
                <form id="scheduleReportsForm" class="modal-form">
                    <div class="form-group">
                        <label>Report Types</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="reportTypes" value="weekly"> Weekly Performance</label>
                            <label><input type="checkbox" name="reportTypes" value="leads"> Lead Analysis</label>
                            <label><input type="checkbox" name="reportTypes" value="roi"> ROI Analysis</label>
                            <label><input type="checkbox" name="reportTypes" value="comprehensive"> Comprehensive</label>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportFrequency">Frequency</label>
                            <select id="reportFrequency" name="frequency">
                                <option value="daily">Daily</option>
                                <option value="weekly" selected>Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportTime">Time</label>
                            <input type="time" id="reportTime" name="time" value="09:00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportEmail">Email Recipients</label>
                        <input type="email" id="reportEmail" name="email" placeholder="Enter email addresses separated by commas">
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Schedule Reports</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('scheduleReportsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                showLoading('Scheduling reports...');
                
                setTimeout(() => {
                    hideLoading();
                    closeModal();
                    showNotification('Reports scheduled successfully!');
                }, 1000);
            });
        }

        // ===========================================
        // AI SERVICES INFRASTRUCTURE
        // ===========================================

        class AIContentService {
            constructor() {
                this.apiKeys = this.loadAPIKeys();
                this.sessions = this.loadSessions();
                this.workflows = this.loadWorkflows();
                this.usage = this.loadUsage();
                this.providers = {
                    openai: { status: 'connected', model: 'gpt-4' },
                    anthropic: { status: 'connected', model: 'claude-3' },
                    midjourney: { status: 'connected', model: 'v6' },
                    coqui: { status: 'connected', model: 'tts' }
                };
                this.initializeAI();
            }

            initializeAI() {
                this.checkProvidersStatus();
                this.loadDefaultWorkflows();
                this.trackUsage();
            }

            loadAPIKeys() {
                return JSON.parse(localStorage.getItem('ai_api_keys') || '{}');
            }

            saveAPIKeys(keys) {
                localStorage.setItem('ai_api_keys', JSON.stringify(keys));
                this.apiKeys = keys;
            }

            loadSessions() {
                return JSON.parse(localStorage.getItem('ai_sessions') || '[]');
            }

            saveSessions() {
                localStorage.setItem('ai_sessions', JSON.stringify(this.sessions));
            }

            loadWorkflows() {
                return JSON.parse(localStorage.getItem('ai_workflows') || '[]');
            }

            saveWorkflows() {
                localStorage.setItem('ai_workflows', JSON.stringify(this.workflows));
            }

            loadUsage() {
                return JSON.parse(localStorage.getItem('ai_usage') || '{"daily": 0, "monthly": 0, "total": 0}');
            }

            saveUsage() {
                localStorage.setItem('ai_usage', JSON.stringify(this.usage));
            }

            checkProvidersStatus() {
                Object.keys(this.providers).forEach(provider => {
                    this.providers[provider].status = Math.random() > 0.1 ? 'connected' : 'error';
                });
            }

            async generateContent(prompt, options = {}) {
                const sessionId = Date.now().toString();
                const session = {
                    id: sessionId,
                    prompt,
                    options,
                    status: 'generating',
                    createdAt: new Date().toISOString(),
                    results: []
                };

                this.sessions.unshift(session);
                this.saveSessions();

                try {
                    await this.delay(2000 + Math.random() * 3000);
                    
                    const results = await this.simulateAIResponse(prompt, options);
                    session.results = results;
                    session.status = 'completed';
                    session.completedAt = new Date().toISOString();
                    
                    this.updateUsage(options.provider || 'openai');
                    this.saveSessions();
                    
                    return { sessionId, results };
                } catch (error) {
                    session.status = 'error';
                    session.error = error.message;
                    this.saveSessions();
                    throw error;
                }
            }

            async simulateAIResponse(prompt, options) {
                const contentTypes = {
                    text: this.generateTextContent(prompt, options),
                    image: this.generateImageContent(prompt, options),
                    voice: this.generateVoiceContent(prompt, options),
                    video: this.generateVideoContent(prompt, options)
                };

                const requestedTypes = options.contentTypes || ['text'];
                const results = [];

                for (const type of requestedTypes) {
                    if (contentTypes[type]) {
                        results.push(await contentTypes[type]);
                    }
                }

                return results;
            }

            generateTextContent(prompt, options) {
                const platforms = options.platforms || ['general'];
                const language = options.language || 'en';
                
                const sampleContent = {
                    en: {
                        general: "Transform your marketing strategy with AI-powered insights! Our advanced analytics help you understand customer behavior, optimize campaigns, and drive unprecedented growth. Ready to revolutionize your approach?",
                        tiktok: "POV: Your marketing game just leveled up! 🚀✨ AI-powered campaigns that actually convert. Who else is ready to dominate 2024? #MarketingTips #AI #BusinessGrowth",
                        instagram: "Unlock the power of AI in your marketing strategy! 📊✨ From personalized campaigns to predictive analytics - we've got you covered. Swipe for tips! #MarketingAI #DigitalStrategy #BrainSAIT",
                        youtube: "Welcome back to our channel! Today we're diving deep into how AI is revolutionizing marketing automation. You'll learn 5 game-changing strategies that can boost your ROI by 300%!",
                        snapchat: "Just discovered the secret to viral marketing... 🤫 It's all about AI timing and personalization! DM for the full strategy 📱"
                    },
                    ar: {
                        general: "حوّل استراتيجيتك التسويقية باستخدام رؤى مدعومة بالذكاء الاصطناعي! تساعدك تحليلاتنا المتقدمة على فهم سلوك العملاء وتحسين الحملات وقيادة نمو غير مسبوق.",
                        tiktok: "تخيل: لعبة التسويق الخاصة بك ارتقت للمستوى التالي! 🚀✨ حملات مدعومة بالذكاء الاصطناعي تحقق نتائج فعلية #نصائح_التسويق #الذكاء_الاصطناعي",
                        instagram: "اكتشف قوة الذكاء الاصطناعي في استراتيجيتك التسويقية! 📊✨ من الحملات الشخصية إلى التحليلات التنبؤية #التسويق_الذكي #الاستراتيجية_الرقمية"
                    }
                };

                const content = platforms.map(platform => ({
                    platform,
                    content: sampleContent[language]?.[platform] || sampleContent[language]?.general || sampleContent.en.general,
                    hashtags: this.generateHashtags(prompt, platform, language),
                    metrics: this.predictPerformance(platform)
                }));

                return {
                    type: 'text',
                    provider: options.provider || 'openai',
                    content,
                    optimization: this.generateOptimizationSuggestions(content)
                };
            }

            generateImageContent(prompt, options) {
                const imagePrompts = [
                    `Professional marketing visualization: ${prompt}`,
                    `Modern digital art style: ${prompt}`,
                    `Minimalist design concept: ${prompt}`,
                    `Vibrant social media graphic: ${prompt}`
                ];

                return {
                    type: 'image',
                    provider: 'midjourney',
                    results: imagePrompts.map((p, i) => ({
                        prompt: p,
                        url: `https://via.placeholder.com/512x512/6366f1/white?text=AI+Generated+${i+1}`,
                        aspectRatio: options.aspectRatio || '1:1',
                        quality: 'high'
                    }))
                };
            }

            generateVoiceContent(prompt, options) {
                return {
                    type: 'voice',
                    provider: 'coqui',
                    results: [{
                        text: prompt,
                        audioUrl: '#',
                        voice: options.voice || 'professional',
                        language: options.language || 'en',
                        duration: '30s'
                    }]
                };
            }

            generateVideoContent(prompt, options) {
                const videoTypes = {
                    'tiktok': { duration: '15-60s', format: 'vertical', style: 'trending' },
                    'instagram': { duration: '15-90s', format: 'square/vertical', style: 'aesthetic' },
                    'youtube': { duration: '1-15min', format: 'horizontal', style: 'professional' },
                    'snapchat': { duration: '10-60s', format: 'vertical', style: 'authentic' }
                };

                const platformConfig = videoTypes[options.platform] || videoTypes['instagram'];
                
                return {
                    type: 'video',
                    provider: 'ai-video',
                    results: [{
                        title: `Video: ${prompt.substring(0, 50)}...`,
                        script: this.generateVideoScript(prompt, options),
                        duration: platformConfig.duration,
                        format: platformConfig.format,
                        style: platformConfig.style,
                        scenes: this.generateVideoScenes(prompt, options),
                        thumbnailPrompt: `Engaging thumbnail for: ${prompt}`,
                        videoUrl: '#', // Placeholder for generated video
                        status: 'ready'
                    }]
                };
            }

            generateVideoScript(prompt, options) {
                const scripts = {
                    'tiktok': [
                        "Hook: Did you know this secret about marketing?",
                        "Main content: " + prompt,
                        "Call to action: Follow for more marketing tips!"
                    ],
                    'instagram': [
                        "Introduction: Welcome back to BrainSAIT!",
                        "Main content: " + prompt,
                        "Engagement: What do you think? Comment below!"
                    ],
                    'youtube': [
                        "Introduction: In today's video, we'll explore...",
                        "Main content: " + prompt,
                        "Conclusion: Don't forget to like and subscribe!"
                    ]
                };

                return scripts[options.platform] || scripts['instagram'];
            }

            generateVideoScenes(prompt, options) {
                return [
                    {
                        scene: 1,
                        duration: '3s',
                        description: 'Hook/intro scene with eye-catching visual',
                        text: 'Opening hook'
                    },
                    {
                        scene: 2,
                        duration: '10s',
                        description: 'Main content explanation with graphics',
                        text: prompt.substring(0, 100)
                    },
                    {
                        scene: 3,
                        duration: '3s',
                        description: 'Call to action with branding',
                        text: 'Follow BrainSAIT for more!'
                    }
                ];
            }

            generateHashtags(prompt, platform, language) {
                const hashtagSets = {
                    en: {
                        general: ['#Marketing', '#AI', '#DigitalStrategy', '#BrainSAIT', '#Innovation'],
                        tiktok: ['#MarketingTips', '#AI', '#BusinessGrowth', '#Viral', '#Trending'],
                        instagram: ['#MarketingAI', '#DigitalStrategy', '#BrainSAIT', '#SocialMedia', '#Automation']
                    },
                    ar: {
                        general: ['#التسويق', '#الذكاء_الاصطناعي', '#الاستراتيجية_الرقمية', '#الابتكار'],
                        tiktok: ['#نصائح_التسويق', '#الذكاء_الاصطناعي', '#النمو_التجاري', '#ترند']
                    }
                };

                return hashtagSets[language]?.[platform] || hashtagSets[language]?.general || hashtagSets.en.general;
            }

            predictPerformance(platform) {
                const baseMetrics = {
                    tiktok: { reach: 10000, engagement: 0.08, shares: 500 },
                    instagram: { reach: 5000, engagement: 0.06, likes: 300 },
                    youtube: { reach: 2000, engagement: 0.12, views: 1500 },
                    general: { reach: 4000, engagement: 0.07, interactions: 280 }
                };

                const base = baseMetrics[platform] || baseMetrics.general;
                const variance = 0.3;

                return Object.keys(base).reduce((acc, key) => {
                    acc[key] = Math.round(base[key] * (1 + (Math.random() - 0.5) * variance));
                    return acc;
                }, {});
            }

            generateOptimizationSuggestions(content) {
                return [
                    "Consider adding a call-to-action for higher engagement",
                    "Optimal posting time: 7-9 PM local time",
                    "Add trending hashtags for better reach",
                    "Include user-generated content mentions"
                ];
            }

            updateUsage(provider) {
                this.usage.daily += 1;
                this.usage.monthly += 1;
                this.usage.total += 1;
                this.usage.lastUsed = new Date().toISOString();
                this.usage[provider] = (this.usage[provider] || 0) + 1;
                this.saveUsage();
            }

            trackUsage() {
                const now = new Date();
                const lastReset = new Date(this.usage.lastReset || 0);
                
                if (now.getDate() !== lastReset.getDate()) {
                    this.usage.daily = 0;
                    this.usage.lastReset = now.toISOString();
                    this.saveUsage();
                }
            }

            loadDefaultWorkflows() {
                if (this.workflows.length === 0) {
                    this.workflows = [
                        {
                            id: 'viral-content',
                            name: 'Viral Content Creation',
                            description: 'AI-powered workflow for creating viral social media content',
                            steps: [
                                { id: 1, name: 'Trend Analysis', type: 'analysis', aiProvider: 'openai' },
                                { id: 2, name: 'Content Generation', type: 'generation', aiProvider: 'openai' },
                                { id: 3, name: 'Image Creation', type: 'image', aiProvider: 'midjourney' },
                                { id: 4, name: 'Performance Prediction', type: 'analytics', aiProvider: 'anthropic' }
                            ],
                            automation: 'semi-auto',
                            platforms: ['tiktok', 'instagram', 'youtube'],
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 'educational-content',
                            name: 'Educational Content Series',
                            description: 'Create comprehensive educational content across platforms',
                            steps: [
                                { id: 1, name: 'Topic Research', type: 'research', aiProvider: 'anthropic' },
                                { id: 2, name: 'Content Writing', type: 'generation', aiProvider: 'anthropic' },
                                { id: 3, name: 'Visual Creation', type: 'image', aiProvider: 'midjourney' }
                            ],
                            automation: 'manual',
                            platforms: ['youtube', 'instagram', 'blog'],
                            createdAt: new Date().toISOString()
                        }
                    ];
                    this.saveWorkflows();
                }
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            async executeWorkflow(workflowId, inputs = {}) {
                const workflow = this.workflows.find(w => w.id === workflowId);
                if (!workflow) throw new Error('Workflow not found');

                const execution = {
                    id: Date.now().toString(),
                    workflowId,
                    status: 'running',
                    startedAt: new Date().toISOString(),
                    steps: workflow.steps.map(step => ({ ...step, status: 'pending' })),
                    inputs,
                    results: {}
                };

                for (let i = 0; i < execution.steps.length; i++) {
                    const step = execution.steps[i];
                    step.status = 'running';
                    
                    await this.delay(1000 + Math.random() * 2000);
                    
                    try {
                        execution.results[step.id] = await this.executeWorkflowStep(step, inputs);
                        step.status = 'completed';
                    } catch (error) {
                        step.status = 'error';
                        step.error = error.message;
                        execution.status = 'error';
                        break;
                    }
                }

                if (execution.status !== 'error') {
                    execution.status = 'completed';
                    execution.completedAt = new Date().toISOString();
                }

                return execution;
            }

            async executeWorkflowStep(step, inputs) {
                switch (step.type) {
                    case 'analysis':
                        return { analysis: 'Trend analysis complete', insights: ['Insight 1', 'Insight 2'] };
                    case 'generation':
                        return await this.generateContent(inputs.prompt || 'Generate content', { provider: step.aiProvider });
                    case 'image':
                        return { images: ['image1.jpg', 'image2.jpg'], style: 'professional' };
                    default:
                        return { result: `${step.name} completed successfully` };
                }
            }
        }

        // Initialize AI Service
        let aiService;

        // ===========================================
        // AI UI COMPONENTS AND FUNCTIONS
        // ===========================================

        function initializeAIHub() {
            if (!aiService) {
                aiService = new AIContentService();
            }
        }

        function showAIHub() {
            initializeAIHub();
            
            const aiHubHTML = `
                <div class="ai-hub-container">
                    <div class="ai-hub-header">
                        <h2>🧠 BrainSAIT AI Hub</h2>
                        <p>Advanced AI-powered marketing automation and content generation</p>
                        <div class="ai-status-indicators">
                            ${Object.entries(aiService.providers).map(([provider, info]) => `
                                <div class="ai-status ${info.status}">
                                    <div class="status-dot"></div>
                                    <span>${provider.toUpperCase()}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="ai-hub-tabs">
                        <button class="ai-tab active" onclick="showAITab('content')">Content Generation</button>
                        <button class="ai-tab" onclick="showAITab('workflow')">Workflow Builder</button>
                        <button class="ai-tab" onclick="showAITab('integrations')">AI Integrations</button>
                        <button class="ai-tab" onclick="showAITab('analytics')">AI Analytics</button>
                    </div>

                    <div class="ai-hub-content">
                        <div id="ai-content-tab" class="ai-tab-content active">
                            ${renderContentGenerationTab()}
                        </div>
                        <div id="ai-workflow-tab" class="ai-tab-content">
                            ${renderWorkflowBuilderTab()}
                        </div>
                        <div id="ai-integrations-tab" class="ai-tab-content">
                            ${renderIntegrationsTab()}
                        </div>
                        <div id="ai-analytics-tab" class="ai-tab-content">
                            ${renderAnalyticsTab()}
                        </div>
                    </div>
                </div>
            `;

            showModal(aiHubHTML, 'ai-hub-modal');
            addAIHubStyles();
        }

        function showAITab(tabName) {
            document.querySelectorAll('.ai-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.ai-tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`ai-${tabName}-tab`).classList.add('active');
        }

        function renderContentGenerationTab() {
            return `
                <div class="content-generation-section">
                    <div class="content-form-section">
                        <h3>AI Content Generation</h3>
                        <form id="aiContentForm" class="ai-content-form">
                            <div class="form-group">
                                <label for="contentPrompt">Content Prompt</label>
                                <textarea id="contentPrompt" name="prompt" placeholder="Describe the content you want to create..." rows="3" required></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contentProvider">AI Provider</label>
                                    <select id="contentProvider" name="provider">
                                        <option value="openai">OpenAI GPT-4</option>
                                        <option value="anthropic">Anthropic Claude</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="contentLanguage">Language</label>
                                    <select id="contentLanguage" name="language">
                                        <option value="en">English</option>
                                        <option value="ar">Arabic</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Content Types</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="contentTypes" value="text" checked> Text Content</label>
                                    <label><input type="checkbox" name="contentTypes" value="image"> AI Images</label>
                                    <label><input type="checkbox" name="contentTypes" value="voice"> Voice Generation</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Target Platforms</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="platforms" value="tiktok"> TikTok</label>
                                    <label><input type="checkbox" name="platforms" value="instagram" checked> Instagram</label>
                                    <label><input type="checkbox" name="platforms" value="youtube"> YouTube</label>
                                    <label><input type="checkbox" name="platforms" value="general"> General</label>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">🚀 Generate Content</button>
                                <button type="button" onclick="clearContentForm()" class="btn btn-secondary">Clear</button>
                            </div>
                        </form>
                    </div>

                    <div class="content-sessions-section">
                        <h3>Recent Sessions</h3>
                        <div id="contentSessionsList">
                            ${renderContentSessions()}
                        </div>
                    </div>
                </div>

                <div id="contentResults" class="content-results hidden">
                    <h3>Generated Content</h3>
                    <div id="contentResultsContainer"></div>
                </div>
            `;
        }

        function renderWorkflowBuilderTab() {
            return `
                <div class="workflow-builder-section">
                    <div class="workflow-templates">
                        <h3>Workflow Templates</h3>
                        <div class="workflow-templates-grid">
                            ${aiService.workflows.map(workflow => `
                                <div class="workflow-template-card">
                                    <h4>${workflow.name}</h4>
                                    <p>${workflow.description}</p>
                                    <div class="workflow-meta">
                                        <span class="workflow-automation">${workflow.automation}</span>
                                        <span class="workflow-steps">${workflow.steps.length} steps</span>
                                    </div>
                                    <div class="workflow-platforms">
                                        ${workflow.platforms.map(p => `<span class="platform-tag">${p}</span>`).join('')}
                                    </div>
                                    <div class="workflow-actions">
                                        <button class="btn btn-small btn-primary" onclick="executeWorkflowTemplate('${workflow.id}')">Execute</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderIntegrationsTab() {
            return `
                <div class="integrations-section">
                    <div class="ai-providers-grid">
                        ${Object.entries(aiService.providers).map(([provider, info]) => `
                            <div class="ai-provider-card ${info.status}">
                                <div class="provider-header">
                                    <h4>${provider.toUpperCase()}</h4>
                                    <div class="status-indicator ${info.status}">
                                        <div class="status-dot"></div>
                                        <span>${info.status}</span>
                                    </div>
                                </div>
                                <div class="provider-model">Model: ${info.model}</div>
                                <div class="provider-usage">Usage: ${aiService.usage[provider] || 0} requests</div>
                                <div class="provider-actions">
                                    <button class="btn btn-small btn-secondary" onclick="configureProvider('${provider}')">Configure</button>
                                    <button class="btn btn-small btn-primary" onclick="testProvider('${provider}')">Test</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderAnalyticsTab() {
            return `
                <div class="ai-analytics-section">
                    <div class="analytics-overview">
                        <h3>AI Performance Analytics</h3>
                        <div class="analytics-cards">
                            <div class="analytics-card">
                                <h4>Content Generated</h4>
                                <span class="metric-value">${aiService.sessions.length}</span>
                            </div>
                            <div class="analytics-card">
                                <h4>Workflows Executed</h4>
                                <span class="metric-value">${Math.floor(aiService.usage.total * 0.3)}</span>
                            </div>
                            <div class="analytics-card">
                                <h4>Success Rate</h4>
                                <span class="metric-value">98.5%</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderContentSessions() {
            if (aiService.sessions.length === 0) {
                return '<p class="empty-state">No content generation sessions yet</p>';
            }

            return aiService.sessions.slice(0, 5).map(session => `
                <div class="session-card ${session.status}">
                    <div class="session-header">
                        <span class="session-id">#${session.id.slice(-6)}</span>
                        <span class="session-status ${session.status}">${session.status}</span>
                    </div>
                    <div class="session-prompt">${session.prompt.substring(0, 100)}${session.prompt.length > 100 ? '...' : ''}</div>
                    <div class="session-meta">
                        <span class="session-time">${new Date(session.createdAt).toLocaleString()}</span>
                    </div>
                </div>
            `).join('');
        }

        async function handleContentGeneration() {
            const form = document.getElementById('aiContentForm');
            const formData = new FormData(form);
            
            const prompt = formData.get('prompt');
            const provider = formData.get('provider');
            const language = formData.get('language');
            
            const contentTypes = Array.from(formData.getAll('contentTypes'));
            const platforms = Array.from(formData.getAll('platforms'));
            
            if (!prompt.trim()) {
                showNotification('Please enter a content prompt', 'error');
                return;
            }

            const options = { provider, language, contentTypes, platforms };

            try {
                showAIProgress('Generating AI content...');
                
                const result = await aiService.generateContent(prompt, options);
                
                hideAIProgress();
                displayContentResults(result.results);
                updateContentSessionsList();
                showNotification('Content generated successfully!');
                
            } catch (error) {
                hideAIProgress();
                showNotification('Error generating content: ' + error.message, 'error');
            }
        }

        function displayContentResults(results) {
            const resultsContainer = document.getElementById('contentResultsContainer');
            const resultsSection = document.getElementById('contentResults');
            
            resultsContainer.innerHTML = results.map(result => {
                if (result.type === 'text') {
                    return `
                        <div class="result-section">
                            <h4>📝 Text Content (${result.provider})</h4>
                            ${result.content.map(content => `
                                <div class="content-item">
                                    <div class="content-platform">${content.platform.toUpperCase()}</div>
                                    <div class="content-text">${content.content}</div>
                                    <div class="content-hashtags">${content.hashtags.join(' ')}</div>
                                    <div class="content-metrics">
                                        Predicted: ${Object.entries(content.metrics).map(([k,v]) => `${k}: ${v}`).join(', ')}
                                    </div>
                                    <div class="content-actions">
                                        <button class="btn btn-small btn-secondary" onclick="copyToClipboard('${content.content.replace(/'/g, "\\'")}')"">Copy</button>
                                    </div>
                                </div>
                            `).join('')}
                            <div class="optimization-suggestions">
                                <h5>💡 Optimization Suggestions:</h5>
                                <ul>
                                    ${result.optimization.map(tip => `<li>${tip}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                } else if (result.type === 'image') {
                    return `
                        <div class="result-section">
                            <h4>🎨 AI Generated Images (${result.provider})</h4>
                            <div class="image-grid">
                                ${result.results.map(img => `
                                    <div class="image-result">
                                        <img src="${img.url}" alt="AI Generated Image" />
                                        <div class="image-meta">
                                            <span>${img.aspectRatio}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                return '';
            }).join('');
            
            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        async function executeWorkflowTemplate(workflowId) {
            const prompt = window.prompt('Enter content prompt for workflow execution:');
            if (!prompt) return;

            try {
                showAIProgress('Executing workflow...');
                
                const execution = await aiService.executeWorkflow(workflowId, { prompt });
                
                hideAIProgress();
                showWorkflowResults(execution);
                showNotification('Workflow executed successfully!');
                
            } catch (error) {
                hideAIProgress();
                showNotification('Error executing workflow: ' + error.message, 'error');
            }
        }

        function showWorkflowResults(execution) {
            const resultsHTML = `
                <div class="workflow-results">
                    <h3>Workflow Execution Results</h3>
                    <div class="execution-header">
                        <span class="execution-id">ID: ${execution.id}</span>
                        <span class="execution-status ${execution.status}">${execution.status}</span>
                    </div>
                    <div class="execution-steps">
                        ${execution.steps.map(step => `
                            <div class="execution-step ${step.status}">
                                <div class="step-name">${step.name}</div>
                                <div class="step-status">${step.status}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            showModal(resultsHTML);
        }

        function clearContentForm() {
            document.getElementById('aiContentForm').reset();
            document.getElementById('contentResults').classList.add('hidden');
        }

        function updateContentSessionsList() {
            const sessionsList = document.getElementById('contentSessionsList');
            if (sessionsList) {
                sessionsList.innerHTML = renderContentSessions();
            }
        }

        function showAIProgress(message) {
            const progressHTML = `
                <div class="ai-progress-overlay">
                    <div class="ai-progress-container">
                        <div class="ai-progress-spinner"></div>
                        <div class="ai-progress-message">${message}</div>
                        <div class="ai-progress-details">Please wait while AI processes your request...</div>
                    </div>
                </div>
            `;
            
            const overlay = document.createElement('div');
            overlay.className = 'ai-progress-wrapper';
            overlay.innerHTML = progressHTML;
            document.body.appendChild(overlay);
        }

        function hideAIProgress() {
            const progressWrapper = document.querySelector('.ai-progress-wrapper');
            if (progressWrapper) {
                progressWrapper.remove();
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Content copied to clipboard!');
            });
        }

        function configureProvider(provider) {
            const modalContent = `
                <h2>Configure ${provider.toUpperCase()}</h2>
                <form id="providerConfigForm" class="modal-form">
                    <div class="form-group">
                        <label for="apiKey">API Key</label>
                        <input type="password" id="apiKey" name="apiKey" placeholder="Enter your ${provider} API key">
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            `;
            
            showModal(modalContent);
            
            document.getElementById('providerConfigForm').addEventListener('submit', function(e) {
                e.preventDefault();
                closeModal();
                showNotification(`${provider.toUpperCase()} configured successfully!`);
            });
        }

        async function testProvider(provider) {
            showLoading(`Testing ${provider} connection...`);
            
            await aiService.delay(1000 + Math.random() * 2000);
            
            const isSuccess = Math.random() > 0.1;
            
            if (isSuccess) {
                aiService.providers[provider].status = 'connected';
                showNotification(`${provider.toUpperCase()} connection successful!`);
            } else {
                aiService.providers[provider].status = 'error';
                showNotification(`${provider.toUpperCase()} connection failed!`, 'error');
            }
            
            hideLoading();
        }

        function addAIHubStyles() {
            if (document.getElementById('ai-hub-styles')) return;
            
            const styles = document.createElement('style');
            styles.id = 'ai-hub-styles';
            styles.textContent = `
                .ai-hub-modal {
                    max-width: 1200px !important;
                    width: 95% !important;
                    max-height: 90vh !important;
                    overflow-y: auto !important;
                }
                
                .ai-hub-container {
                    padding: 0;
                }
                
                .ai-hub-header {
                    background: linear-gradient(135deg, var(--primary), var(--primary-light));
                    color: white;
                    padding: 24px;
                    margin: -24px -24px 24px -24px;
                    border-radius: var(--radius) var(--radius) 0 0;
                }
                
                .ai-hub-header h2 {
                    margin: 0 0 8px 0;
                    font-size: 28px;
                    font-weight: 700;
                }
                
                .ai-hub-header p {
                    margin: 0 0 16px 0;
                    opacity: 0.9;
                    font-size: 16px;
                }
                
                .ai-status-indicators {
                    display: flex;
                    gap: 12px;
                    flex-wrap: wrap;
                }
                
                .ai-status {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    background: rgba(255,255,255,0.1);
                    padding: 6px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-weight: 500;
                }
                
                .ai-status .status-dot {
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    background: #10b981;
                }
                
                .ai-status.error .status-dot {
                    background: #ef4444;
                }
                
                .ai-hub-tabs {
                    display: flex;
                    border-bottom: 1px solid var(--border);
                    margin-bottom: 24px;
                    overflow-x: auto;
                }
                
                .ai-tab {
                    background: none;
                    border: none;
                    padding: 12px 24px;
                    cursor: pointer;
                    color: var(--text-secondary);
                    font-weight: 500;
                    white-space: nowrap;
                    border-bottom: 2px solid transparent;
                    transition: all 0.2s ease;
                }
                
                .ai-tab:hover {
                    color: var(--primary);
                    background: var(--bg-secondary);
                }
                
                .ai-tab.active {
                    color: var(--primary);
                    border-bottom-color: var(--primary);
                    background: var(--bg-secondary);
                }
                
                .ai-tab-content {
                    display: none;
                }
                
                .ai-tab-content.active {
                    display: block;
                }
                
                .content-generation-section {
                    display: grid;
                    grid-template-columns: 2fr 1fr;
                    gap: 24px;
                    margin-bottom: 24px;
                }
                
                @media (max-width: 768px) {
                    .content-generation-section {
                        grid-template-columns: 1fr;
                    }
                }
                
                .ai-content-form .form-row {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 16px;
                    margin-bottom: 16px;
                }
                
                .ai-content-form .form-group {
                    margin-bottom: 16px;
                }
                
                .ai-content-form label {
                    display: block;
                    margin-bottom: 6px;
                    font-weight: 500;
                    color: var(--text-primary);
                }
                
                .ai-content-form textarea,
                .ai-content-form select {
                    width: 100%;
                    padding: 10px 12px;
                    border: 1px solid var(--border);
                    border-radius: var(--radius);
                    background: var(--bg-primary);
                    color: var(--text-primary);
                    font-size: 14px;
                }
                
                .ai-content-form textarea {
                    resize: vertical;
                    min-height: 80px;
                }
                
                .checkbox-group {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 8px;
                }
                
                .checkbox-group label {
                    display: flex !important;
                    align-items: center;
                    gap: 8px;
                    font-weight: normal !important;
                    cursor: pointer;
                    padding: 8px;
                    border-radius: var(--radius);
                    transition: background-color 0.2s ease;
                }
                
                .checkbox-group label:hover {
                    background: var(--bg-secondary);
                }
                
                .checkbox-group input[type="checkbox"] {
                    margin: 0;
                }
                
                .session-card {
                    background: var(--bg-primary);
                    border: 1px solid var(--border);
                    border-radius: var(--radius);
                    padding: 16px;
                    margin-bottom: 12px;
                }
                
                .session-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 8px;
                }
                
                .session-id {
                    font-family: monospace;
                    font-size: 12px;
                    color: var(--text-muted);
                }
                
                .session-status {
                    padding: 4px 8px;
                    border-radius: 12px;
                    font-size: 11px;
                    font-weight: 600;
                    text-transform: uppercase;
                }
                
                .session-status.completed {
                    background: #dcfce7;
                    color: #166534;
                }
                
                .session-status.generating {
                    background: #fef3c7;
                    color: #92400e;
                }
                
                .session-status.error {
                    background: #fecaca;
                    color: #991b1b;
                }
                
                .session-prompt {
                    color: var(--text-primary);
                    margin-bottom: 8px;
                    line-height: 1.4;
                }
                
                .session-meta {
                    display: flex;
                    justify-content: space-between;
                    font-size: 12px;
                    color: var(--text-muted);
                    margin-bottom: 12px;
                }
                
                .content-results {
                    border-top: 1px solid var(--border);
                    padding-top: 24px;
                    margin-top: 24px;
                }
                
                .result-section {
                    background: var(--bg-secondary);
                    border-radius: var(--radius);
                    padding: 20px;
                    margin-bottom: 20px;
                }
                
                .result-section h4 {
                    margin: 0 0 16px 0;
                    color: var(--primary);
                    font-size: 18px;
                }
                
                .content-item {
                    background: var(--bg-primary);
                    border: 1px solid var(--border);
                    border-radius: var(--radius);
                    padding: 16px;
                    margin-bottom: 16px;
                }
                
                .content-platform {
                    background: var(--primary);
                    color: white;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 11px;
                    font-weight: 600;
                    display: inline-block;
                    margin-bottom: 12px;
                }
                
                .content-text {
                    font-size: 16px;
                    line-height: 1.5;
                    margin-bottom: 12px;
                    color: var(--text-primary);
                }
                
                .content-hashtags {
                    color: var(--primary);
                    font-weight: 500;
                    margin-bottom: 8px;
                }
                
                .content-metrics {
                    font-size: 12px;
                    color: var(--text-muted);
                    margin-bottom: 12px;
                }
                
                .content-actions {
                    display: flex;
                    gap: 8px;
                }
                
                .optimization-suggestions {
                    background: var(--bg-primary);
                    border: 1px solid var(--border);
                    border-radius: var(--radius);
                    padding: 16px;
                    margin-top: 16px;
                }
                
                .optimization-suggestions h5 {
                    margin: 0 0 12px 0;
                    color: var(--primary);
                }
                
                .optimization-suggestions ul {
                    margin: 0;
                    padding-left: 20px;
                    color: var(--text-secondary);
                }
                
                .optimization-suggestions li {
                    margin-bottom: 4px;
                    line-height: 1.4;
                }
                
                .workflow-templates-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 20px;
                    margin-bottom: 32px;
                }
                
                .workflow-template-card {
                    background: var(--bg-primary);
                    border: 1px solid var(--border);
                    border-radius: var(--radius);
                    padding: 20px;
                    transition: all 0.2s ease;
                }
                
                .workflow-template-card:hover {
                    border-color: var(--primary);
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                }
                
                .workflow-template-card h4 {
                    margin: 0 0 8px 0;
                    color: var(--text-primary);
                    font-size: 18px;
                }
                
                .workflow-template-card p {
                    color: var(--text-secondary);
                    margin-bottom: 12px;
                    line-height: 1.4;
                }
                
                .workflow-meta {
                    display: flex;
                    gap: 12px;
                    margin-bottom: 12px;
                }
                
                .workflow-automation,
                .workflow-steps {
                    background: var(--bg-secondary);
                    color: var(--text-secondary);
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: 500;
                }
                
                .workflow-platforms {
                    margin-bottom: 16px;
                }
                
                .platform-tag {
                    background: var(--primary);
                    color: white;
                    padding: 2px 6px;
                    border-radius: 3px;
                    font-size: 10px;
                    font-weight: 500;
                    margin-right: 4px;
                    margin-bottom: 4px;
                    display: inline-block;
                }
                
                .workflow-actions {
                    display: flex;
                    gap: 8px;
                }
                
                .ai-providers-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 20px;
                    margin-bottom: 32px;
                }
                
                .ai-provider-card {
                    background: var(--bg-primary);
                    border: 1px solid var(--border);
                    border-radius: var(--radius);
                    padding: 20px;
                }
                
                .ai-provider-card.connected {
                    border-color: #10b981;
                }
                
                .ai-provider-card.error {
                    border-color: #ef4444;
                }
                
                .provider-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                }
                
                .provider-header h4 {
                    margin: 0;
                    color: var(--text-primary);
                }
                
                .status-indicator {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    font-size: 12px;
                    font-weight: 500;
                }
                
                .status-indicator.connected {
                    color: #10b981;
                }
                
                .status-indicator.error {
                    color: #ef4444;
                }
                
                .provider-model,
                .provider-usage {
                    color: var(--text-secondary);
                    font-size: 14px;
                    margin-bottom: 8px;
                }
                
                .provider-actions {
                    display: flex;
                    gap: 8px;
                    margin-top: 16px;
                }
                
                .analytics-cards {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 16px;
                    margin-bottom: 32px;
                }
                
                .analytics-card {
                    background: var(--bg-primary);
                    border: 1px solid var(--border);
                    border-radius: var(--radius);
                    padding: 20px;
                }
                
                .analytics-card h4 {
                    margin: 0 0 12px 0;
                    color: var(--text-secondary);
                    font-size: 14px;
                    font-weight: 500;
                }
                
                .metric-value {
                    font-size: 32px;
                    font-weight: 700;
                    color: var(--primary);
                    display: block;
                    margin-bottom: 8px;
                }
                
                .ai-progress-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.5);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .ai-progress-container {
                    background: var(--bg-primary);
                    border-radius: var(--radius);
                    padding: 32px;
                    text-align: center;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                    max-width: 400px;
                }
                
                .ai-progress-spinner {
                    width: 48px;
                    height: 48px;
                    border: 4px solid var(--border);
                    border-top-color: var(--primary);
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                    margin: 0 auto 16px;
                }
                
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
                
                .ai-progress-message {
                    font-size: 18px;
                    font-weight: 600;
                    color: var(--text-primary);
                    margin-bottom: 8px;
                }
                
                .ai-progress-details {
                    font-size: 14px;
                    color: var(--text-secondary);
                }
                
                .image-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 16px;
                }
                
                .image-result {
                    background: var(--bg-primary);
                    border: 1px solid var(--border);
                    border-radius: var(--radius);
                    padding: 12px;
                    text-align: center;
                }
                
                .image-result img {
                    width: 100%;
                    height: 150px;
                    object-fit: cover;
                    border-radius: var(--radius);
                    margin-bottom: 8px;
                }
                
                .image-meta {
                    font-size: 12px;
                    color: var(--text-muted);
                    margin-bottom: 12px;
                }
                
                .empty-state {
                    text-align: center;
                    color: var(--text-muted);
                    font-style: italic;
                    padding: 32px;
                }
                
                .hidden {
                    display: none !important;
                }
                
                .execution-step {
                    background: var(--bg-primary);
                    border: 1px solid var(--border);
                    border-radius: var(--radius);
                    padding: 12px 16px;
                    margin-bottom: 8px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .execution-step.completed {
                    border-color: #10b981;
                    background: #f0fdf4;
                }
                
                .execution-step.running {
                    border-color: #f59e0b;
                    background: #fffbeb;
                }
                
                .execution-step.error {
                    border-color: #ef4444;
                    background: #fef2f2;
                }
                
                .step-name {
                    font-weight: 500;
                    color: var(--text-primary);
                }
                
                .step-status {
                    font-size: 12px;
                    font-weight: 600;
                    text-transform: uppercase;
                    padding: 4px 8px;
                    border-radius: 4px;
                }
                
                .execution-step.completed .step-status {
                    background: #10b981;
                    color: white;
                }
                
                .execution-step.running .step-status {
                    background: #f59e0b;
                    color: white;
                }
                
                .execution-step.error .step-status {
                    background: #ef4444;
                    color: white;
                }
            `;
            
            document.head.appendChild(styles);
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('BrainSAIT Marketing Dashboard loaded successfully!');
            refreshDashboard();
            
            // Add AI Hub button to primary actions
            setTimeout(() => {
                const primaryActions = document.querySelector('.primary-actions');
                if (primaryActions) {
                    const aiHubButton = document.createElement('a');
                    aiHubButton.href = '#';
                    aiHubButton.className = 'action-btn';
                    aiHubButton.onclick = showAIHub;
                    aiHubButton.innerHTML = `
                        <div class="icon">🧠</div>
                        <div>AI Hub</div>
                    `;
                    primaryActions.appendChild(aiHubButton);
                }
            }, 100);

            // Add event listener for AI content form
            document.addEventListener('submit', function(e) {
                if (e.target.id === 'aiContentForm') {
                    e.preventDefault();
                    handleContentGeneration();
                }
            });
        });

        
        // ================================
        // PLATFORM API SERVICE - REAL-TIME INTEGRATION
        // ================================
        
        class PlatformAPIService {
            constructor() {
                this.platforms = {
                    tiktok: {
                        name: 'TikTok',
                        connected: false,
                        lastUpdated: null,
                        credentials: { apiKey: '', secretKey: '' },
                        metrics: this.createEmptyMetrics('tiktok')
                    },
                    instagram: {
                        name: 'Instagram', 
                        connected: false,
                        lastUpdated: null,
                        credentials: { accessToken: '', appId: '' },
                        metrics: this.createEmptyMetrics('instagram')
                    },
                    snapchat: {
                        name: 'Snapchat',
                        connected: false, 
                        lastUpdated: null,
                        credentials: { clientId: '', clientSecret: '' },
                        metrics: this.createEmptyMetrics('snapchat')
                    },
                    youtube: {
                        name: 'YouTube',
                        connected: false,
                        lastUpdated: null, 
                        credentials: { apiKey: '', channelId: '' },
                        metrics: this.createEmptyMetrics('youtube')
                    }
                };
                
                this.updateInterval = null;
                this.isRealTimeActive = false;
                this.callbacks = {
                    onMetricsUpdate: [],
                    onConnectionChange: []
                };
                
                this.loadCredentials();
                this.initializeRealTimeUpdates();
            }
            
            createEmptyMetrics(platform) {
                return {
                    platform,
                    followers: 0,
                    engagement: 0,
                    reach: 0,
                    impressions: 0,
                    clicks: 0,
                    conversions: 0,
                    revenue: 0,
                    cpm: 0,
                    ctr: 0,
                    lastUpdated: new Date()
                };
            }
            
            // Load credentials from localStorage
            loadCredentials() {
                const stored = localStorage.getItem('platformCredentials');
                if (stored) {
                    try {
                        const credentials = JSON.parse(stored);
                        Object.keys(credentials).forEach(platform => {
                            if (this.platforms[platform]) {
                                this.platforms[platform].credentials = credentials[platform];
                                // Simulate connection if credentials exist
                                if (this.hasValidCredentials(platform)) {
                                    this.platforms[platform].connected = true;
                                }
                            }
                        });
                    } catch (e) {
                        console.warn('Failed to load credentials:', e);
                    }
                }
            }
            
            // Save credentials to localStorage
            saveCredentials() {
                const credentials = {};
                Object.keys(this.platforms).forEach(platform => {
                    credentials[platform] = this.platforms[platform].credentials;
                });
                localStorage.setItem('platformCredentials', JSON.stringify(credentials));
            }
            
            // Check if platform has valid credentials
            hasValidCredentials(platform) {
                const creds = this.platforms[platform]?.credentials;
                if (!creds) return false;
                
                switch (platform) {
                    case 'tiktok':
                        return creds.apiKey && creds.secretKey;
                    case 'instagram':
                        return creds.accessToken && creds.appId;
                    case 'snapchat':
                        return creds.clientId && creds.clientSecret;
                    case 'youtube':
                        return creds.apiKey && creds.channelId;
                    default:
                        return false;
                }
            }
            
            // Set platform credentials
            setCredentials(platform, credentials) {
                if (!this.platforms[platform]) {
                    throw new Error(`Unknown platform: ${platform}`);
                }
                
                this.platforms[platform].credentials = { ...credentials };
                this.saveCredentials();
                
                // Test connection
                return this.testConnection(platform);
            }
            
            // Test platform connection (simulated)
            async testConnection(platform) {
                if (!this.platforms[platform]) {
                    throw new Error(`Unknown platform: ${platform}`);
                }
                
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                
                const hasValidCreds = this.hasValidCredentials(platform);
                const connectionSuccess = hasValidCreds && Math.random() > 0.1; // 90% success rate
                
                this.platforms[platform].connected = connectionSuccess;
                this.platforms[platform].lastUpdated = new Date();
                
                if (connectionSuccess) {
                    // Initialize with some base metrics
                    this.generateMockMetrics(platform);
                }
                
                this.notifyConnectionChange(platform, connectionSuccess);
                return connectionSuccess;
            }
            
            // Generate realistic mock metrics
            generateMockMetrics(platform) {
                const base = this.getBaseMetrics(platform);
                const variation = 0.1; // 10% variation
                
                const metrics = {
                    platform,
                    followers: this.varyMetric(base.followers, variation),
                    engagement: this.varyMetric(base.engagement, variation),
                    reach: this.varyMetric(base.reach, variation),
                    impressions: this.varyMetric(base.impressions, variation),
                    clicks: this.varyMetric(base.clicks, variation),
                    conversions: this.varyMetric(base.conversions, variation),
                    revenue: this.varyMetric(base.revenue, variation),
                    cpm: this.varyMetric(base.cpm, variation / 2),
                    ctr: this.varyMetric(base.ctr, variation / 2),
                    lastUpdated: new Date()
                };
                
                this.platforms[platform].metrics = metrics;
                this.notifyMetricsUpdate(platform, metrics);
                return metrics;
            }
            
            // Get base metrics for each platform
            getBaseMetrics(platform) {
                const bases = {
                    tiktok: {
                        followers: 125000,
                        engagement: 8500,
                        reach: 45000,
                        impressions: 180000,
                        clicks: 3200,
                        conversions: 156,
                        revenue: 12500,
                        cpm: 2.85,
                        ctr: 1.78
                    },
                    instagram: {
                        followers: 87000,
                        engagement: 6200,
                        reach: 32000,
                        impressions: 120000,
                        clicks: 2100,
                        conversions: 91,
                        revenue: 8750,
                        cpm: 3.20,
                        ctr: 1.75
                    },
                    snapchat: {
                        followers: 56000,
                        engagement: 3800,
                        reach: 28000,
                        impressions: 95000,
                        clicks: 1500,
                        conversions: 67,
                        revenue: 5600,
                        cpm: 2.95,
                        ctr: 1.58
                    },
                    youtube: {
                        followers: 143000,
                        engagement: 12000,
                        reach: 65000,
                        impressions: 250000,
                        clicks: 4500,
                        conversions: 234,
                        revenue: 18750,
                        cpm: 2.45,
                        ctr: 1.80
                    }
                };
                
                return bases[platform] || bases.tiktok;
            }
            
            // Vary a metric by a percentage
            varyMetric(base, variation) {
                const change = (Math.random() - 0.5) * 2 * variation;
                return Math.round(base * (1 + change));
            }
            
            // Initialize real-time updates
            initializeRealTimeUpdates() {
                this.startRealTimeUpdates();
            }
            
            // Start real-time updates (every 5 seconds)
            startRealTimeUpdates() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                }
                
                this.isRealTimeActive = true;
                this.updateInterval = setInterval(() => {
                    this.updateAllConnectedPlatforms();
                }, 5000);
                
                // Initial update
                this.updateAllConnectedPlatforms();
            }
            
            // Stop real-time updates
            stopRealTimeUpdates() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                    this.updateInterval = null;
                }
                this.isRealTimeActive = false;
            }
            
            // Update all connected platforms
            updateAllConnectedPlatforms() {
                Object.keys(this.platforms).forEach(platform => {
                    if (this.platforms[platform].connected) {
                        this.generateMockMetrics(platform);
                    }
                });
            }
            
            // Get platform metrics
            getPlatformMetrics(platform) {
                return this.platforms[platform]?.metrics || this.createEmptyMetrics(platform);
            }
            
            // Get all metrics
            getAllMetrics() {
                const metrics = {};
                Object.keys(this.platforms).forEach(platform => {
                    metrics[platform] = this.getPlatformMetrics(platform);
                });
                return metrics;
            }
            
            // Get connection status
            getConnectionStatus(platform) {
                return {
                    connected: this.platforms[platform]?.connected || false,
                    lastUpdated: this.platforms[platform]?.lastUpdated
                };
            }
            
            // Get all connection statuses
            getAllConnectionStatuses() {
                const statuses = {};
                Object.keys(this.platforms).forEach(platform => {
                    statuses[platform] = this.getConnectionStatus(platform);
                });
                return statuses;
            }
            
            // Subscribe to metrics updates
            onMetricsUpdate(callback) {
                this.callbacks.onMetricsUpdate.push(callback);
            }
            
            // Subscribe to connection changes
            onConnectionChange(callback) {
                this.callbacks.onConnectionChange.push(callback);
            }
            
            // Notify metrics update
            notifyMetricsUpdate(platform, metrics) {
                this.callbacks.onMetricsUpdate.forEach(callback => {
                    try {
                        callback(platform, metrics);
                    } catch (e) {
                        console.error('Error in metrics update callback:', e);
                    }
                });
            }
            
            // Notify connection change
            notifyConnectionChange(platform, connected) {
                this.callbacks.onConnectionChange.forEach(callback => {
                    try {
                        callback(platform, connected);
                    } catch (e) {
                        console.error('Error in connection change callback:', e);
                    }
                });
            }
            
            // Get campaign data with real-time metrics
            getCampaignData() {
                const campaigns = JSON.parse(localStorage.getItem('campaigns') || '[]');
                return campaigns.map(campaign => ({
                    ...campaign,
                    metrics: this.aggregateMetricsForCampaign(campaign),
                    lastUpdated: new Date()
                }));
            }
            
            // Aggregate metrics for a campaign
            aggregateMetricsForCampaign(campaign) {
                let aggregated = this.createEmptyMetrics('aggregated');
                
                campaign.platforms?.forEach(platform => {
                    const metrics = this.getPlatformMetrics(platform);
                    aggregated.reach += metrics.reach;
                    aggregated.impressions += metrics.impressions;
                    aggregated.clicks += metrics.clicks;
                    aggregated.conversions += metrics.conversions;
                    aggregated.revenue += metrics.revenue;
                });
                
                // Calculate derived metrics
                aggregated.engagement = aggregated.clicks + (aggregated.conversions * 5);
                aggregated.ctr = aggregated.impressions > 0 ? (aggregated.clicks / aggregated.impressions) * 100 : 0;
                aggregated.cpm = aggregated.impressions > 0 ? (campaign.spent / aggregated.impressions) * 1000 : 0;
                
                return aggregated;
            }
        }
        
        // ================================
        // UTILITY FUNCTIONS
        // ================================
        
        class UtilityFunctions {
            // Format numbers with K, M, B suffixes
            static formatNumber(num) {
                if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
                if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
                if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
                return num.toString();
            }
            
            // Format currency
            static formatCurrency(amount, currency = 'USD') {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: currency
                }).format(amount);
            }
            
            // Format percentage
            static formatPercentage(value, decimals = 1) {
                return (value).toFixed(decimals) + '%';
            }
            
            // Format date and time
            static formatDateTime(date) {
                return new Intl.DateTimeFormat('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }).format(new Date(date));
            }
            
            // Get time ago string
            static getTimeAgo(date) {
                const now = new Date();
                const diff = now - new Date(date);
                const seconds = Math.floor(diff / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                
                if (days > 0) return `${days}d ago`;
                if (hours > 0) return `${hours}h ago`;
                if (minutes > 0) return `${minutes}m ago`;
                return `${seconds}s ago`;
            }
            
            // Generate chart colors
            static generateChartColors(count) {
                const colors = [
                    '#2563eb', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',
                    '#06b6d4', '#84cc16', '#f97316', '#ec4899', '#6366f1'
                ];
                
                const result = [];
                for (let i = 0; i < count; i++) {
                    result.push(colors[i % colors.length]);
                }
                return result;
            }
            
            // Validate API credentials
            static validateCredentials(platform, credentials) {
                const validations = {
                    tiktok: (creds) => creds.apiKey && creds.apiKey.length > 10 && creds.secretKey && creds.secretKey.length > 10,
                    instagram: (creds) => creds.accessToken && creds.accessToken.length > 20 && creds.appId && creds.appId.length > 5,
                    snapchat: (creds) => creds.clientId && creds.clientId.length > 10 && creds.clientSecret && creds.clientSecret.length > 15,
                    youtube: (creds) => creds.apiKey && creds.apiKey.length > 15 && creds.channelId && creds.channelId.length > 10
                };
                
                const validator = validations[platform];
                return validator ? validator(credentials) : false;
            }
            
            // Create loading animation
            static createLoadingSpinner() {
                return '<div class="loading-spinner" style="display: inline-block; width: 16px; height: 16px; border: 2px solid var(--border); border-radius: 50%; border-top-color: var(--primary); animation: spin 1s ease-in-out infinite;"></div>';
            }
            
            // Animate number changes
            static animateNumber(element, from, to, duration = 1000) {
                const start = performance.now();
                const update = (currentTime) => {
                    const elapsed = currentTime - start;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Easing function
                    const eased = 1 - Math.pow(1 - progress, 3);
                    const current = Math.round(from + (to - from) * eased);
                    
                    element.textContent = this.formatNumber(current);
                    
                    if (progress < 1) {
                        requestAnimationFrame(update);
                    }
                };
                requestAnimationFrame(update);
            }
        }
        
        // ================================
        // REAL-TIME DASHBOARD MANAGER
        // ================================
        
        class RealTimeDashboard {
            constructor() {
                this.apiService = new PlatformAPIService();
                this.isInitialized = false;
                this.charts = {};
                this.previousMetrics = {};
                
                this.initializeEventListeners();
                this.initializeRealTimeFeatures();
            }
            
            async initialize() {
                if (this.isInitialized) return;
                
                try {
                    // Setup API service callbacks
                    this.apiService.onMetricsUpdate((platform, metrics) => {
                        this.updatePlatformMetrics(platform, metrics);
                    });
                    
                    this.apiService.onConnectionChange((platform, connected) => {
                        this.updateConnectionStatus(platform, connected);
                    });
                    
                    // Initialize UI components
                    await this.createAPICredentialsInterface();
                    await this.createRealTimeMetricsDisplay();
                    await this.createRealTimeCharts();
                    
                    // Update connection statuses
                    this.updateAllConnectionStatuses();
                    
                    this.isInitialized = true;
                    console.log('Real-time dashboard initialized successfully');
                } catch (error) {
                    console.error('Error initializing real-time dashboard:', error);
                }
            }
            
            initializeEventListeners() {
                // Add CSS animations
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes spin { to { transform: rotate(360deg); } }
                    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
                    @keyframes slideIn { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
                    @keyframes countUp { from { transform: scale(0.8); } to { transform: scale(1); } }
                    
                    .loading-spinner { animation: spin 1s linear infinite; }
                    .pulse { animation: pulse 2s ease-in-out infinite; }
                    .slide-in { animation: slideIn 0.3s ease-out; }
                    .count-up { animation: countUp 0.5s ease-out; }
                    
                    .metric-card {
                        transition: all 0.3s ease;
                        backdrop-filter: blur(10px);
                        background: rgba(255, 255, 255, 0.9);
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    }
                    
                    [data-theme="dark"] .metric-card {
                        background: rgba(31, 41, 55, 0.9);
                        border: 1px solid rgba(55, 65, 81, 0.3);
                    }
                    
                    .metric-card:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                    }
                    
                    .connection-status {
                        display: inline-flex;
                        align-items: center;
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 12px;
                        font-weight: 600;
                    }
                    
                    .connection-status.connected {
                        background: rgba(16, 185, 129, 0.1);
                        color: var(--success);
                    }
                    
                    .connection-status.disconnected {
                        background: rgba(239, 68, 68, 0.1);
                        color: var(--error);
                    }
                    
                    .connection-status.connecting {
                        background: rgba(245, 158, 11, 0.1);
                        color: var(--warning);
                    }
                    
                    .metric-trend {
                        display: inline-flex;
                        align-items: center;
                        font-size: 12px;
                        font-weight: 600;
                    }
                    
                    .metric-trend.up { color: var(--success); }
                    .metric-trend.down { color: var(--error); }
                    .metric-trend.neutral { color: var(--text-muted); }
                    
                    .credentials-form {
                        display: grid;
                        gap: 16px;
                        padding: 20px;
                        background: var(--bg-primary);
                        border-radius: var(--radius);
                        border: 1px solid var(--border);
                    }
                    
                    .form-group {
                        display: flex;
                        flex-direction: column;
                        gap: 6px;
                    }
                    
                    .form-label {
                        font-weight: 600;
                        font-size: 13px;
                        color: var(--text-primary);
                    }
                    
                    .form-input {
                        padding: 10px 12px;
                        border: 1px solid var(--border);
                        border-radius: 4px;
                        background: var(--bg-secondary);
                        color: var(--text-primary);
                        font-size: 14px;
                    }
                    
                    .form-input:focus {
                        outline: none;
                        border-color: var(--primary);
                        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
                    }
                    
                    .password-toggle {
                        position: relative;
                    }
                    
                    .password-toggle-btn {
                        position: absolute;
                        right: 8px;
                        top: 50%;
                        transform: translateY(-50%);
                        background: none;
                        border: none;
                        cursor: pointer;
                        color: var(--text-muted);
                        font-size: 14px;
                    }
                    
                    .realtime-indicator {
                        display: inline-flex;
                        align-items: center;
                        gap: 6px;
                        font-size: 12px;
                        color: var(--text-muted);
                    }
                    
                    .realtime-dot {
                        width: 6px;
                        height: 6px;
                        background: var(--success);
                        border-radius: 50%;
                        animation: pulse 2s ease-in-out infinite;
                    }
                `;
                document.head.appendChild(style);
            }
            
            async createAPICredentialsInterface() {
                // Create API credentials section
                const mainGrid = document.querySelector('.main-grid');
                if (!mainGrid) return;
                
                const credentialsCard = document.createElement('div');
                credentialsCard.className = 'card';
                credentialsCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>API Credentials</h3>
                        <div class="realtime-indicator">
                            <div class="realtime-dot"></div>
                            <span>Real-time Active</span>
                        </div>
                    </div>
                    
                    <div class="platform-tabs" style="display: flex; border-bottom: 1px solid var(--border); margin-bottom: 20px;">
                        <button class="platform-tab active" data-platform="tiktok">TikTok</button>
                        <button class="platform-tab" data-platform="instagram">Instagram</button>
                        <button class="platform-tab" data-platform="snapchat">Snapchat</button>
                        <button class="platform-tab" data-platform="youtube">YouTube</button>
                    </div>
                    
                    <div id="credentials-forms">
                        ${this.createCredentialsForm('tiktok')}
                        ${this.createCredentialsForm('instagram')}
                        ${this.createCredentialsForm('snapchat')}
                        ${this.createCredentialsForm('youtube')}
                    </div>
                `;
                
                // Insert after the header
                const header = document.querySelector('.header');
                if (header && header.nextSibling) {
                    header.parentNode.insertBefore(credentialsCard, header.nextSibling);
                } else {
                    mainGrid.insertBefore(credentialsCard, mainGrid.firstChild);
                }
                
                this.setupCredentialsEventListeners();
            }
            
            createCredentialsForm(platform) {
                const platformConfig = {
                    tiktok: {
                        name: 'TikTok',
                        fields: [
                            { key: 'apiKey', label: 'API Key', type: 'password' },
                            { key: 'secretKey', label: 'Secret Key', type: 'password' }
                        ],
                        docs: 'https://developers.tiktok.com/'
                    },
                    instagram: {
                        name: 'Instagram',
                        fields: [
                            { key: 'accessToken', label: 'Access Token', type: 'password' },
                            { key: 'appId', label: 'App ID', type: 'text' }
                        ],
                        docs: 'https://developers.facebook.com/docs/instagram-api'
                    },
                    snapchat: {
                        name: 'Snapchat',
                        fields: [
                            { key: 'clientId', label: 'Client ID', type: 'text' },
                            { key: 'clientSecret', label: 'Client Secret', type: 'password' }
                        ],
                        docs: 'https://developers.snapchat.com/'
                    },
                    youtube: {
                        name: 'YouTube',
                        fields: [
                            { key: 'apiKey', label: 'API Key', type: 'password' },
                            { key: 'channelId', label: 'Channel ID', type: 'text' }
                        ],
                        docs: 'https://developers.google.com/youtube/v3'
                    }
                };
                
                const config = platformConfig[platform];
                const credentials = this.apiService.platforms[platform]?.credentials || {};
                const isConnected = this.apiService.platforms[platform]?.connected || false;
                
                return `
                    <div class="credentials-form platform-form" data-platform="${platform}" style="${platform === 'tiktok' ? '' : 'display: none;'}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <div>
                                <h4>${config.name} API Configuration</h4>
                                <div class="connection-status ${isConnected ? 'connected' : 'disconnected'}">
                                    <span id="status-${platform}">${isConnected ? 'Connected' : 'Disconnected'}</span>
                                </div>
                            </div>
                            <a href="${config.docs}" target="_blank" class="btn btn-small btn-secondary">
                                View Docs
                            </a>
                        </div>
                        
                        ${config.fields.map(field => `
                            <div class="form-group">
                                <label class="form-label" for="${platform}-${field.key}">${field.label}</label>
                                <div class="${field.type === 'password' ? 'password-toggle' : ''}">
                                    <input 
                                        type="${field.type}" 
                                        id="${platform}-${field.key}"
                                        class="form-input"
                                        value="${credentials[field.key] || ''}"
                                        placeholder="Enter ${field.label.toLowerCase()}"
                                    >
                                    ${field.type === 'password' ? `
                                        <button type="button" class="password-toggle-btn" onclick="togglePassword('${platform}-${field.key}')">
                                            👁️
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                        
                        <div style="display: flex; gap: 8px; margin-top: 16px;">
                            <button class="btn btn-primary" onclick="testConnection('${platform}')" id="test-btn-${platform}">
                                Test Connection
                            </button>
                            <button class="btn btn-secondary" onclick="saveCredentials('${platform}')">
                                Save Credentials
                            </button>
                        </div>
                    </div>
                `;
            }
            
            setupCredentialsEventListeners() {
                // Platform tab switching
                document.querySelectorAll('.platform-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const platform = e.target.dataset.platform;
                        
                        // Update active tab
                        document.querySelectorAll('.platform-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        // Show corresponding form
                        document.querySelectorAll('.platform-form').forEach(form => {
                            form.style.display = form.dataset.platform === platform ? 'block' : 'none';
                        });
                    });
                });
                
                // Add tab styles
                const tabStyle = document.createElement('style');
                tabStyle.textContent = `
                    .platform-tab {
                        padding: 8px 16px;
                        border: none;
                        background: none;
                        cursor: pointer;
                        border-bottom: 2px solid transparent;
                        color: var(--text-muted);
                        font-weight: 500;
                        transition: all 0.2s ease;
                    }
                    
                    .platform-tab:hover {
                        color: var(--text-primary);
                    }
                    
                    .platform-tab.active {
                        color: var(--primary);
                        border-bottom-color: var(--primary);
                    }
                `;
                document.head.appendChild(tabStyle);
            }
            
            async createRealTimeMetricsDisplay() {
                // Find or create metrics section
                let metricsSection = document.querySelector('#real-time-metrics');
                if (!metricsSection) {
                    metricsSection = document.createElement('div');
                    metricsSection.id = 'real-time-metrics';
                    metricsSection.className = 'card';
                    
                    const mainGrid = document.querySelector('.main-grid');
                    if (mainGrid) {
                        // Insert after credentials card
                        const credentialsCard = mainGrid.querySelector('.card');
                        if (credentialsCard && credentialsCard.nextSibling) {
                            mainGrid.insertBefore(metricsSection, credentialsCard.nextSibling);
                        } else {
                            mainGrid.appendChild(metricsSection);
                        }
                    }
                }
                
                metricsSection.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Real-Time Platform Metrics</h3>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <select id="platform-filter" class="form-input" style="width: auto;">
                                <option value="all">All Platforms</option>
                                <option value="tiktok">TikTok</option>
                                <option value="instagram">Instagram</option>
                                <option value="snapchat">Snapchat</option>
                                <option value="youtube">YouTube</option>
                            </select>
                            <button class="btn btn-small btn-secondary" onclick="refreshMetrics()">
                                🔄 Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div id="platform-metrics-grid" class="metrics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                        ${this.createPlatformMetricCards()}
                    </div>
                    
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <h4 style="margin-bottom: 12px;">Platform Performance Rankings</h4>
                        <div id="platform-rankings" class="rankings-list">
                            ${this.createPlatformRankings()}
                        </div>
                    </div>
                `;
                
                // Setup filter event listener
                document.getElementById('platform-filter')?.addEventListener('change', (e) => {
                    this.filterMetrics(e.target.value);
                });
            }
            
            createPlatformMetricCards() {
                const platforms = ['tiktok', 'instagram', 'snapchat', 'youtube'];
                return platforms.map(platform => {
                    const metrics = this.apiService.getPlatformMetrics(platform);
                    const status = this.apiService.getConnectionStatus(platform);
                    const platformName = this.apiService.platforms[platform].name;
                    
                    return `
                        <div class="metric-card platform-metric-card" data-platform="${platform}">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h4>${platformName}</h4>
                                <div class="connection-status ${status.connected ? 'connected' : 'disconnected'}" id="connection-${platform}">
                                    ${status.connected ? 'Connected' : 'Disconnected'}
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                                <div class="metric-item">
                                    <div class="metric-value count-up" id="${platform}-followers">${UtilityFunctions.formatNumber(metrics.followers)}</div>
                                    <div class="metric-label">Followers</div>
                                    <div class="metric-trend neutral" id="${platform}-followers-trend">—</div>
                                </div>
                                
                                <div class="metric-item">
                                    <div class="metric-value count-up" id="${platform}-engagement">${UtilityFunctions.formatNumber(metrics.engagement)}</div>
                                    <div class="metric-label">Engagement</div>
                                    <div class="metric-trend neutral" id="${platform}-engagement-trend">—</div>
                                </div>
                                
                                <div class="metric-item">
                                    <div class="metric-value count-up" id="${platform}-reach">${UtilityFunctions.formatNumber(metrics.reach)}</div>
                                    <div class="metric-label">Reach</div>
                                    <div class="metric-trend neutral" id="${platform}-reach-trend">—</div>
                                </div>
                                
                                <div class="metric-item">
                                    <div class="metric-value count-up" id="${platform}-impressions">${UtilityFunctions.formatNumber(metrics.impressions)}</div>
                                    <div class="metric-label">Impressions</div>
                                    <div class="metric-trend neutral" id="${platform}-impressions-trend">—</div>
                                </div>
                                
                                <div class="metric-item">
                                    <div class="metric-value count-up" id="${platform}-clicks">${UtilityFunctions.formatNumber(metrics.clicks)}</div>
                                    <div class="metric-label">Clicks</div>
                                    <div class="metric-trend neutral" id="${platform}-clicks-trend">—</div>
                                </div>
                                
                                <div class="metric-item">
                                    <div class="metric-value count-up" id="${platform}-conversions">${UtilityFunctions.formatNumber(metrics.conversions)}</div>
                                    <div class="metric-label">Conversions</div>
                                    <div class="metric-trend neutral" id="${platform}-conversions-trend">—</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--text-muted);">
                                <span>CTR: <span id="${platform}-ctr">${UtilityFunctions.formatPercentage(metrics.ctr)}</span></span>
                                <span>CPM: <span id="${platform}-cpm">${UtilityFunctions.formatCurrency(metrics.cpm)}</span></span>
                                <span id="${platform}-last-updated">Updated ${UtilityFunctions.getTimeAgo(metrics.lastUpdated)}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            createPlatformRankings() {
                const platforms = ['tiktok', 'instagram', 'snapchat', 'youtube'];
                const rankings = platforms.map(platform => {
                    const metrics = this.apiService.getPlatformMetrics(platform);
                    const platformName = this.apiService.platforms[platform].name;
                    return {
                        platform,
                        name: platformName,
                        score: metrics.engagement + (metrics.conversions * 10) + (metrics.reach * 0.1)
                    };
                }).sort((a, b) => b.score - a.score);
                
                return rankings.map((item, index) => `
                    <div class="ranking-item" style="display: flex; align-items: center; justify-content: space-between; padding: 8px 0;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="ranking-position" style="width: 24px; height: 24px; border-radius: 50%; background: ${index === 0 ? 'var(--success)' : index === 1 ? 'var(--warning)' : 'var(--text-muted)'}; color: white; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">
                                ${index + 1}
                            </div>
                            <span style="font-weight: 600;">${item.name}</span>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 14px; font-weight: 600;">Score: ${Math.round(item.score)}</div>
                            <div style="font-size: 12px; color: var(--text-muted);">Performance Index</div>
                        </div>
                    </div>
                `).join('');
            }
            
            async createRealTimeCharts() {
                // Create charts section
                let chartsSection = document.querySelector('#real-time-charts');
                if (!chartsSection) {
                    chartsSection = document.createElement('div');
                    chartsSection.id = 'real-time-charts';
                    chartsSection.className = 'card';
                    chartsSection.style.gridColumn = '1 / -1'; // Full width
                    
                    const mainGrid = document.querySelector('.main-grid');
                    if (mainGrid) {
                        mainGrid.appendChild(chartsSection);
                    }
                }
                
                chartsSection.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Real-Time Analytics</h3>
                        <div style="display: flex; gap: 8px;">
                            <select id="chart-timeframe" class="form-input" style="width: auto;">
                                <option value="1h">Last Hour</option>
                                <option value="6h">Last 6 Hours</option>
                                <option value="24h" selected>Last 24 Hours</option>
                                <option value="7d">Last 7 Days</option>
                            </select>
                            <button class="btn btn-small btn-secondary" onclick="exportChartData()">
                                📊 Export
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h4 style="margin-bottom: 10px;">Platform Performance Comparison</h4>
                            <canvas id="platformComparisonChart" width="400" height="200"></canvas>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 10px;">Engagement Trends</h4>
                            <canvas id="engagementTrendsChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="margin-bottom: 10px;">Conversion Funnel</h4>
                            <canvas id="conversionFunnelChart" width="400" height="200"></canvas>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 10px;">Revenue by Platform</h4>
                            <canvas id="revenueChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                `;
                
                // Initialize charts
                await this.initializeCharts();
            }
            
            async initializeCharts() {
                const platforms = ['tiktok', 'instagram', 'snapchat', 'youtube'];
                const colors = UtilityFunctions.generateChartColors(platforms.length);
                
                // Platform Comparison Chart (Bar)
                const platformCtx = document.getElementById('platformComparisonChart')?.getContext('2d');
                if (platformCtx) {
                    this.charts.platformComparison = new Chart(platformCtx, {
                        type: 'bar',
                        data: {
                            labels: platforms.map(p => this.apiService.platforms[p].name),
                            datasets: [{
                                label: 'Engagement',
                                data: platforms.map(p => this.apiService.getPlatformMetrics(p).engagement),
                                backgroundColor: colors,
                                borderColor: colors,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                }
                
                // Engagement Trends Chart (Line)
                const engagementCtx = document.getElementById('engagementTrendsChart')?.getContext('2d');
                if (engagementCtx) {
                    const hours = Array.from({ length: 24 }, (_, i) => `${i}:00`);
                    this.charts.engagementTrends = new Chart(engagementCtx, {
                        type: 'line',
                        data: {
                            labels: hours,
                            datasets: platforms.map((platform, index) => ({
                                label: this.apiService.platforms[platform].name,
                                data: this.generateTrendData(24),
                                borderColor: colors[index],
                                backgroundColor: colors[index] + '20',
                                fill: false,
                                tension: 0.4
                            }))
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            },
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
                
                // Conversion Funnel Chart (Doughnut)
                const funnelCtx = document.getElementById('conversionFunnelChart')?.getContext('2d');
                if (funnelCtx) {
                    const totalImpressions = platforms.reduce((sum, p) => sum + this.apiService.getPlatformMetrics(p).impressions, 0);
                    const totalClicks = platforms.reduce((sum, p) => sum + this.apiService.getPlatformMetrics(p).clicks, 0);
                    const totalConversions = platforms.reduce((sum, p) => sum + this.apiService.getPlatformMetrics(p).conversions, 0);
                    
                    this.charts.conversionFunnel = new Chart(funnelCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Impressions', 'Clicks', 'Conversions'],
                            datasets: [{
                                data: [totalImpressions, totalClicks, totalConversions],
                                backgroundColor: [colors[0], colors[1], colors[2]],
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
                
                // Revenue Chart (Bar)
                const revenueCtx = document.getElementById('revenueChart')?.getContext('2d');
                if (revenueCtx) {
                    this.charts.revenue = new Chart(revenueCtx, {
                        type: 'bar',
                        data: {
                            labels: platforms.map(p => this.apiService.platforms[p].name),
                            datasets: [{
                                label: 'Revenue ($)',
                                data: platforms.map(p => this.apiService.getPlatformMetrics(p).revenue),
                                backgroundColor: colors,
                                borderColor: colors,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            generateTrendData(points) {
                return Array.from({ length: points }, () => Math.floor(Math.random() * 1000) + 500);
            }
            
            initializeRealTimeFeatures() {
                // Auto-refresh every 5 seconds
                setInterval(() => {
                    this.updateRealTimeDisplay();
                }, 5000);
                
                // Initial update
                setTimeout(() => this.updateRealTimeDisplay(), 1000);
            }
            
            updatePlatformMetrics(platform, metrics) {
                // Update metric values with animation
                const prevMetrics = this.previousMetrics[platform] || metrics;
                
                ['followers', 'engagement', 'reach', 'impressions', 'clicks', 'conversions'].forEach(metric => {
                    const element = document.getElementById(`${platform}-${metric}`);
                    if (element) {
                        const fromValue = parseInt(element.textContent.replace(/[^0-9]/g, '')) || 0;
                        const toValue = metrics[metric];
                        
                        if (fromValue !== toValue) {
                            element.classList.add('count-up');
                            UtilityFunctions.animateNumber(element, fromValue, toValue);
                            
                            // Update trend
                            const trendElement = document.getElementById(`${platform}-${metric}-trend`);
                            if (trendElement) {
                                this.updateTrend(trendElement, prevMetrics[metric], toValue);
                            }
                        }
                    }
                });
                
                // Update CTR and CPM
                const ctrElement = document.getElementById(`${platform}-ctr`);
                if (ctrElement) {
                    ctrElement.textContent = UtilityFunctions.formatPercentage(metrics.ctr);
                }
                
                const cpmElement = document.getElementById(`${platform}-cpm`);
                if (cpmElement) {
                    cpmElement.textContent = UtilityFunctions.formatCurrency(metrics.cpm);
                }
                
                // Update last updated time
                const lastUpdatedElement = document.getElementById(`${platform}-last-updated`);
                if (lastUpdatedElement) {
                    lastUpdatedElement.textContent = `Updated ${UtilityFunctions.getTimeAgo(metrics.lastUpdated)}`;
                }
                
                this.previousMetrics[platform] = { ...metrics };
                
                // Update charts
                this.updateCharts();
            }
            
            updateTrend(element, oldValue, newValue) {
                const change = ((newValue - oldValue) / oldValue) * 100;
                const arrow = change > 0 ? '↗' : change < 0 ? '↘' : '—';
                const className = change > 0 ? 'up' : change < 0 ? 'down' : 'neutral';
                
                element.className = `metric-trend ${className}`;
                element.textContent = change === 0 ? '—' : `${arrow} ${Math.abs(change).toFixed(1)}%`;
            }
            
            updateConnectionStatus(platform, connected) {
                const statusElement = document.getElementById(`connection-${platform}`);
                if (statusElement) {
                    statusElement.className = `connection-status ${connected ? 'connected' : 'disconnected'}`;
                    statusElement.textContent = connected ? 'Connected' : 'Disconnected';
                }
                
                const formStatusElement = document.getElementById(`status-${platform}`);
                if (formStatusElement) {
                    formStatusElement.textContent = connected ? 'Connected' : 'Disconnected';
                    formStatusElement.parentElement.className = `connection-status ${connected ? 'connected' : 'disconnected'}`;
                }
            }
            
            updateAllConnectionStatuses() {
                Object.keys(this.apiService.platforms).forEach(platform => {
                    const status = this.apiService.getConnectionStatus(platform);
                    this.updateConnectionStatus(platform, status.connected);
                });
            }
            
            updateRealTimeDisplay() {
                // Update platform rankings
                const rankingsContainer = document.getElementById('platform-rankings');
                if (rankingsContainer) {
                    rankingsContainer.innerHTML = this.createPlatformRankings();
                }
                
                // Update last updated indicators
                Object.keys(this.apiService.platforms).forEach(platform => {
                    const metrics = this.apiService.getPlatformMetrics(platform);
                    const lastUpdatedElement = document.getElementById(`${platform}-last-updated`);
                    if (lastUpdatedElement) {
                        lastUpdatedElement.textContent = `Updated ${UtilityFunctions.getTimeAgo(metrics.lastUpdated)}`;
                    }
                });
            }
            
            updateCharts() {
                const platforms = ['tiktok', 'instagram', 'snapchat', 'youtube'];
                
                // Update platform comparison chart
                if (this.charts.platformComparison) {
                    this.charts.platformComparison.data.datasets[0].data = platforms.map(p => 
                        this.apiService.getPlatformMetrics(p).engagement
                    );
                    this.charts.platformComparison.update('none');
                }
                
                // Update conversion funnel
                if (this.charts.conversionFunnel) {
                    const totalImpressions = platforms.reduce((sum, p) => sum + this.apiService.getPlatformMetrics(p).impressions, 0);
                    const totalClicks = platforms.reduce((sum, p) => sum + this.apiService.getPlatformMetrics(p).clicks, 0);
                    const totalConversions = platforms.reduce((sum, p) => sum + this.apiService.getPlatformMetrics(p).conversions, 0);
                    
                    this.charts.conversionFunnel.data.datasets[0].data = [totalImpressions, totalClicks, totalConversions];
                    this.charts.conversionFunnel.update('none');
                }
                
                // Update revenue chart
                if (this.charts.revenue) {
                    this.charts.revenue.data.datasets[0].data = platforms.map(p => 
                        this.apiService.getPlatformMetrics(p).revenue
                    );
                    this.charts.revenue.update('none');
                }
            }
            
            filterMetrics(platform) {
                const cards = document.querySelectorAll('.platform-metric-card');
                cards.forEach(card => {
                    const cardPlatform = card.dataset.platform;
                    if (platform === 'all' || platform === cardPlatform) {
                        card.style.display = 'block';
                        card.classList.add('slide-in');
                    } else {
                        card.style.display = 'none';
                    }
                });
            }
        }
        
        // ================================
        // GLOBAL FUNCTIONS (for onclick handlers)
        // ================================
        
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = '🙈';
            } else {
                input.type = 'password';
                button.textContent = '👁️';
            }
        }
        
        async function testConnection(platform) {
            const button = document.getElementById(`test-btn-${platform}`);
            const originalText = button.textContent;
            
            // Get credentials from form
            const credentials = {};
            const form = document.querySelector(`[data-platform="${platform}"]`);
            const inputs = form.querySelectorAll('.form-input');
            
            inputs.forEach(input => {
                const key = input.id.split('-').pop();
                credentials[key] = input.value.trim();
            });
            
            // Validate credentials
            if (!UtilityFunctions.validateCredentials(platform, credentials)) {
                alert('Please fill in all required credentials');
                return;
            }
            
            try {
                // Update button state
                button.innerHTML = `${UtilityFunctions.createLoadingSpinner()} Testing...`;
                button.disabled = true;
                
                // Set credentials and test
                window.realTimeDashboard.apiService.setCredentials(platform, credentials);
                const success = await window.realTimeDashboard.apiService.testConnection(platform);
                
                if (success) {
                    button.innerHTML = '✅ Connected!';
                    button.style.background = 'var(--success)';
                } else {
                    button.innerHTML = '❌ Failed';
                    button.style.background = 'var(--error)';
                }
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '';
                    button.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('Connection test failed:', error);
                button.innerHTML = '❌ Error';
                button.style.background = 'var(--error)';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '';
                    button.disabled = false;
                }, 2000);
            }
        }
        
        function saveCredentials(platform) {
            const credentials = {};
            const form = document.querySelector(`[data-platform="${platform}"]`);
            const inputs = form.querySelectorAll('.form-input');
            
            inputs.forEach(input => {
                const key = input.id.split('-').pop();
                credentials[key] = input.value.trim();
            });
            
            if (!UtilityFunctions.validateCredentials(platform, credentials)) {
                alert('Please fill in all required credentials');
                return;
            }
            
            try {
                window.realTimeDashboard.apiService.setCredentials(platform, credentials);
                
                // Show success feedback
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '✅ Saved!';
                button.style.background = 'var(--success)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
                
            } catch (error) {
                console.error('Failed to save credentials:', error);
                alert('Failed to save credentials. Please try again.');
            }
        }
        
        function refreshMetrics() {
            if (window.realTimeDashboard) {
                window.realTimeDashboard.apiService.updateAllConnectedPlatforms();
                
                // Show refresh feedback
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = `${UtilityFunctions.createLoadingSpinner()} Refreshing...`;
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 1000);
            }
        }
        
        function exportChartData() {
            if (!window.realTimeDashboard) return;
            
            const data = {
                timestamp: new Date().toISOString(),
                platforms: window.realTimeDashboard.apiService.getAllMetrics(),
                campaigns: window.realTimeDashboard.apiService.getCampaignData()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `brainsait-analytics-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // ================================
        // INITIALIZE REAL-TIME DASHBOARD
        // ================================
        
        // Wait for DOM and existing scripts to load
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Initialize real-time dashboard
                window.realTimeDashboard = new RealTimeDashboard();
                await window.realTimeDashboard.initialize();
                
                console.log('BrainSAIT Real-Time Marketing Dashboard initialized successfully!');
            } catch (error) {
                console.error('Failed to initialize real-time dashboard:', error);
            }
        });
        
    </script>
</body>
</html>